/*!
 * jQuery Birthday Picker: v1.4 - 10/16/2011
 * http://abecoffman.com/stuff/birthdaypicker
 *
 * Copyright (c) 2010 Abe Coffman
 * Dual licensed under the MIT and GPL licenses.
 *
 */

(function(e){var t={"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"long":["January","February","March","April","May","June","July","August","September","October","November","December"]},n=new Date,r=n.getFullYear(),i=n.getMonth()+1,s=n.getDate();e.fn.birthdaypicker=function(n){n&&typeof n=="string"&&(n=jQuery.parseJSON(n));var i={maxage:120,minage:0,futuredates:!1,maxyear:r,minyear:"",dateformat:"middleEndian",monthformat:"short",placeholder:!0,legend:"",defaultdate:!1,fieldname:"birthdate",fieldid:"birthdate",hiddendate:!0,onchange:null,tabindex:null,required:!1,errorname:"",id:""};return this.each(function(){n&&e.extend(i,n);var s=i.required?" required":"",o=e("<fieldset class='birthday-picker'></fieldset>"),u=e("<select class='birth-year not_sending' name='"+i.id+"_birth[year]'"+s+"></select>"),a=e("<select class='birth-month not_sending' name='"+i.id+"_birth[month]'"+s+"></select>"),f=e("<select class='birth-day not_sending' name='"+i.id+"_birth[day]'"+s+"></select>");i.legend&&e("<legend>"+i.legend+"</legend>").appendTo(o),i.id!==""&&(i.fieldid=i.id,i.fieldname=i.id);var l=i.tabindex;i["dateformat"]=="bigEndian"?(o.append(u).append(a).append(f),l!=null&&(u.attr("tabindex",l),a.attr("tabindex",l++),f.attr("tabindex",l++))):i["dateformat"]=="littleEndian"?(o.append(f).append(a).append(u),l!=null&&(f.attr("tabindex",l),a.attr("tabindex",l++),u.attr("tabindex",l++))):(o.append(a).append(f).append(u),l!=null&&(a.attr("tabindex",l),f.attr("tabindex",l++),u.attr("tabindex",l++))),i.placeholder&&(e("<option value=''>Year:</option>").appendTo(u),e("<option value=''>Month:</option>").appendTo(a),e("<option value=''>Day:</option>").appendTo(f));var c,h,p;i.defaultdate?(h=i.defaultdate.split("/"),e.isArray(h)&&h.length===3?p=new Date(h[2],h[0],h[1]):p=new Date(i.defaultdate+"T00:00:00")):p=new Date;var d=p.getFullYear()-1,v=p.getMonth()+1,m=p.getDate();v=v<10?"0"+v:v,m=m<10?"0"+m:m,c=v+"/"+m+"/"+d,i.hiddendate&&e("<input type='hidden' name='"+i.fieldname+"'/>").attr("id",i.fieldid).val(c).appendTo(o);var g=r-i.minage,y=i.minyear!==""?i.minyear:r-i.maxage;i.futuredates&&i["maxyear"]!=r&&(i.maxyear>1e3?g=i.maxyear:g=r+i.maxyear);for(var b=g;b>=y;b--)e("<option></option>").attr("value",b).text(b).appendTo(u);for(var w=0;w<12;w++)e("<option></option>").attr("value",w+1).text(t[i.monthformat][w]).appendTo(a);for(var E=1;E<32;E++)e("<option></option>").attr("value",E).text(E).appendTo(f);e(this).append(o);if(i.defaultdate){var S;e.isArray(h)&&h.length===3?S=new Date(h[2],h[0],h[1]):S=new Date(i.defaultdate+"T00:00:00"),u.val(S.getFullYear()),a.val(S.getMonth()+1),f.val(S.getDate())}o.change(function(){var n=new Date,r=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),l=parseInt(u.val(),10),h=parseInt(a.val(),10),p=parseInt(f.val(),10),d=(new Date(l,h,0)).getDate(),v=parseInt(a.children(":last").val()),m=parseInt(f.children(":last").val());if(m>d)while(m>d)f.children(":last").remove(),m--;else if(m<d)while(m<d)m++,f.append("<option value="+m+">"+m+"</option>");if(!i.futuredates&&l==g){if(v>s){while(v>s)a.children(":last").remove(),v--;f.children(":first").attr("selected","selected")}if(h===s)while(m>o)f.children(":last").remove(),m-=1}if(l!=g&&v!=12)while(v<12)a.append("<option value="+(v+1)+">"+t[i.monthformat][v]+"</option>"),v++;l*h*p!=0&&(h=h<10?"0"+h:h,p=p<10?"0"+p:p,c=h+"/"+p+"/"+l,e(this).find("#"+i.fieldid).val(c),i["onchange"]!=null&&i.onchange(c))})})}})(jQuery);