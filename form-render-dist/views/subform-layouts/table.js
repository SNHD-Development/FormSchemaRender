define(["jquery","lodash","backbone","vm","events","text!templates/subform-layouts/table.html","text!templates/popover/confirmation.html"],function(e,t,n,r,i,s,o){var u=n.View.extend({template:t.template(s),popTemplate:t.template(o),initialize:function(){this.collection.on("reset",this.resetCollection,this)},render:function(){var n=this,r=[],i=new Array(this.collection.length),s=new Array(this.collection.length);t.each(this.options.formSchema.fields,function(e){r.push(e.description),t.each(n.collection.models,function(t,n){var r=t.toJSON(),o;typeof i[n]=="undefined"&&(i[n]=[],s[n]=t.cid);switch(e.type.toLowerCase()){case"fullname":o=r[e.name+"_fullname_first_name"],typeof r[e.name+"_fullname_middle_name"]!="undefined"&&(o+=" "+r[e.name+"_fullname_middle_name"]),o+=" "+r[e.name+"_fullname_last_name"],i[n].push(o);break;default:i[n].push(r[e.name])}})}),e(this.el).html(this.template({labels:r,values:i,modelId:s}))},events:{"click .subform-edit-model":"editModel","click .subform-remove-model":"popoverConfirm","click .popover-action .popover-submit":"removeModel","click .popover-action .popover-cancel":"removePopover"},editModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",this.collection.get(n))},popoverConfirm:function(t){t.preventDefault();var n={html:!0,placement:"bottom",trigger:"manual",title:"Do you want to remove this data?",content:this.popTemplate({id:e(t.currentTarget,this.el).attr("data-id")})};e(t.currentTarget,this.el).popover(n).popover("show")},removeModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");this.collection.remove(this.collection.get(n)),this.collection.length>0?this.render():this.$el.html("")},removePopover:function(t){e(".subform-remove-model",e(t.currentTarget,this.el).parents(".subform-actions")).popover("destroy").next(".popover").remove()},resetCollection:function(e){this.$el.html("")}});return u});