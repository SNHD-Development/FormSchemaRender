define(["jquery","underscore","backbone","vm","humane","models/form","select2helper","text!data/county.json","text!templates/modules/external-create-user-data-modal.html","text!templates/modal/webcam.html","webcam","cropper","bootstrap","jquery.select2","jquery.spinner","jquery.birthdaypicker","jquery.placeholder","jquery.expose","jquery.zclip","jquery.stupidtable","xdr","jquery.timepicker"],function($,_,Backbone,Vm,humane,FormModel,Select2Helper,countyData,externalCreateUserDataTemplate,webcamTemplate,WebCam,Cropper){function setValueDependOn(e,t,a){_.each(t,function(t){a.fields[t.name]&&($(e).on("visibleOnRenderComplete",':input[name="'+t.name+'"]',function(){var e=$(this);e.is(":radio")||e.is(":checkbox")?e.val()===a.fields[t.name]&&e.prop("checked",!0):e.val(a.fields[t.name]).trigger("change")}),$(':input[name="'+t.options.visibleon.name+'"]').trigger("change"))})}function getText(e,t){if(!e)return e;if(!t)return e;if(!(e in SYSTEM_LANG))return e;var a=SYSTEM_LANG[e];if(!(t in a))return e;var o=a[t];return o||e}function humanFileSize(e,t){var a=t?1e3:1024;if(Math.abs(e)<a)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1;do{e/=a,++r}while(Math.abs(e)>=a&&r<o.length-1);return e.toFixed(1)+" "+o[r]}function getBase64(){var e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var a,o,r,n,i,l,s,c="",d=0;for(t=e._utf8_encode(t);d<t.length;)a=t.charCodeAt(d++),o=t.charCodeAt(d++),r=t.charCodeAt(d++),n=a>>2,i=(3&a)<<4|o>>4,l=(15&o)<<2|r>>6,s=63&r,isNaN(o)?l=s=64:isNaN(r)&&(s=64),c=c+this._keyStr.charAt(n)+this._keyStr.charAt(i)+this._keyStr.charAt(l)+this._keyStr.charAt(s);return c},decode:function(t){var a,o,r,n,i,l,s,c="",d=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<t.length;)n=this._keyStr.indexOf(t.charAt(d++)),i=this._keyStr.indexOf(t.charAt(d++)),l=this._keyStr.indexOf(t.charAt(d++)),s=this._keyStr.indexOf(t.charAt(d++)),a=n<<2|i>>4,o=(15&i)<<4|l>>2,r=(3&l)<<6|s,c+=String.fromCharCode(a),64!=l&&(c+=String.fromCharCode(o)),64!=s&&(c+=String.fromCharCode(r));return c=e._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",a=0;a<e.length;a++){var o=e.charCodeAt(a);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t,a,o,r="",n=0,i=t=a=0;n<e.length;)i=e.charCodeAt(n),i<128?(r+=String.fromCharCode(i),n++):i>191&&i<224?(a=e.charCodeAt(n+1),r+=String.fromCharCode((31&i)<<6|63&a),n+=2):(a=e.charCodeAt(n+1),o=e.charCodeAt(n+2),r+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&o),n+=3);return r}};return e}function getModelValueForViewModel(e,t){if(e=e||{},e.fields){var a=e.fields[t];if(_.isString(a))try{var o=JSON.parse(a);a=o}catch(e){return console.error("[x] baseField.js: could not parse JSON string for "+t+" ("+a+")"),a}return a}}function convertDataURIToBlob(e,t){for(var a=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(a.length),n=new Uint8Array(r),i=0;i<a.length;i++)n[i]=a.charCodeAt(i);return new Blob([r],{type:o},t)}function isMobileDevice(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}var DEBUG=!1,LUT_ALL_DATE_PICKER={},SYSTEM_LANG={"Validation Error":{en:"Validation Error",sp:"Error de validacion",ar:"خطئ في التحقق","zh-cn":"验证错误","zh-tw":"驗證錯誤",fa:"خطای اعتبار سنجی",ja:"検証エラー",ko:"유효성 검사 오류",pt:"erro de validação",ru:"Ошибка проверки",tl:"May error sa validation.",th:"ข้อผิดพลาดในการตรวจสอบ",vi:"Lỗi xác nhận"},"Please complete the required fields":{en:"Please complete the required fields",sp:"Por favor complete los campos requeridos",ar:"يرجى إكمال الحقول المطلوبة","zh-cn":"请填写必填字段","zh-tw":"請填寫必填字段",fa:"لطفا فیلدهای مورد نیاز را تکمیل کنید",ja:"必須フィールドを入力してください",ko:"필수 입력란을 작성하십시오.",pt:"Por favor, preencha os campos obrigatórios",ru:"Заполните необходимые поля",tl:"Maaring kumpletuhin and mga kailangan na mga fields",th:"โปรดกรอกข้อมูลในฟิลด์ที่จำเป็น",vi:"Vui lòng hoàn tất các trường bắt buộc"},Previous:{en:"Previous",sp:"Anterior",ar:"سابق","zh-cn":"以前","zh-tw":"以前",fa:"قبلی",ja:"前",ko:"너무 이른",pt:"Anterior",ru:"предыдущий",tl:"Nakaraan",th:"ก่อน",vi:"Trước"},Next:{en:"Next",sp:"Siguiente",ar:"التالى","zh-cn":"下一個","zh-tw":"下一个",fa:"بعد",ja:"次",ko:"다음 것",pt:"Próximo",ru:"следующий",tl:"Susunod",th:"ต่อไป",vi:"Kế tiếp"},Submit:{en:"Submit",sp:"Enviar",ar:"خضع","zh-cn":"提交","zh-tw":"提交",fa:"ارسال",ja:"提出する",ko:"제출",pt:"Enviar",ru:"Отправить",tl:"Ipasa",th:"เสนอ",vi:"Gửi đi"}};return{config:{fileUrl:"/form/getFile",internalViewUrl:"/Form/SingleView"},renderError:function(e,t){e.html('<div class="alert alert-danger"><i class="icon-wrench"></i> <strong>Error: Please refresh this page and try again.</strong> <br> '+t+"</div>")},checkBrowser:function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=parseInt(RegExp.$1);e<7&&(e=7),$("body").addClass("ie"+e)}},setupOldBrowser:function(){Object.keys=Object.keys||function(e){var t,a=[];for(t in e)e.hasOwnProperty(t)&&a.push(t);return a},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,o=this.length;a<o;a++)if(this[a]===e)return a;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var a=0,o=this.length;a<o;a++)a in this&&e.call(t,this[a],a,this)})},ucwords:function(e){return(e+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(e){return e.toUpperCase()})},htmlspecialchars:function(e,t,a,o){var r=0,n=0,i=!1;void 0!==t&&null!==t||(t=2),e=e.toString(),!1!==o&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var l={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(i=!0),"number"!=typeof t){for(t=[].concat(t),n=0;n<t.length;n++)0===l[t[n]]?i=!0:l[t[n]]&&(r|=l[t[n]]);t=r}return t&l.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),i||(e=e.replace(/"/g,"&quot;")),e},htmlspecialchars_decode:function(e,t){var a=0,o=0,r=!1;void 0===t&&(t=2),e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var n={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(r=!0),"number"!=typeof t){for(t=[].concat(t),o=0;o<t.length;o++)0===n[t[o]]?r=!0:n[t[o]]&&(a|=n[t[o]]);t=a}return t&n.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),r||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&")},replaceTemplateStringCurlyBrace:function(e,t,a){return e.replace("{{"+t+"}}",a)},parseTemplateString:function(e){var t=/\w+=\{\{(\w|\.)+\}\}/gi;return e.match(t)},parseTemplateStringGet:function(e){var t=/\w+=(\w|\.)+/gi;return e.match(t)},parseTemplateStringCurlyBrace:function(e){var t=/\{\{([\w|\.]+)\}\}/gi,a=e.match(t);if(a&&(RegExp.$1&&(a=RegExp.$1),a.indexOf("{")>-1))throw"Still Found Curly Brace in the string in parseTemplateStringCurlyBrace!";return a},changeURLGetTemplateString:function(e,t){t=t||null;var a=e,o=this.parseTemplateString(a);if(o)for(var r in o){var n,i=o[r];if(n=this.parseTemplateStringCurlyBrace(i)){if(!n)throw'Unexpected changeURLGetTemplateString, found more than one template variable for "'+i+'"';if(t&&n&&_.indexOf(n,".")>=0&&n.split){var l=n.split(".");if(l&&l.length>0){var s=t;if(_.each(l,function(e){var t=e.toLowerCase(),a=_.map(_.keys(s),function(e){return e.toLowerCase()});_.indexOf(a,t)<0||(s=e in s?s[e]:s[t])}),s){a=a.replace("{{"+n+"}}",s);continue}}}switch(n){case"userid":a=a.replace("{{"+n+"}}",this.getUserIdFormHtml());break;default:console&&console.info&&console.info('[x] Info: Not Implement this "'+n+'" Url Template Variable yet!')}}}return a},checkRequireFields:function(e,t){var a;switch(e.type.toLowerCase()){case"multifiles":return a=e.name+"[]",!(void 0===t[a]||!t[a].required);case"address":return a=e.name+"_address_street",void 0!==t[a]&&t[a].required?!0:(a=e.name+"_address_city",!(void 0===t[a]||!t[a].required)||(a=e.name+"_address_state",!(void 0===t[a]||!t[a].required)||(a=e.name+"_address_zip",!(void 0===t[a]||!t[a].required)||(a=e.name+"_address_country",!(void 0===t[a]||!t[a].required)||(a=e.name+"_address_street_number",!(void 0===t[a]||!t[a].required)||(a=e.name+"_address_unit_number",!(void 0===t[a]||!t[a].required)))))));case"fullname":return a=e.name+"_fullname_middle_name",void 0!==t[a]&&t[a].required?!0:(a=e.name+"_fullname_first_name",!(void 0===t[a]||!t[a].required)||(a=e.name+"_fullname_last_name",!(void 0===t[a]||!t[a].required)))}return!(void 0===t[e.name]||!t[e.name].required)},preValidate:function(e,t){var a,o=$(e.currentTarget),r=o.attr("name"),n=o.is(":file");o.closest(".subform-button-wrapper").length||(a=n?o.val():$.trim(o.val()),n||(o.hasClass("tolowercase")&&(a=a.toLowerCase(),o.hasClass("tolowercase_email")||(a=a.replace(/^([0-9]\w+)|\s+([0-9]\w+)/g,function(e){return e.toUpperCase()}),a=a.replace(/^(us\s)|\s+(us)\s/gi,function(e){return e.toUpperCase()}))),o.hasClass("toucwords")?a=this.ucwords(a):o.hasClass("touppercase")&&a.toUpperCase&&(a=a.toUpperCase()),o.hasClass("allowedonespace")&&a.replace&&(a=a.replace(/ +(?= )/g,"")),o.val(a).trigger("change")),t.set(r,a),t.isValid(r,a)?o.removeClass("invalid"):o.addClass("invalid"))},setupPlaceHolder:function(e){$("input, textarea",e).placeholder()},setupFileInput:function(e){$(":file",e).trigger("change")},setupEmailInput:function(e){$(".emailpicker",e).each(function(){var e=$(".emailpicker_server",this),t=$(".emailpicker_username",this),a=$(':input[type="hidden"]',this);$(".not_sending",this);if(void 0!==e.attr("data-value")&&e.attr("data-value")&&e.val(e.attr("data-value")).trigger("change"),""!==a.val()){var o=a.val().split("@");2===o.length&&(t.val(o[0]).trigger("change"),e.val(o[1]).trigger("change"))}$(".emailpicker_server, .emailpicker_username",this).on("change",this,function(o){""!==t.val()&&""!==e.val()?a.val($.trim(t.val()+"@"+e.val())).trigger("change"):a.val("").trigger("change")}).on("keydown",function(e){if(32===e.keyCode)return e.preventDefault(),!1})})},setupBDateInput:function(e,t,a){a=a||!1,$(".birthdaypicker",e).each(function(){var e=$(this).attr("data-options");a&&e&&(e&&"string"==typeof e&&(e=$.parseJSON(e)),e&&e.id&&t.get(e.id)&&(e.defaultdate=t.get(e.id))),$(this).birthdaypicker(e);var o,r,n,i,l=$(':input[type="hidden"]',this),s=l.val();""!==s&&""!==t.get(l.attr("name"))&&(o=s.split("/"),3===o.length&&("0"===o[0][0]&&(o[0]=o[0].substr(1)),"0"===o[1][0]&&(o[1]=o[1].substr(1)),r=$(".birth-month",this).val(o[0]),n=$(".birth-day",this).val(o[1]),i=$(".birth-year",this).val(o[2]),t.set(r.attr("name"),o[0]),t.set(n.attr("name"),o[1]),t.set(i.attr("name"),o[2])))})},setHiddenField:function(e){$(':hidden[data-value!=""]',e).each(function(){var e=$(this);void 0!==e.attr("data-value")&&e.attr("data-value")&&e.val(e.attr("data-value")).trigger("change")})},getBDateinput:function(e,t){$("fieldset.birthday-picker",e).each(function(){var e=/NaN/i,a=$(':input[type="hidden"]',this),o=$(".not_sending.birth-day",this),r=$(".not_sending.birth-month",this),n=$(".not_sending.birth-year",this),i=parseInt(o.val()),l=parseInt(r.val()),s=parseInt(n.val()),c=!1;String(i).match(e)&&(o.val(""),c=!0),String(l).match(e)&&(r.val(""),c=!0),String(s).match(e)&&(n.val(""),c=!0),c?a.val(""):(l<10&&(l+=0+l),i<10&&(i+=0+i),l+"/"+i+"/"+s,a.val()),t.set(a.attr("name"),a.val())})},getUserId:function(e,t){$(".select2-offscreen",e).each(function(){var e=$(this);t.set(e.attr("name"),e.val()).trigger("change")})},getDefaultValues:function(e,t){t=t||null,$(".has-default-val",e).each(function(){var e=$(this);e.is(":disabled")||(""===e.val()?e.trigger("change"):e.hasClass("data-clean")&&e.trigger("change").removeClass("data-clean"))}),$(":hidden:input",e).each(function(){var e=$(this),a=e.val(),o=e.attr("name");o&&""!==o&&(e.is(":radio")||e.is(":checkbox")||o&&a&&""!==a&&t&&t.set(o,a))})},setupTimeInput:function(e,t,a){var o=a;o&&(console.log("[*] utils.setupTimeInput"),console.log(e),console.log(t));var r;t&&t.model&&(r=t.model);var n=$(".timepicker",e);o&&(r&&r.toJSON&&console.log(r.toJSON()),console.log("    Found: "+n.length),console.log(n)),n.each(function(){var e=$(this),t=e.attr("data-timepicker-options");if(o&&console.log("- dataOptions:",t),!t||_.isEmpty(t))t={};else if(_.isString(t)){var a=$.parseJSON(t);a&&!_.isEmpty(a)&&_.isObject(a)&&(o&&console.log("- dataOptions:",t),t=a)}_.isObject(t)&&(t.change=function(e){var t=$(this),a=t.val();o&&console.log("- change:","- $this:",t,"- value:",a),t.removeClass("invalid"),o&&console.log("- value:",a),t.trigger("change"),o&&console.log("- value:",a)}),e.timepicker(t)})},setupDateInput:function(el,view,debug){var DEBUG=debug,fViewArr,firstTime=!1;view&&(view.formView&&view.formView._DatePickerLogicArr?(fViewArr=view.formView._DatePickerLogicArr,firstTime=!0):view._DatePickerLogicArr&&(fViewArr=view._DatePickerLogicArr)),DEBUG&&(console.log("[*] utils.setupDateInput"),console.log(el),console.log(view),console.log(fViewArr));var _model;view&&view.model&&(_model=view.model);var $allDatepicker=$(".datepicker",el);DEBUG&&(_model&&_model.toJSON&&console.log(_model.toJSON()),console.log("    Found: "+$allDatepicker.length),console.log($allDatepicker)),$allDatepicker.each(function(){var _options={},maxDate,nowTemp,$this=$(this),_id=$this.attr("name"),hasDatepickerOptions=$this.has("data-has-datepicker-options");if(DEBUG&&(console.log("[setupDateInput] _id:",_id,"$this:",$this),console.log("[setupDateInput] hasDatepickerOptions:",hasDatepickerOptions)),_model&&_model.get){var _tmpVal=_model.get(_id);if(DEBUG&&console.log("[setupDateInput] _id:",_id,"_tmpVal:",_tmpVal),_tmpVal&&_tmpVal.$date){if(_tmpVal=moment(_tmpVal.$date),!_tmpVal.isValid())throw new Error('Could not be able to parse this date data "'+_id+'".');$this.val(_tmpVal.format("MM/DD/YYYY")),_model.set(_id,$this.val())}}if(DEBUG&&(console.log("   Loop: .datepicker:",_id),console.log(_id),console.log($this),fViewArr&&fViewArr[_id]&&console.log(fViewArr[_id]),console.log("- hasDatepickerOptions: ",hasDatepickerOptions),console.log("- _tmpVal: ",_tmpVal),_tmpVal&&_tmpVal.isValid&&_tmpVal.isValid()&&console.log("_tmpVal:",_tmpVal.format("YYYY-MM-DD"))),fViewArr&&fViewArr[_id]&&fViewArr[_id].getvaluefrom&&fViewArr[_id].comparison){var logicOpts=fViewArr[_id];if(!logicOpts.getvaluefrom)throw'In order to use setupDateInput with "DatepickerOptions". Required to have "GetValueFrom" key! ('+_id+")";if(!logicOpts.comparison)throw'In order to use setupDateInput with "DatepickerOptions". Required to have "Comparison" key! ('+_id+")";DEBUG&&console.log("before [onRender] setting <--------------"),_options.onRender=function(date){var targetDate=logicOpts.getvaluefrom;DEBUG&&(console.log("[onRender] _id:",_id,"targetDate:",targetDate,"logicOpts:",logicOpts),console.log("[onRender] $this:",$this),console.log("[onRender] fViewArr:",fViewArr),console.log("[onRender] fViewArr[targetDate]:",fViewArr[targetDate]),console.log("[onRender] fViewArr[targetDate].element:",fViewArr[targetDate].element));var targetDatePickerEl=fViewArr[targetDate]&&fViewArr[targetDate].element?fViewArr[targetDate].element:null;if(!targetDatePickerEl&&fViewArr[targetDate]&&logicOpts&&logicOpts.getvaluefrom&&LUT_ALL_DATE_PICKER&&LUT_ALL_DATE_PICKER[logicOpts.getvaluefrom]&&(targetDatePickerEl=LUT_ALL_DATE_PICKER[logicOpts.getvaluefrom],fViewArr[targetDate].element=targetDatePickerEl),targetDatePickerEl){var _cmd,_today;return $this.attr("data-maxdate")?(_today=new Date,_cmd=fViewArr[targetDate].element.date.valueOf()+" "+logicOpts.comparison+"  "+date.valueOf()+" || "+date.valueOf()+"  > "+_today.getTime()+" ? 'disabled' : ''"):$this.attr("data-mindate")?(_today=new Date,_cmd=fViewArr[targetDate].element.date.valueOf()+" "+logicOpts.comparison+"  "+date.valueOf()+" || "+date.valueOf()+"  < "+_today.getTime()+" ? 'disabled' : ''"):_cmd=fViewArr[targetDate].element.date.valueOf()+" "+logicOpts.comparison+" "+date.valueOf()+" ? 'disabled' : ''",eval(_cmd)}},fViewArr[logicOpts.getvaluefrom]||(fViewArr[logicOpts.getvaluefrom]={}),fViewArr[logicOpts.getvaluefrom].changeDate=function(ev){var targetDate=_id,tmpComp=logicOpts.comparison.substr(0,1),newDate=new Date(ev.date),logic=ev.date.valueOf()+" "+tmpComp+" "+fViewArr[targetDate].element.date.valueOf();DEBUG&&(console.log("[changeDate] _id:",_id,"logicOpts:",logicOpts),console.log("[changeDate] newDate:",newDate)),eval(logic)?$("#"+targetDate).datepicker("setValue",newDate):""===$this.val()?$this.attr("logic-date",newDate.getTime()):(newDate=new Date($this.val()),$this.datepicker("setValue",newDate),$this.removeClass("invalid").trigger("change"))}}else{if($this.attr("data-maxdate"))switch($this.attr("data-maxdate").toLowerCase()){case"today":nowTemp=new Date,maxDate=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0),_options.onRender=function(e){return e.valueOf()>maxDate.valueOf()?"disabled":""}}if($this.attr("data-mindate"))switch($this.attr("data-mindate").toLowerCase()){case"today":nowTemp=new Date,maxDate=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0),_options.onRender=function(e){return e.valueOf()<maxDate.valueOf()?"disabled":""};break;default:if(null!=$this.attr("data-mindate").match(/^\d+$/)){var numDays=parseInt($this.attr("data-mindate")),numDaysPlusWeekend=numDays;nowTemp=new Date;for(var jsWeekend=[0,6],i=1;i<=numDaysPlusWeekend;i++)nowTemp.setDate(nowTemp.getDate()+1),_.indexOf(jsWeekend,nowTemp.getDay())>=0&&numDaysPlusWeekend++;5===nowTemp.getDay()&&nowTemp.setDate(nowTemp.getDate()+2),maxDate=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0),_options.onRender=function(e){return e.valueOf()<nowTemp.valueOf()?"disabled":""}}else(nowTemp=moment($this.attr("data-mindate"),"MM/DD/YYYY"))&&nowTemp.isValid()&&(maxDate=new Date(nowTemp.year(),nowTemp.month(),nowTemp.date(),0,0,0,0),_options.onRender=function(e){return e.valueOf()<maxDate.valueOf()?"disabled":""})}}var optionsRender=$this.attr("data-options-render");DEBUG&&console.log("_options:",_options,"optionsRender:",optionsRender);var $dpicker=$this.datepicker(_options).on("changeDate",function(e){var t=$(e.currentTarget),a=t.attr("id");DEBUG&&console.log("_id [changeDate]",_id,"dateId:",a),fViewArr&&fViewArr[a]&&fViewArr[a].changeDate&&"function"==typeof fViewArr[a].changeDate&&(DEBUG&&console.log("e:",e),fViewArr[a].changeDate(e)),t.removeClass("invalid").trigger("change"),t.datepicker("hide")}).on("click",function(e){var t=$this.attr("logic-date"),a=$this.val(),o=$(e.currentTarget);t&&""!==t&&!a&&""===a&&o.datepicker("setValue",t),DEBUG&&console.log("[click] $currentTarget:",o,"logicDate:",t),$("div.datepicker.dropdown-menu").css("display","none"),o.datepicker("show")});$dpicker=$dpicker.data("datepicker"),fViewArr&&(fViewArr[_id]||(fViewArr[_id]={element:null}),fViewArr[_id].element=$dpicker,LUT_ALL_DATE_PICKER[_id]=$dpicker),DEBUG&&(console.log("_id:",_id),console.log("$dpicker:",$dpicker,"<--------","element",$dpicker.element))}),DEBUG&&(console.log("    SetUp .datepicker:"),console.log(fViewArr))},setupSpinner:function(e,t){t=t||null,$(".spinner",e).each(function(){var e=$(":input.spinner-input",this),a=void 0!==e.attr("data-default-value")?e.attr("data-default-value"):1,o=""!==e.val()?e.val():a;if(t&&"create"===t&&"0"===o){var r=parseFloat(a);isNaN(r)&&(r=1),o=a&&""!==a&&!isNaN(r)?r.toString():"1"}var n={value:parseInt(o,10),min:a};$(this).spinner(n)})},preventSpace:function(e){if(32===e.keyCode)return e.preventDefault(),!1},allowNumber:function(e){var t=$(e.currentTarget).val();if(8===e.keyCode||37===e.keyCode||39===e.keyCode||46===e.keyCode||9===e.keyCode)return!0;(e.shiftKey||(46!==e.keyCode&&190!==e.keyCode&&110!==e.keyCode||-1!==t.indexOf("."))&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105))&&e.preventDefault()},allowRational:function(e){var t=$(e.currentTarget).val();if(8===e.keyCode||37===e.keyCode||39===e.keyCode||46===e.keyCode||9===e.keyCode)return!0;(45!==e.keyCode&&109!==e.keyCode&&189!==e.keyCode||""!==t)&&(e.shiftKey||(46!==e.keyCode&&190!==e.keyCode&&110!==e.keyCode||-1!==t.indexOf("."))&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105))&&e.preventDefault()},allowNaturalNumber:function(e){if(8===e.keyCode||37===e.keyCode||39===e.keyCode||46===e.keyCode||9===e.keyCode)return!0;(e.shiftKey||46!==e.keyCode&&110!==e.keyCode&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)||48===e.keyCode&&0===$(e.currentTarget).val().length)&&e.preventDefault()},allowWholeNumber:function(e){var t=$(e.currentTarget).val();if(48===e.keyCode){if(!t||0===t.length)return!0;if(t.length>0&&"0"===t)return void e.preventDefault()}if(8===e.keyCode||37===e.keyCode||39===e.keyCode||46===e.keyCode||9===e.keyCode)return!0;(e.shiftKey||46!==e.keyCode&&110!==e.keyCode&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)||48===e.keyCode&&0===$(e.currentTarget).val().length)&&e.preventDefault()},allowZipCode:function(e){if(8===e.keyCode||37===e.keyCode||39===e.keyCode||46===e.keyCode||9===e.keyCode)return!0;(e.shiftKey||e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)&&e.preventDefault()},allowPhoneNumber:function(e){var t=$(e.currentTarget),a=t.val();if("keydown"===e.type&&e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){switch(a.length){case 0:if(48===e.keyCode||105===e.keyCode)return void e.preventDefault();t.val("("+a);break;case 4:t.val(a+") ");break;case 9:t.val(a+"-")}e.update&&t.val(t.val()+String.fromCharCode(e.keyCode))}else switch(e.type){case"focusout":var o=a.replace(/[^0-9]+/gi,""),r=o.length;o=r<1?"":r<3?o.replace(/(\d{1,2})/gi,"($1"):3===r?o.replace(/(\d{3})/gi,"($1)"):r<=6?o.replace(/(\d{3})(\d{1,3})?/gi,"($1) $2"):o.replace(/(\d{3})(\d{3})?(\d{1,4})?/gi,"($1) $2-$3"),t.val(o)}},allowSocialSecurity:function(e){var t=$(e.currentTarget),a=t.val();if("keydown"===e.type&&e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){switch(a.length){case 3:case 6:t.val(a+"-")}e.update&&t.val(t.val()+String.fromCharCode(e.keyCode))}else switch(e.type){case"focusout":var o=a.replace(/[^0-9]+/gi,""),r=o.length;o=r<=3?o.replace(/(\d{1,3})?/gi,"$1"):r<=5?o.replace(/(\d{3})(\d{1,2})?/gi,"$1-$2"):o.replace(/(\d{3})(\d{2})?(\d{1,4})?/gi,"$1-$2-$3"),t.val(o)}},allowZipCodePlusFour:function(e){var t=$(e.target),a=t.val(),o="";if("keydown"===e.type&&e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){switch(a.length){case 0:if(48===e.keyCode||105===e.keyCode)return void e.preventDefault();break;case 5:t.val(a+"-")}e.update&&t.val(t.val()+String.fromCharCode(e.keyCode))}else{for(var r=0,n=a.length;r<n;r++)isNaN(parseInt(a[r]))||(o+=a[r]);a="";for(var r=0,n=o.length;r<n;r++){switch(r){case 5:n>6&&(a+="-")}a+=o[r]}t.val(a)}},getHumanTime:function(e){var t="object"!=typeof e?new Date(1e3*e):new Date(e.$date),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=t.getFullYear(),r=a[t.getMonth()],n=t.getDate(),i=t.getHours(),l=t.getMinutes(),s=t.getSeconds(),c="AM";return i>=12&&(i-=12,0===i&&(i=12),c="PM"),i<10&&(i="0"+i),l<10&&(l="0"+l),s<10&&(s="0"+s),r+" "+n+", "+o+" "+i+":"+l+":"+s+" "+c},getSpecialFieldsName:function(e,t){var a=[];switch(t.toLowerCase()){case"fullname":a.push(e+"_fullname_first_name"),a.push(e+"_fullname_middle_name"),a.push(e+"_fullname_last_name");break;case"address":a.push(e+"_address_street"),a.push(e+"_address_city"),a.push(e+"_address_state"),a.push(e+"_address_zip"),a.push(e+"_address_country"),a.push(e+"_address_street_number"),a.push(e+"_address_unit_number");break;default:a.push(e)}return a},setFieldsValues:function(e,t,a,o){o=o||!1,_.each(a,function(a,r){var n=o&&o[r]?o[r]:"",i=$(':input[name="'+a+'"]',e).val(n).trigger("change");t.set(a,n),t.isValid(a)&&i.removeClass("invalid")})},setupClassAttr:function(e,t){if(e=e||!1,t=t||"",t.toLowerCase(),e){e=e.toLowerCase();return new RegExp(t,"i").test(e)?e:e+" "+t}return t},genericSetup:function(e){var t=e.$el;this.setupCounty(t)},finalSetup:function(e){var t=this,a=$("select.has-default-val",e.el),o=$(e.el);"update"===e.options.mode&&e._visibleOn.length>0&&e.options.formData&&setValueDependOn(e.el,e._visibleOn,e.options.formData),"create"===e.options.mode&&a.length>0&&a.each(function(){var e=$('option[selected=""],option[selected="selected"]',this);e.length>0&&""!==e.val()?$(this).val(e.val()):$(this).hasClass("us-state")?$(this).val("NV"):$(this).hasClass("us-country")&&$(this).val("US")}),e._multiFiles.length>0&&_.each(e._multiFiles,function(a){require(["views/file-upload/multifiles"],function(o){Vm.create(t,"MultiFilesView"+a.name,o,{field:a,name:e.el,model:e.model,validation:e.options.formSchema.validation}).render()})}),$("a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]").each(function(){var e=$(this);$("<img>",{src:e.attr("href"),error:function(){e.hide(),e.next(".lightbox-fallback").show()}})}),e._ajaxDataCall.length>0&&this.setupAjaxCall(e,o),e._hasUserId&&this.setupUserIdAjaxCall(o),e._hasBooleanInput&&this.setupBooleanInput(o,e),e._hasRadioBtnGroup&&(this.setupRadioBtnGroup(o),this.setupRadioBtnGroupValue(o)),(e._hasSelectAllCheckBox||e._hasClearAllCheckBox)&&this.setupCheckBoxSelectAndClear(o),e._hasOtherTextBox&&this.setupCheckBoxOtherTextBox(o),e._radioFieldName.length&&this.setupRadioButtonsValue(e),e._buttonDecision.length>0&&_.each(e._buttonDecision,function(a){var r=$("a#"+a.name,e.el),n='<input type="hidden" name="'+a.name+'" id="'+a.name+'_btn_condition"/>';if(!a.url||!a.data)throw"ButtonDecision require Url and Data options!";if("update"===e.options.mode&&(r.after(n),e.options.formData.fields[a.name]&&r.next('input[type="hidden"]').val(e.options.formData.fields[a.name]).trigger("change")),!0===e.options.internal){var i=r.parents(".control-group");return i.length>0?i.hide():r.hide(),!0}r.click(function(r){r.preventDefault();var i=$(r.currentTarget);if(i.attr("disabled"))return!1;var l,s=a.url+"?",c={},d=!1,u=[],p=a.options.datacanempty?a.options.datacanempty:[],f=a.options.events||function(r){var s=$("#"+a.name+"_btn_condition",o);if(r.status&&"error"===r.status)return i.attr("disabled",!1).popover("destroy"),i.next(".popover").remove(),l={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-edit"></i> Error',content:r.error_message},i.attr("disabled",!0).popover(l).popover("show"),window.setTimeout(function(){i.attr("disabled",!1).popover("destroy"),i.next(".popover").remove()},3e3),!1;if(!r.value)throw'Result JSON must have "value" key';0===s.length&&i.after(n),a.options.renderresult&&r.data?(e.model.set(a.name,""),require(["views/subform-layouts/buttondecision"],function(o){Vm.create(t,a.name+"View",o,{model:e.model,el:i,name:a.name}).render(r.data)})):(i.parent().find("div.btn-decision-data-wrapper").remove(),e.model.set(a.name,r.value)),window.setTimeout(function(){i.attr("disabled",!1).popover("destroy"),i.next(".popover").remove()},1e3)};if(_.each(a.data,function(a,o){if("string"!=typeof a){"boolean"==typeof d&&(d=[]);var r;_.each(a,function(a,o){r=t.setUpButtonDecision(a,o,c,e.el,p,u)}),d.push(r)}else d=t.setUpButtonDecision(a,o,c,e.el,p)}),"boolean"!=typeof d&&d.indexOf(!1)>-1&&(d=!1),d)return l={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-edit"></i> Error',content:"Please complete the required fields"},i.attr("disabled",!0).popover(l).popover("show"),window.setTimeout(function(){i.attr("disabled",!1).popover("destroy"),i.next(".popover").remove()},2e3),!1;_.each(u,function(e){e.removeClass("invalid")}),s+=$.param(c);var h,m;switch(e.options.lang){case"sp":h="Por Favor Espere",m="Bajando Informaci&oacute;n";break;default:h="Please wait",m="Loading data"}l={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-time"></i> '+h+".",content:'<i class="icon-spinner icon-spin icon-large"></i> '+m+" ..."},i.attr("disabled",!0).popover(l).popover("show"),$.getJSON(s,f)})})},isRenderVisibleOn:function(e,t,a){if(t.options&&t.options.visibleon&&("html"!==a||t.options.visibleon.forcerenderonread)){var o=t.options.visibleon.name;if(o.match(/\[\]$/gi)&&(o=o.substr(0,o.length-2)),_.isArray(e.options.formData.fields[o])){var r=!1;if(_.each(e.options.formData.fields[o],function(e){r||(r=-1!==t.options.visibleon.values.indexOf(e))}),!r)return!1}else{var n;if(n=e._lookupValues&&e._lookupValues[o]?e._lookupValues[o].value:e.options.formData.fields[o],-1===t.options.visibleon.values.indexOf(n))return!1}}return!0},finalReadSetup:function(e){var t=$(e.el);if(!t.length)throw"[x] finalReadSetup: could not be able to find form.";var a=e.options.formData._id.$oid;if("string"!=typeof a||""===a)throw"FormID is invalid. Requires a valid string.";var o=humane.create({baseCls:"humane-bigbox",timeout:3e3,clickToClose:!1,waitForMove:!1});o.error=o.spawn({addnCls:"humane-bigbox-error"}),t.on("click",".update-on-read-mode",function(e){var t=$(e.currentTarget);if(t.hasClass("ajax")){if(t.hasClass("is-radio")||t.hasClass("is-clickable"))return;return e.preventDefault(),!1}e.preventDefault(),t.addClass("ajax");var r=new FormModel({id:a});return r.fetch({success:function(){var e=r.get("Fields"),a=t.attr("data-field-name");if("string"!=typeof a||""===a)throw"Could not be able to find Field Name.";var o=t.find(':input[name="'+a+'"]');if(!o.length)throw'Error: Could not be able to find input name "'+a+'".';if(void 0===e[a])throw'Response: Field "'+a+'" is invalid.';var n=t.find("#"+a);if(!n.length)throw'Error: Could not be able to find span for "'+a+'".';n.html(e[a]).fadeOut("slow",function(){if(o.hasClass("force-hide"))o.val(e[a]),o.hide(function(){o.removeClass("force-hide").fadeIn("slow",function(){o.focus(),o.val(""),o.val(e[a])})});else if(o.hasClass("has-field-container")){var r=o.closest(".force-hide");if(!r.length)throw"Could not be able to find "+o.attr("name")+" wrapper.";r.removeClass("force-hide").fadeIn("slow",function(){var r=e[a];if(o.hasClass("is-date-picker")||o.focus(),o.val(""),o.hasClass("is-date-picker")&&r&&r.$date){
var n=new Date(r.$date);o.val(n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear())}else o.val(r);t.addClass("is-clickable"),o.hasClass("is-date-picker")&&o.datepicker()})}else{if(!o.is(":radio"))throw console&&console.error&&console.error(o),"Not Implement Advance Update On Read Mode Type.";var n=o.closest(".force-hide");if(!n.length)throw"Could not be able to find "+o.attr("name")+" wrapper.";n.removeClass("force-hide").fadeIn("slow",function(){o.attr("checked",!1),o.filter('[value="'+e[a]+'"]').attr("checked",!0),t.addClass("is-radio")})}})},error:function(){console&&console.error&&(console.error('[x] Error getting "'+a+'"'),console.error(arguments)),o.error("Error: Could not get data."),setTimeout(function(){t.removeClass("ajax")},3e3)}}),!1}),e._buttonClipboards.length>0&&_.each(e._buttonClipboards,function(e){$("button#"+e.name).zclip({path:"//public.southernnevadahealthdistrict.org/assets/js/apps/formrender/libs/copy/ZeroClipboard.swf",copy:function(){var t="";return _.each(e.values,function(e){t+=$("#"+e).text()+"\r\n"}),t}})}),$("a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]").each(function(){var e=$(this);$("<img>",{src:e.attr("href"),error:function(){e.hide(),e.next(".lightbox-fallback").show()}})});var r=$('[data-popover-confirm^="{"]',e.el);r.length&&(t.on("click",".btn-confirmed",function(e){e.preventDefault();var t=$(this),a=t.attr("data-href")||!1;if(!a)return void r.each(function(e){$(this).popover("hide")});r.each(function(e){$(this).popover("destroy")}),window.location=a}),r.each(function(e){var t=$(this),a=$.parseJSON(t.attr("data-popover-confirm"));t.popover(a).click(function(t){t.preventDefault(),r.each(function(t){t!==e&&$(this).popover("hide")})})})),t.on("click",".btn-auto-refresh",function(e){var t=$(e.target).attr("data-refresh-delay");e.stopPropagation(),setTimeout(function(){location.reload()},t)});var n=$("table.stupidtable").stupidtable();n.length&&n.on("aftertablesort",function(e,t){var a=$(this).find("th");a.find(".dir-icon").remove();var o="asc"===t.direction?"icon-arrow-up":"icon-arrow-down";a.eq(t.column).append('<i class="dir-icon '+o+'" style="position:relative; left: 10px; top: -3px;"></i>')}),$(".select-tags").each(function(){var e=$(this),t=0;e.find("li").each(function(){var e=$(this),a=e.outerWidth(!0);a>t&&(t=a)}).width(t)}),this.setupFileRepositoryEvent(t),this.setupPopover(t),this.setupCreateUserViewModal(t,e),this.setupWebcamWithCrop(t,e),this.addWebcamEvent(t,e)},setupCreateUserViewModal:function(e,t){if(e&&e.length&&t&&t.options.formData&&t.options.formData.externalcreateuserdata){var a=e.find(".form-actions");if(a&&a.length){var o=a.find(".btn.external-created-user-modal-btn");if(!o||!o.length){var r=t.options.formData.externalcreateuserdata,n=_.template(externalCreateUserDataTemplate);a.append(n({data:r}));var i;a.find("#module-external-create-user-data-btn").click(function(e){e&&e.preventDefault&&e.preventDefault(),i.modal("toggle")}),i=a.find("#module-external-create-user-data-modal").modal({backdrop:"static",show:!1,keyboard:!0})}}}},isRenderReadMode:function(e,t){var a=["buttonclipboard","filerepository","image"],o=t.type.toLowerCase();if("html"===o&&("internal"in t.options||(t.options.internal=!1)),t.options.internal&&t.options.internal!==e.options.internal)return!1;if(_.indexOf(a,o)>-1)return!0;if(""===e.options.formData.fields[t.name])return!1;if("fullname"===o){var r=this.getSpecialFieldsName(t.name,t.type),n=!1;return _.each(r,function(t){!n&&e.options.formData.fields[t]&&""!==e.options.formData.fields[t]&&(n=!0)}),n}if(void 0===e.options.formData.fields[t.name]){if(t&&t.options&&t.options.visibleon&&t.options.visibleon.forcerenderonread)return!0;switch(o){case"fieldsetstart":case"fieldsetend":case"html":case"action":case"submit":case"clear":case"address":break;case"button":var i=t.description.toLowerCase();if(e.options.internal&&"read"===e.options.mode&&"delete"===i&&e.options.formSchema.deleteenabled){if(!e.options.formData.createddate.$date)throw'In order to used "DeleteEnabled", form data must have "CreatedDate".';if(e.options.formSchema.deleteenabled.fieldexists){var l=e.options.formSchema.deleteenabled.fieldexists;if(!e.options.formData.fields[l])return!1}if(e.options.formSchema.deleteenabled.afterxdays){var s=new Date,c=new Date(e.options.formData.createddate.$date);if(this.calculateDateDiffByDays(s,c)<e.options.formSchema.deleteenabled.afterxdays)return!1}}break;default:return!1}}return!0},resetPlaceHolderValue:function(e){$(":input.placeholder",e).each(function(){var e=$(this);e.attr("placeholder")===e.val()&&e.val("")})},createHiddenForm:function(e){require(["views/hiddenForm"],function(t){Vm.create({},"FormView",t).render(e)})},setupAjaxCall:function(e,t){_.each(e._ajaxDataCall,function(e){var a=e.type.toLowerCase(),o=[],r={};if(void 0===e.options.data)throw"In order to use ajax call, we need Options.Data.";switch(_.each(e.options.data,function(e){_.each(e,function(e){r[e]=""})}),a){case"fullname":o.push(e.name+"_fullname_first_name"),o.push(e.name+"_fullname_middle_name"),o.push(e.name+"_fullname_last_name");break;default:o.push(e.name)}_.each(o,function(a){t.on("change",':input[name="'+a+'"]',function(t){var o=$(this),n=o.val(),i=!1;if(""!==n&&(r[a]=n),_.each(r,function(e,t){""===e&&(i=!0)}),!i){var l={},s=e.options.url+"?";_.each(e.options.data,function(e){_.each(e,function(e,t){l[t]=r[e]})}),$.getJSON(s+$.param(l),function(e){e.data&&_.each(e.data,function(e,t){if(void 0===r[t]){var a,o=$(':input[name="'+t+'"]').val(e).trigger("change");if("hidden"===o.attr("type")&&(a=o.parent(".emailpicker"),a.length>0)){var n=e.split("@");$(":input.not_sending",a).each(function(e,t){$(t).val(n[e])})}}})})}})})})},setUpButtonDecision:function(e,t,a,o,r,n){r=r||[],n=n||!1;var i,l,s=$("#"+e),c=s.parent(".birthday-picker"),d=!1;c.length>0&&(i=$(".not_sending",c).trigger("change"));var u=s.val();if(""!==u&&-1===u.search(/NaN/)||r.indexOf(t)>-1)a[t]=u;else if(d=!0,l=$(':input[name="'+e+'"]',o).addClass("invalid"),n&&n.push(l),c.length>0){var p=u.split("/");_.each(p,function(e,t){"NaN"===e&&(l=$(i[t]).addClass("invalid"),n&&n.push(l))})}return d},setupUrlAjaxCall:function(e,t,a){t=t||null,a=a||null;var o=t||$(":input[data-url]"),r=this;0!==o.length&&o.attr("data-url")&&o.each(function(){var t=$(this),n=t.attr("data-url");if(!t.hasClass("tags")){var i=r.parseTemplateString(n);if(a){var l=a.get(t.attr("name"));l&&""!==l&&t.attr("data-select-value",l)}if(i){var s=r.parseTemplateStringGet(n);if(s){var c={};_.each(s,function(e){var t=e.split("=");2===t.length&&(c[t[0]]=t[1])})}if(!t.select2)throw'Error: select2 is not yet loaded. Please refresh this page again! (Setup "'+t.attr("id")+'"")';var d='<input type="hidden" name="'+t.attr("name")+'" id="'+t.attr("id")+'" class="'+t.attr("class")+' has-select2-dynamic" />',u=t.attr("data-select-key-value"),p=t.attr("data-select-key-text"),f=t.attr("data-select-value");t.replaceWith(d),t=$(':input[name="'+t.attr("name")+'"]'),f&&t.val(f);var h={url:n.match(/^(\w|\.|\/|:|-)+\(?/gi).shift(),data:function(e,t){var a=c||{};return _.each(i,function(t){var o,r=t.split("="),n=r.pop().replace(/(\{\{|\}\})/gi,"");switch(n){case"this":o=e;break;default:o=$(':input[name="'+n+'"]').val()}a[r]=o}),a},results:function(e,a){if(u||p){var o=[];_.each(e,function(e){var a={};u&&p?(a.id=e[u],a.text=e[p]):u?(a.id=e[u],a.text=e.text):p&&(a.id=e.id,a.text=e[p]),_.isEmpty(a)||(t.hasClass("tolowercase")&&a.id&&a.text&&a.id.toLowerCase&&a.text.toLowerCase&&(a.id=a.id.toLowerCase()),o.push(a))}),e=o}return{more:!1,results:e}}},m={placeholder:"--- Please Select ---",minimumInputLength:3,initSelection:function(e,t){f&&$.ajax({url:h.url,data:h.data(f),success:function(e,a,o){if(1===e.length){var r=e.pop(),n={};u&&p?(n.id=r[u],n.text=r[p]):u?(n.id=r[u],n.text=r.text):p&&(n.id=r.id,n.text=r[p]),t(n)}else t({id:f,text:f})},error:function(e,a,o){t({id:f,text:f})}})},ajax:h};t.select2(m)}else if(!t.hasClass("send-ajax-request")){t.addClass("send-ajax-request");var v=t.find("option").html();t.find("option").remove(),t.append('<option value="">--- Loading Data ---</option>'),$.ajax({url:n,dataType:"json",success:function(n,i){if("success"===i){var l='<option value="">'+v+"</option>",s=o.prop("type"),c=[],d=t.attr("data-select-value");switch(s){case"select-multiple":case"select-one":t.find("option").remove()}if(_.each(n,function(e){var a;switch(s){case"select-multiple":case"select-one":_.isObject(e)&&e.id&&e.text?(a=d&&d===e.id?" selected ":"",l+='<option value="'+e.id+'" '+a+">"+e.text+"</option>"):(a=d&&d===e?" selected ":"",l+='<option value="'+e+'" '+a+">"+e+"</option>");break;default:c.push(e[t.attr("id")])}}),c.length){t.attr({autocomplete:"off"}),t.typeahead({minLength:3,source:c});var u=function(a){t.removeClass("attached-change");var o=t.val(),i=_.find(n,function(e){if(o===e[t.attr("id")])return!0}),l=!0;i&&_.each(i,function(a,o){if(""!==a)if("object"==typeof a){var n;a.length?(_.some(a[0],function(e,t){return n=t.split("_").shift(),!0}),$("#subform_"+n,e).trigger("subform_"+n+".ajaxUpdate",[a])):a.data&&a.view&&a.title&&(_.some(a.data[0],function(e,t){return n=t.split("_").shift(),!0}),l=!1,require(["views/"+a.view+"AjaxView"],function(i){var l={$form:e,collection:new Backbone.Collection(a.data),id:o+"_AjaxView",$input:t,input_callback:u,title:a.title,listName:n};Vm.create(r,"AjaxView",i,l).render()}))}else{var i=$(':input[name="'+o+'"]',e);i&&i.val(a).trigger("change")}}),l&&!t.hasClass("attached-change")&&(t.addClass("attached-change"),t.one("change",u))};t.hasClass("attached-change")||(t.addClass("attached-change"),t.one("change",u))}else{t.append(l);var p={containerCssClass:"span12"},f=t.attr("data-select-value"),h=t.attr("multiple");f&&h&&t.val(f.split(",")),h&&(a&&a.toJSON,t.attr("name",t.attr("name")+"[]")),t.select2(p),$("#s2id_"+t.attr("id")+" .select2-drop",e).hide()}t.trigger("dataloaded")}},error:function(e,a,o){alert('Error: when trying to request AJAX data to "'+n+'" for "'+t.attr("id")+'". Please try again.')}})}}})},setupSelect2:function(e,t){function a(e,t){e.hasClass("tags")?Select2Helper.renderTags(e,t):Select2Helper.render(e,t)}if(e)if(e.el){var o=t||e.el;_.isString(o)||(o=$(o).attr("id"))&&(o="#"+o),$(o+" .selecttwo-render").each(function(){var t=$(this);a(t,e)})}else if(e.find){var r=e.find(".selecttwo-render");r.length&&a(r,e)}else console&&console.warn&&console.warn("Not set up Select2.")},setupCheckBoxSelectAndClear:function(e){e.on("click",".checkbox-container button",function(e){e.preventDefault();var t=$(e.target),a=t.closest(".checkbox-container"),o=a.find("input:checkbox");t.hasClass("btn-primary")?(o.prop("checked",!0),o.filter(".checkbox-other").click().prop("checked",!0)):(o.prop("checked",!1),o.filter(".checkbox-other").click().prop("checked",!1))})},setupCheckBoxOtherTextBox:function(e){e.on("click",'.checkbox-container input[type="checkbox"].checkbox-other',function(e){var t=$(e.target),a=t.parent().next(".other-textbox");t.is(":checked")?a.removeClass("not_sending").show("slow"):a.addClass("not_sending").hide("slow")})},setupBooleanInput:function(e,t){e.on("click",".form-render_booleaninput button",function(e){var t,a=$(this),o=a.attr("data-value"),r=a.attr("data-id");$("#"+r,a.parent()).removeClass("invalid").val(o).trigger("change"),t='<span class="text-'+("true"===o?"success":"error")+'">'+a.html()+"<span>",a.parent().next().html(t).show("slow")}),$('.form-render_booleaninput input[type="hidden"]',e).each(function(){var e=$(this),t=e.val();if(""!==t)switch(t){case!0:case"true":e.parent().find("button.btn-yes").click();break;case!1:case"false":e.parent().find("button.btn-no").click()}})},setupRadioBtnGroup:function(e,t){t=t||null;if(e.hasClass("attached-e-radio-container")||(e.on("click",".radio-container button",function(e){e.preventDefault();var a=$(e.target),o=a.attr("value"),r=a.closest(".radio-container"),n=r.find('input[type="hidden"]'),i=n.attr("name");n.val(o).trigger("change"),t&&t.has&&t.has(i)&&t.set(i,n.val());var l=r.find(':button[value="'+o+'"]');r.find(".radio-value-render").html(l.html()).show("slow")}),e.addClass("attached-e-radio-container")),e.find(".radio-container").each(function(){var e=$(this),t=e.find('input[type="hidden"]'),a=$.trim(t.val());""!==a&&e.find('button[value="'+a+'"]').trigger("click")}),t&&t.toJSON){var a=t.toJSON();_.each(a,function(t,a){if("string"==typeof a&&t){var o=e.find(".radio-container #"+a);if(o.length){if(o.val())return;var r=o.closest(".btn-group"),n=r.find('button[value="'+t+'"]');n.length&&n.click()}}})}},setupRadioBtnGroupValue:function(e){$(".radio-container input.has-default-val",e).each(function(){var e=$(this),t=e.closest(".radio-container").find('button[value="'+e.val()+'"]');t?t.addClass("active"):e.val(""),e.removeClass("has-default-val")})},setupUserIdAjaxCall:function(e){var t=$(":input.userid-lookup",e),a=this;t.each(function(){var e=$(this);e.is("select")?e.is("[data-url]")?$.getJSON(e.attr("data-url"),function(t,o){if("success"===o){var r="";_.each(t,function(e){r+='<option value="'+e.Id+'">'+e.Username+"</option>"}),e.append(r),e.select2({containerCssClass:"span12"}).on("change",function(t){t.val&&""!==t.val&&e.removeClass("invalid")})}else a.setUpErrorNotice(e,"Please refresh this page!",1e4)}):e.select2({containerCssClass:"span12"}):$(this).change(function(e){var t=$(this),o=t.val(),r=t.attr("data-url")||"/user?$filter=Username eq ",n={dataType:"json",complete:function(e,o){if(t.removeAttr("data-send"),!t.hasClass("invalid"))if("success"===o){var r=$.parseJSON(e.responseText);switch(typeof r){case"boolean":r&&(t.addClass("invalid").val(""),a.setUpErrorNotice(t,'Username "'+t.val()+'" is already existed!'))}}else a.setUpErrorNotice(t,"Could not get information!")}};if(""!==o){if(-1===r.search(/\?/)&&(r+="?"),"undefined"!=typeof username&&(n.username=username,n.password=password),t.is("[data-url-data]")){var i="",l=$.parseJSON(t.attr("data-url-data"));_.each(l,function(e,t){i+=t+"="+$(':input[name="'+e+'"]').val()+"&"}),i=encodeURI(i.substr(0,i.length-1)),r+=i}n.url=r,t.is("[data-send]")||(t.attr("data-send",!0),$.ajax(n))}})})},setupAddressEvent:function(e,t){var a=$("form",e);if(a.on("change",".country",function(e){e.preventDefault();var t=$(this),a=t.parentsUntil("form","div.address-fieldset"),o=a.find("select.us-state"),r=a.find("input.us-state"),n=a.find("input.postal-code"),i=t.val();if(i!==t.attr("data-value"))switch(t.attr("data-value",i),i){case"":case"US":o.is(":hidden")&&r.attr("disabled",!0).hide("slow",function(){o.attr("disabled",!1).show("slow")}),n.hasClass("allowzipcodeplusfour")||n.addClass("allowzipcode").attr("maxlength",5);break;default:r.is(":hidden")&&o.attr("disabled",!0).hide("slow",function(){r.attr("disabled",!1).val("").show("slow"),r.is("[data-default-value]")&&r.val(r.attr("data-default-value")).removeAttr("data-default-value")}),n.removeClass("allowzipcode").removeAttr("maxlength")}}),"update"===t.options.mode){$("div.address-fieldset",a).each(function(){$(this);$(".country",this).trigger("change")})}},setUpErrorNotice:function(e,t,a,o){o=o||"en",a=a||3e3,t=t||"";var r,n;switch(o){case"sp":r="Error",n="Por favor, vuelve a intentarlo";break;default:r="Error",n="Please try again."}var i={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-edit"></i> '+r+".",content:'<i class="icon-spinner icon-spin icon-large"></i> '+n+" ..."+(""!==t?"<br>"+t:"")};e.attr("disabled",!0).popover(i).popover("show"),window.setTimeout(function(){e.attr("disabled",!1).popover("destroy"),e.next(".popover").remove()},a)},parseInternalFieldsBeforeSubmit:function(e,t){var a;t.length&&_.each(t,function(t){var o=$(':input[name="'+t+'"]',e);o.length&&(a=t.match(/\[\]$/gi),a=a?t.substr(0,t.length-2)+"_internal[]":t+"_internal",o.attr("name",a))})},setupPopover:function(e){$('[data-toggle="popover"]',e).popover()},destroyPopover:function(e){$('[data-toggle="popover"]',e).popover("destroy")},calculateDateDiffByDays:function(e,t){var a=e.getTime(),o=t.getTime(),r=Math.abs(a-o);return Math.round(r/864e5)},convertDataToArrayString:function(e){var t=["value-as-array"];_.each(t,function(t){var a=$(":input."+t,e);a.each(function(){var e=$(this),t=a.val();t=t&&""!==t?t.split(","):[],e.val(JSON.stringify(t))})})},convertNumberToDecimal:function(e){e.find(":input[data-decimal]").each(function(){var e=$(this),t=e.val(),a=parseInt(e.attr("data-decimal"),10);t*=Math.pow(10,a),e.val(parseInt(t,10))})},setupRadioButtonsValue:function(e){e.options.formData&&e.options.formData.fields&&_.each(e._radioFieldName,function(t){if(e.options.formData.fields[t]){$(':radio[name="'+t+'"]').filter('[value="'+e.options.formData.fields[t]+'"]').attr("checked",!0).trigger("change")}})},setupRadioButtonsValueWithModel:function(e,t){var a=e.model;a&&_.each(t,function(e,t){var o=a.get(e);$(':radio[name="'+e+'"]').filter('[value="'+o+'"]').attr("checked",!0).trigger("change")})},performCalculateLogic:function(e,t){function a(e,t,a,r){if(a=$.trim(a),r&&(r=$.trim(r)),r)switch(r){case"day":var n,i;e&&(n=moment(e,"MM/DD/YYYY"),n.isValid()&&(e=n.valueOf())),t&&(i=moment(t,"MM/DD/YYYY"),i.isValid()&&(t=i.valueOf()));break;default:console&&console.error&&console.error("- calculated:"+r+" is not implement yet!")}o&&(console.log("- val1: ",e),console.log("- val2: ",t));var l;switch(a){case"+":l=e+t;break;case"-":l=e-t;break;case"*":l=e*t;break;case"/":l=e/t;break;default:throw new Error("Not implement "+a+" yet!")}if(o&&console.log("- result: ",l),r)switch(r){case"day":l=l/1e3/60/60/24,l=Math.ceil(l)}return o&&console.log("- result: ",l),l}var o=!1,r=e.find(":input:hidden[data-logic]");o&&(console.log("*** performCalculateLogic ***"),console.log(r),console.log(e),console.log(t)),r&&r.length&&r.each(function(){var e=$(this),t=e.attr("data-logic"),r=e.attr("data-type");r&&(r=r.toLowerCase()),o&&(console.log("- logic: ",t),console.log("- type: ",r));var n=t.match(/(\S+)\s+(\S+)\s+(\S+)/);o&&console.log("- matches: ",n);var i,l,s,c;if(n){if(4!==n.length)throw new Error("Does not know how to calulate! ("+t+")");s=$.trim(n[2]),i=$("#"+n[1]).val(),l=$("#"+n[3]).val(),o&&(console.log("- firstEl: ",i),console.log("- secondEl: ",l)),c=a(i,l,s,r),o&&console.log("- _result: ",c),e.val(c).trigger("change")}})},setModelButtonRadioValues:function(e,t,a){t=t||null;var o=e.find(".radio-container");o.length&&o.each(function(){var e=$(this).find('.btn-group :input[data-field-type="is-buttons-radio"]');e&&e.length&&e.each(function(){var e=$(this);e.trigger("change");var a=e.val();if(t&&t.model){var o=e.attr("name");t.model.set(o,a)}})})},setModelRadioValues:function(e,t,a){DEBUG=!1,t=t||null;var o=e.find(":radio.invalid");o.length&&o.removeClass("invalid"),DEBUG&&(console.log("***** setModelRadioValues *****"),console.log(e,t));var r=e.find(":radio:checked");r.length&&(DEBUG&&(console.log("[*] Debug - setModelRadioValues"),console.log(r),console.log(t),console.log(t.model),console.log(t.model.toJSON())),r.each(function(){try{var e=$(this);if(DEBUG&&(console.log(e),console.log("- before update model values:",t.model.toJSON())),e.attr("checked",!0).trigger("change"),t&&t.model){var a=e.attr("name"),o=e.val();DEBUG&&console.log('    Model["'+a+'"] : '+t.model.get(a)),t.model.set(a,o)}}catch(e){console&&console.log&&(console.log("[x] Exception in setModelRadioValues"),console.log(e))}}))},setModelCheckValues:function(e,t){t=t||null;var a=e.find(":checkbox:checked");a.length&&a.each(function(){try{var e=$(this);if(e.attr("checked",!0).trigger("change"),t&&t.model){var a=e.attr("name"),o=e.val();t.model.set(a,o)}}catch(e){console&&console.log&&(console.log("[x] Exception in setModelCheckValues"),console.log(e))}})},setDefaultMultiFile:function(e,t){if(t&&t.options&&"update"===t.options.mode){var a=t.model;if(a&&a.multiFilesDefaultValue&&!_.isEmpty(a.multiFilesDefaultValue)){var o=a.multiFilesDefaultValue;_.each(o,function(e,t){if(a.has(t)){a.get(t)||a.set(t,e)}})}}},formatAMPM:function(e){var t=e.getHours(),a=e.getMinutes(),o=t>=12?"PM":"AM";return t%=12,t=t||12,a=a<10?"0"+a:a,t+":"+a+" "+o},addFormSubmittedData:function(e,t){if(e.name&&"LogEntries"===e.name&&t.options.formData.fields){var a={LogMessage:"Form submitted",LogTime:t.options.formData.createddate&&t.options.formData.createddate.$date?t.options.formData.createddate.$date/1e3:null,LogUser:t.options.formData.createduser?t.options.formData.createduser:null};t.options.formData.fields[e.name]||(t.options.formData.fields[e.name]=[]),t.options.formData.fields[e.name].unshift(a)}},getUserIdFormHtml:function(e){if(!(e=e||null))return $("#snhd_user_network_login").text().toLowerCase()},shouldRenderWithShowOnStatusOrShowOnMode:function(e,t,a){return!(e.options.showonstatus&&_.indexOf(e.options.showonstatus,t)<0)&&!(e.options.showonmode&&_.indexOf(e.options.showonmode,a)<0)},shouldRenderShowOnUser:function(e){if(!e.options||!e.options.showonuser)return!0;if(!_.isArray(e.options.showonuser))throw"In order to use Options.ShowOnUser for "+e.type+' with "'+e.name+'" required an array!';var t=this.getUserIdFormHtml();if(t&&""!==t){var a=t.replace("cchd\\","");if(a&&_.indexOf(e.options.showonuser,a)>-1)return!0}return!1},validateCheckBox:function(e){var t=!0;try{e.find('.checkbox-container[data-check-required="true"]').each(function(){var e=$(this),a=e.find("label.checkbox");e.find(":checked").length?a.removeClass("invalid"):(a.addClass("invalid"),t=!1)})}catch(e){console&&console.log&&(console.log("[x] Error: validateCheckBox"),console.log(e)),t=!1}return t},validateBooleanInput:function(e){var t=!0;try{e.find('.form-render_booleaninput input[type="hidden"].invalid').each(function(){t=!1;$(this).closest(".form-render_booleaninput").next().html('<span class="text-error">Please answer this question.</span>').show("slow")})}catch(e){console&&console.log&&(console.log("[x] Error: validateBooleanInput"),console.log(e)),t=!1}return t},resetSelectsOption:function(e){e&&e.length&&e.each(function(){var e=$(this),t=e.val();(_.isNull(t)||""===t)&&e.removeAttr("selected")})},formatUriSegment:function(e,t){if(!(t=t||null))return void(console&&console.log&&console.log('[x] formData is null in "formatUriSegment".'));var a=e.match(/{\w+}/gi);return _.each(a,function(a){switch(a){case"{id}":if(!t||!t._id||!t._id.$oid)throw"formatUriSegment could not find _id.$oid.";e=e.replace(a,t._id.$oid)}}),e},setupFileRepositoryEvent:function(e){var t=this;if(!e.length)throw"setupFileRepositoryEvent form not found.";e.on("hidden",".filerepository-form-wrapper",function(){$(this).find(":input").removeClass("invalid").each(function(){$(this).val("")})}).on("click",".filerepository-button",function(e){return e.preventDefault(),$(e.currentTarget).closest(".filerepository-wrapper").find(".filerepository-form-wrapper").modal("show"),!1}).on("click",".filerepository-form-wrapper .btn-submit-filerepository",function(e){e.preventDefault();var a=$(e.currentTarget).closest(".filerepository-form-wrapper"),o=a.find(".filerepository-form"),r=$(":input",o),n=!1;return r.each(function(){var e=$(this),t=e.val(),a=!1;t&&""!==t||(a=!0,n=!0),a?e.addClass("invalid"):e.removeClass("invalid")}),!n&&(a.find(".modal-footer").find(".btn").fadeOut(),a.find(".modal-body .alert").html('<i class="icon-spinner icon-spin icon-large"></i> Sending information, please wait.'),t.buildFormAppendToBody(r.parent(),a.attr("data-url")),!1)})},setupCounty:function(e){var t=e.find(".select2-county");if(!$().select2)throw"Select 2 is not found!";t.each(function(){$(this).select2()});var a=e.find(".select2-county-lookup");"string"==typeof countyData&&(countyData=$.parseJSON(countyData)),a.each(function(){var t=$(this),a=t.attr("data-filterbyid");t.select2(),e.on("change","#"+a,function(){var e=$(this),a=e.val();if(t.attr("data-state")!==a){var o='<option value="">-- Select County in '+a+" --</option>";_.each(countyData[a],function(e){o+='<option value="'+e+'">'+e+"</option>"}),t.val(""),t.select2("val",""),t.select2("destroy"),t.empty().append(o),t.select2(),t.val(""),t.select2("val",""),t.select2("open"),t.select2("close"),t.attr("data-state",a)}});var o=$("#"+a,e),r=o.val();r&&""!==r&&o.trigger("change");var n=t.attr("data-countyvalue");n&&""!==n&&(t.select2("destroy"),t.select2(),t.select2("val",n))})},buildFormAppendToBody:function(e,t){if(!t||""===t||"string"!=typeof t)throw"Expected url to be a valid string.";var a=$('<form action="'+t+'" method="POST" enctype="multipart/form-data"></form>');a.append(e),a.appendTo("body"),a.submit()},finalSetupAllMode:function(e){if(!$(e.el).length)throw"[x] finalSetupAllMode: could not be able to find form."},showHumaneSuccessBox:function(e,t){humane.create({baseCls:"humane-jackedup",addnCls:"humane-jackedup-success",timeout:3e3,clickToClose:!1,waitForMove:!1}).log(e,t)},showHumaneErrorBox:function(e,t){var a=humane.create({baseCls:"humane-bigbox",timeout:3e3,clickToClose:!1,waitForMove:!1});a.error=a.spawn({addnCls:"humane-bigbox-error"}),a.error(e,t)},formatDateAsString:function(e,t){t=t||null;var a=new Date(e);if(!t)return a.toUTCString();var o=a.getMonth()+1;o<10&&(o="0"+o);var r=a.getDate();switch(r<10&&(r="0"+r),t){case"m/d/Y":return o+"/"+r+"/"+a.getFullYear();default:throw"Not Implement "+t+' yet in "formatDateAsString"!'}},sortNumber:function(e,t){return e-t},focusOnFirstInput:function(e){e=e||null;var t;e.$el&&(t=e.$el.find("form:first").find("input:visible:enabled:first")),t&&t.length&&!t.is(":radio")&&!t.is(":checkbox")&&(t.focus(),t.hasClass("datepicker")&&t.datepicker("hide"))},scrollToTop:function(){document.body.scrollTop=document.documentElement.scrollTop=0},getText:getText,Base64:getBase64(),humanFileSize:humanFileSize,getModelValueForViewModel:getModelValueForViewModel,convertDataURIToBlob:convertDataURIToBlob,addWebcamEvent:function(e,t){function a(){c.one("hidden",function(){setTimeout(function(){d.modal("show")},1200)}),c.modal("hide")}function o(){d.one("hidden",function(){setTimeout(function(){c.modal("show")},1200)}),d.modal("hide")}function r(e){i&&(console.log("- fieldName:",h),console.log("- mongoId:",v),console.log("- endpointUrl:",m)),$.ajax({url:m,method:"POST",data:{FieldName:h,MongoId:v,Data:e,Internal:g},success:function(){i&&console.log("- sendPhotoData: success",arguments),location.reload(!0)},error:function(){i&&console.log("- sendPhotoData: error",arguments),p.html('<div class="alert alert-danger">Error, please try again.</div>'),setTimeout(function(){u.modal("hide")},2e3)}})}var n=e.find(".form-render-has-webcam");if(n&&n.length){var i=!1,l=_.template(webcamTemplate);e.append(l());var s=e.find("#formrender-webcam-canvas"),c=e.find("#formrender-webcam-modal"),d=e.find("#formrender-webcam-modal-crop"),u=e.find("#formrender-webcam-modal-notification"),p=u.find(".message"),f={backdrop:"static",show:!1};c.modal(f),d.modal(f),u.modal(f),WebCam.set({width:320,height:240,image_format:"jpeg",jpeg_quality:90});var h,m,v,g,w,b=!1,y=!1;c.on("shown",function(){b||(b=!0,WebCam.attach("#formrender-my-camera"))}),d.on("shown",function(){y||(i&&console.log("- Start Cropper:",s[0]),y=!0,w=new Cropper(s[0],{aspectRatio:1,autoCrop:!0}))}),d.on("hidden",function(){i&&console.log("- Remove Cropper"),w&&(w.reset(),w=null),y=!1}),u.on("hidden",function(){p.text("")}),$("body").on("click",".form-render-has-webcam-wrapper .take-snapshot",function(e){e&&e.preventDefault&&e.preventDefault(),i&&console.log("click");var t=$(this),a=t.parent().parent(),o=a.find(".form-render-has-webcam");if(v=o.attr("data-mongo-id"),h=o.attr("data-field-name"),m=o.attr("data-webcam-url"),g=o.attr("data-internal"),g=g&&"true"===g,!v)throw Error("No Mongo ID Found!");if(!h)throw Error("No Field Name Found!");if(!m)throw Error("No End point Found!");c.modal("show")}),$("body").on("click","#formrender-webcam-modal .formrender-webcam-take-snapshot",function(e){e&&e.preventDefault&&e.preventDefault(),i&&console.log("- WebCam:",WebCam),WebCam.snap(a,s[0])}),$("body").on("click","#formrender-webcam-modal-crop .formrender-webcam-retake-snapshot",function(e){e&&e.preventDefault&&e.preventDefault(),o()}),$("body").on("click","#formrender-webcam-modal-crop .formrender-webcam-process-image",function(e){e&&e.preventDefault&&e.preventDefault(),i&&console.log("- start sending data");var t=s[0].cropper.getCroppedCanvas().toDataURL("image/jpeg");d.one("hidden",function(){setTimeout(function(){if(p.html('<div class="alert alert-success">Sending Data, please wait...</div>'),u.modal("show"),!t)throw console.error(s),Error("Please try again!!!");r(t)},1200)}),d.modal("hide")})}},setupWebcamWithCrop:function(e,t){var a=e.find(".form-render-has-webcam");if(a&&a.length){a.each(function(){var e=$(this),t=e.parent(),a=t.find(".form-render-has-webcam-wrapper");a&&a.length||t.append('<div class="form-render-has-webcam-wrapper"><button class="form-render-has-webcam take-snapshot btn btn-primary">Open Webcam</button></div>')})}},isMobileDevice:isMobileDevice}});