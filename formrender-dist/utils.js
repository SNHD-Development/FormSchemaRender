define(["jquery","underscore","backbone","vm","humane","models/form","select2helper","text!data/county.json","bootstrap","jquery.select2","jquery.spinner","jquery.birthdaypicker","jquery.placeholder","jquery.expose","jquery.zclip","jquery.stupidtable","xdr"],function($,_,Backbone,Vm,humane,FormModel,Select2Helper,countyData){function setValueDependOn(e,t,n){_.each(t,function(t){n.fields[t.name]&&($(e).on("visibleOnRenderComplete",':input[name="'+t.name+'"]',function(){var e=$(this);!e.is(":radio")&&!e.is(":checkbox")?e.val(n.fields[t.name]).trigger("change"):e.val()===n.fields[t.name]&&e.prop("checked",!0)}),$(':input[name="'+t.options.visibleon.name+'"]').trigger("change"))})}var DEBUG=!1;return{config:{fileUrl:"/form/getFile",internalViewUrl:"/Form/SingleView"},renderError:function(e,t){e.html('<div class="alert alert-danger"><i class="icon-wrench"></i> <strong>Error: Please refresh this page and try again.</strong> <br> '+t+"</div>")},checkBrowser:function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=parseInt(RegExp.$1);e<7&&(e=7),$("body").addClass("ie"+e)}},setupOldBrowser:function(){Object.keys=Object.keys||function(e){var t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push(n);return t},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;n++)n in this&&e.call(t,this[n],n,this)})},ucwords:function(e){return(e+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(e){return e.toUpperCase()})},htmlspecialchars:function(e,t,n,r){var i=0,s=0,o=!1;if(typeof t=="undefined"||t===null)t=2;e=e.toString(),r!==!1&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var u={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};t===0&&(o=!0);if(typeof t!="number"){t=[].concat(t);for(s=0;s<t.length;s++)u[t[s]]===0?o=!0:u[t[s]]&&(i|=u[t[s]]);t=i}return t&u.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),o||(e=e.replace(/"/g,"&quot;")),e},htmlspecialchars_decode:function(e,t){var n=0,r=0,i=!1;typeof t=="undefined"&&(t=2),e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var s={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};t===0&&(i=!0);if(typeof t!="number"){t=[].concat(t);for(r=0;r<t.length;r++)s[t[r]]===0?i=!0:s[t[r]]&&(n|=s[t[r]]);t=n}return t&s.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),i||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&"),e},parseTemplateString:function(e){var t=/\w+=\{\{(\w|\.)+\}\}/ig;return e.match(t)},parseTemplateStringGet:function(e){var t=/\w+=(\w|\.)+/ig;return e.match(t)},parseTemplateStringCurlyBrace:function(e){var t=/\{\{([\w|\.]+)\}\}/ig,n=e.match(t);if(n){RegExp.$1&&(n=RegExp.$1);if(n.indexOf("{")>-1)throw"Still Found Curly Brace in the string in parseTemplateStringCurlyBrace!"}return n},changeURLGetTemplateString:function(e){var t=!1;t&&console.log("[*] --- changeURLGetTemplateString ---");var n=e,r=this.parseTemplateString(n);if(r)for(var i in r){var s=r[i],o;t&&(console.log("[*] Token"),console.log(s)),o=this.parseTemplateStringCurlyBrace(s);if(!o)continue;t&&console.log(o);if(!o)throw'Unexpected changeURLGetTemplateString, found more than one template variable for "'+s+'"';switch(o){case"userid":n=n.replace("{{"+o+"}}",this.getUserIdFormHtml());break;default:console&&console.info&&console.info('[x] Info: Not Implement this "'+o+'" Url Template Variable yet!')}}return n},checkRequireFields:function(e,t){var n;switch(e.type.toLowerCase()){case"multifiles":n=e.name+"[]";if(typeof t[n]!="undefined"&&t[n].required)return!0;return!1;case"address":n=e.name+"_address_street";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_address_city";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_address_state";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_address_zip";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_address_country";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_address_street_number";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_address_unit_number";if(typeof t[n]!="undefined"&&t[n].required)return!0;return!1;case"fullname":n=e.name+"_fullname_middle_name";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_fullname_first_name";if(typeof t[n]!="undefined"&&t[n].required)return!0;n=e.name+"_fullname_last_name";if(typeof t[n]!="undefined"&&t[n].required)return!0;return!1}return typeof t[e.name]!="undefined"&&t[e.name].required?!0:!1},preValidate:function(e,t){var n=$(e.currentTarget),r=n.attr("name"),i=n.is(":file"),s;if(n.closest(".subform-button-wrapper").length)return;s=i?n.val():$.trim(n.val()),i||(n.hasClass("tolowercase")&&(s=s.toLowerCase(),s=s.replace(/^([0-9]\w+)|\s+([0-9]\w+)/g,function(e){return e.toUpperCase()}),s=s.replace(/^(us\s)|\s+(us)\s/gi,function(e){return e.toUpperCase()})),n.hasClass("toucwords")?s=this.ucwords(s):n.hasClass("touppercase")&&s.toUpperCase&&(s=s.toUpperCase()),n.hasClass("allowedonespace")&&s.replace&&(s=s.replace(/ +(?= )/g,"")),n.val(s).trigger("change")),t.set(r,s),t.isValid(r,s)?n.removeClass("invalid"):n.addClass("invalid")},setupPlaceHolder:function(e){$("input, textarea",e).placeholder()},setupFileInput:function(e){$(":file",e).trigger("change")},setupEmailInput:function(e){$(".emailpicker",e).each(function(){var e=$(".emailpicker_server",this),t=$(".emailpicker_username",this),n=$(':input[type="hidden"]',this),r=$(".not_sending",this);typeof e.attr("data-value")!="undefined"&&e.attr("data-value")&&e.val(e.attr("data-value")).trigger("change");if(n.val()!==""){var i=n.val().split("@");i.length===2&&(t.val(i[0]).trigger("change"),e.val(i[1]).trigger("change"))}$(".emailpicker_server, .emailpicker_username",this).on("change",this,function(r){t.val()!==""&&e.val()!==""?n.val($.trim(t.val()+"@"+e.val())).trigger("change"):n.val("").trigger("change")}).on("keydown",function(e){if(e.keyCode===32)return e.preventDefault(),!1})})},setupBDateInput:function(e,t,n){n=n||!1,$(".birthdaypicker",e).each(function(){var e=$(this).attr("data-options");n&&e&&(e&&typeof e=="string"&&(e=$.parseJSON(e)),e&&e.id&&t.get(e.id)&&(e.defaultdate=t.get(e.id))),$(this).birthdaypicker(e);var r=$(':input[type="hidden"]',this),i,s,o,u,a=r.val();a!==""&&t.get(r.attr("name"))!==""&&(i=a.split("/"),i.length===3&&(i[0][0]==="0"&&(i[0]=i[0].substr(1)),i[1][0]==="0"&&(i[1]=i[1].substr(1)),s=$(".birth-month",this).val(i[0]),o=$(".birth-day",this).val(i[1]),u=$(".birth-year",this).val(i[2]),t.set(s.attr("name"),i[0]),t.set(o.attr("name"),i[1]),t.set(u.attr("name"),i[2])))})},setHiddenField:function(e){$(':hidden[data-value!=""]',e).each(function(){var e=$(this);typeof e.attr("data-value")!="undefined"&&e.attr("data-value")&&e.val(e.attr("data-value")).trigger("change")})},getBDateinput:function(e,t){$("fieldset.birthday-picker",e).each(function(){var e=/NaN/i,n=$(':input[type="hidden"]',this),r=$(".not_sending.birth-day",this),i=$(".not_sending.birth-month",this),s=$(".not_sending.birth-year",this),o=parseInt(r.val()),u=parseInt(i.val()),a=parseInt(s.val()),f=!1,l;String(o).match(e)&&(r.val(""),f=!0),String(u).match(e)&&(i.val(""),f=!0),String(a).match(e)&&(s.val(""),f=!0),f?n.val(""):(u<10&&(u+=0+u),o<10&&(o+=0+o),l=u+"/"+o+"/"+a,n.val()),t.set(n.attr("name"),n.val())})},getUserId:function(e,t){var n=$(".select2-offscreen",e);n.each(function(){var e=$(this);t.set(e.attr("name"),e.val()).trigger("change")})},getDefaultValues:function(e,t){var n=!1;n&&console.log("[*] Debug - getDefaultValues"),t=t||null,n&&t&&console.log("    Before: .has-default-val"),$(".has-default-val",e).each(function(){var e=$(this);n&&console.log(e);if(e.is(":disabled"))return;e.val()===""?e.trigger("change"):e.hasClass("data-clean")&&e.trigger("change").removeClass("data-clean")}),n&&t&&console.log("    After: .has-default-val"),n&&t&&console.log("    Before: :hidden"),$(":hidden:input",e).each(function(){var e=$(this),r=e.val(),i=e.attr("name");n&&console.log(e);if(!i||i==="")return;if(e.is(":radio")||e.is(":checkbox"))return;n&&console.log("    Before Set: "+i+" with "+r),i&&r&&r!==""&&t&&(n&&t&&console.log("    Before Set: "+i+" with "+r),t.set(i,r))}),n&&t&&console.log("    After: :hidden")},setupDateInput:function(el,view){var DEBUG=!1,fViewArr,firstTime=!1;view&&(view.formView&&view.formView._DatePickerLogicArr?(fViewArr=view.formView._DatePickerLogicArr,firstTime=!0):view._DatePickerLogicArr&&(fViewArr=view._DatePickerLogicArr)),DEBUG&&(console.log("[*] utils.setupDateInput"),console.log(el),console.log(view),console.log(fViewArr));var _model;view&&view.model&&(_model=view.model);var $allDatepicker=$(".datepicker",el);DEBUG&&(_model&&_model.toJSON&&console.log(_model.toJSON()),console.log("    Found: "+$allDatepicker.length),console.log($allDatepicker)),$allDatepicker.each(function(){var _options={},maxDate,nowTemp,$this=$(this),_id=$this.attr("name"),hasDatepickerOptions=$this.has("data-has-datepicker-options");if(_model&&_model.get){var _tmpVal=_model.get(_id);if(_tmpVal&&_tmpVal.$date){_tmpVal=moment(_tmpVal.$date);if(!_tmpVal.isValid())throw new Error('Could not be able to parse this date data "'+_id+'".');$this.val(_tmpVal.format("MM/DD/YYYY"))}}DEBUG&&(console.log("   Loop: .datepicker"),console.log(_id),console.log($this),fViewArr&&fViewArr[_id]&&console.log(fViewArr[_id]),console.log(hasDatepickerOptions));if(fViewArr&&fViewArr[_id]&&fViewArr[_id].getvaluefrom&&fViewArr[_id].comparison){var logicOpts=fViewArr[_id];if(!logicOpts.getvaluefrom)throw'In order to use setupDateInput with "DatepickerOptions". Required to have "GetValueFrom" key! ('+_id+")";if(!logicOpts.comparison)throw'In order to use setupDateInput with "DatepickerOptions". Required to have "Comparison" key! ('+_id+")";_options.onRender=function(date){var targetDate=logicOpts.getvaluefrom;if(!fViewArr[targetDate]||!fViewArr[targetDate].element)return;var _cmd,_today;return $this.attr("data-maxdate")?(_today=new Date,_cmd=fViewArr[targetDate].element.date.valueOf()+" "+logicOpts.comparison+"  "+date.valueOf()+" || "+date.valueOf()+"  > "+_today.getTime()+" ? 'disabled' : ''"):$this.attr("data-mindate")?(_today=new Date,_cmd=fViewArr[targetDate].element.date.valueOf()+" "+logicOpts.comparison+"  "+date.valueOf()+" || "+date.valueOf()+"  < "+_today.getTime()+" ? 'disabled' : ''"):_cmd=fViewArr[targetDate].element.date.valueOf()+" "+logicOpts.comparison+" "+date.valueOf()+" ? 'disabled' : ''",eval(_cmd)},fViewArr[logicOpts.getvaluefrom]||(fViewArr[logicOpts.getvaluefrom]={}),fViewArr[logicOpts.getvaluefrom].changeDate=function(ev){var targetDate=_id,tmpComp=logicOpts.comparison.substr(0,1),newDate=new Date(ev.date),logic=ev.date.valueOf()+" "+tmpComp+" "+fViewArr[targetDate].element.date.valueOf();eval(logic)?$("#"+targetDate).datepicker("setValue",newDate):$this.val()===""?$this.attr("logic-date",newDate.getTime()):(newDate=new Date($this.val()),$this.datepicker("setValue",newDate),$this.removeClass("invalid").trigger("change"))}}else{if($this.attr("data-maxdate"))switch($this.attr("data-maxdate").toLowerCase()){case"today":nowTemp=new Date,maxDate=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0),_options.onRender=function(e){return e.valueOf()>maxDate.valueOf()?"disabled":""}}if($this.attr("data-mindate"))switch($this.attr("data-mindate").toLowerCase()){case"today":nowTemp=new Date,maxDate=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0),_options.onRender=function(e){return e.valueOf()<maxDate.valueOf()?"disabled":""}}}var $dpicker=$this.datepicker(_options).on("changeDate",function(e){var t=$(e.currentTarget),n=t.attr("id");fViewArr&&fViewArr[n]&&fViewArr[n].changeDate&&typeof fViewArr[n].changeDate=="function"&&fViewArr[n].changeDate(e),t.removeClass("invalid").trigger("change"),t.datepicker("hide")}).on("click",function(e){var t=$this.attr("logic-date"),n=$this.val(),r=$(e.currentTarget);t&&t!==""&&!n&&n===""&&r.datepicker("setValue",t),$("div.datepicker.dropdown-menu").css("display","none"),r.datepicker("show")});$dpicker=$dpicker.data("datepicker"),fViewArr&&(fViewArr[_id]||(fViewArr[_id]={element:null}),fViewArr[_id].element=$dpicker)}),DEBUG&&(console.log("    SetUp .datepicker"),console.log(fViewArr))},setupSpinner:function(e,t){t=t||null,$(".spinner",e).each(function(){var e=$(":input.spinner-input",this),n=e.attr("data-default-value")!==undefined?e.attr("data-default-value"):1,r=e.val()!==""?e.val():n;if(t&&t==="create"&&r==="0"){var i=parseFloat(n);isNaN(i)&&(i=1),n&&n!==""&&!isNaN(i)?r=i.toString():r="1"}var s={value:parseInt(r,10),min:n};$(this).spinner(s)})},preventSpace:function(e){if(e.keyCode===32)return e.preventDefault(),!1},allowNumber:function(e){var t=$(e.currentTarget).val();if(e.keyCode===8||e.keyCode===37||e.keyCode===39||e.keyCode===46||e.keyCode===9)return!0;(e.shiftKey||(e.keyCode!==46&&e.keyCode!==190&&e.keyCode!==110||t.indexOf(".")!==-1)&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105))&&e.preventDefault()},allowRational:function(e){var t=$(e.currentTarget).val();if(e.keyCode===8||e.keyCode===37||e.keyCode===39||e.keyCode===46||e.keyCode===9)return!0;(e.keyCode!==45&&e.keyCode!==109&&e.keyCode!==189||t!=="")&&(e.shiftKey||(e.keyCode!==46&&e.keyCode!==190&&e.keyCode!==110||t.indexOf(".")!==-1)&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105))&&e.preventDefault()},allowNaturalNumber:function(e){if(e.keyCode===8||e.keyCode===37||e.keyCode===39||e.keyCode===46||e.keyCode===9)return!0;(e.shiftKey||e.keyCode!==46&&e.keyCode!==110&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)||e.keyCode===48&&$(e.currentTarget).val().length===0)&&e.preventDefault()},allowWholeNumber:function(e){var t=$(e.currentTarget).val();if(e.keyCode===48){if(!t||t.length===0)return!0;if(t.length>0&&t==="0"){e.preventDefault();return}}if(e.keyCode===8||e.keyCode===37||e.keyCode===39||e.keyCode===46||e.keyCode===9)return!0;(e.shiftKey||e.keyCode!==46&&e.keyCode!==110&&(e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)||e.keyCode===48&&$(e.currentTarget).val().length===0)&&e.preventDefault()},allowZipCode:function(e){if(e.keyCode===8||e.keyCode===37||e.keyCode===39||e.keyCode===46||e.keyCode===9)return!0;(e.shiftKey||e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)&&e.preventDefault()},allowPhoneNumber:function(e){var t=!1,n=$(e.currentTarget),r=n.val(),i="";t&&(console.log("*** allowPhoneNumber ["+e.type+"] ***"),console.log(e.keyCode));if(e.type==="keydown"&&e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){t&&(console.log("[x] keydown"),console.log(r.length),console.log(r));switch(r.length){case 0:if(e.keyCode===48||e.keyCode===105){e.preventDefault();return}n.val("("+r);break;case 4:n.val(r+") ");break;case 9:n.val(r+"-")}e.update&&n.val(n.val()+String.fromCharCode(e.keyCode))}else switch(e.type){case"focusout":var s=r.replace(/[^0-9]+/ig,""),o=s.length;t&&console.log(s),o<1?s="":o<3?s=s.replace(/(\d{1,2})/ig,"($1"):o===3?s=s.replace(/(\d{3})/ig,"($1)"):o<=6?s=s.replace(/(\d{3})(\d{1,3})?/ig,"($1) $2"):s=s.replace(/(\d{3})(\d{3})?(\d{1,4})?/ig,"($1) $2-$3"),t&&(console.log(o),console.log(r.replace(/[^0-9]+/ig,"")),console.log(s)),n.val(s)}},allowSocialSecurity:function(e){var t=!1,n=$(e.currentTarget),r=n.val(),i="";t&&(console.log("*** allowSocialSecurity ["+e.type+"] ***"),console.log(e.keyCode));if(e.type==="keydown"&&e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){t&&(console.log("[x] keydown"),console.log(r.length),console.log(r));switch(r.length){case 3:case 6:n.val(r+"-")}e.update&&n.val(n.val()+String.fromCharCode(e.keyCode))}else switch(e.type){case"focusout":var s=r.replace(/[^0-9]+/ig,""),o=s.length;t&&(console.log(s.length),console.log(s)),o<=3?s=s.replace(/(\d{1,3})?/ig,"$1"):o<=5?s=s.replace(/(\d{3})(\d{1,2})?/ig,"$1-$2"):s=s.replace(/(\d{3})(\d{2})?(\d{1,4})?/ig,"$1-$2-$3"),t&&(console.log(s.length),console.log(s)),n.val(s)}},allowZipCodePlusFour:function(e){var t=$(e.target),n=t.val(),r="";if(e.type==="keydown"&&e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){switch(n.length){case 0:if(e.keyCode===48||e.keyCode===105){e.preventDefault();return}break;case 5:t.val(n+"-")}e.update&&t.val(t.val()+String.fromCharCode(e.keyCode))}else{for(var i=0,s=n.length;i<s;i++)isNaN(parseInt(n[i]))||(r+=n[i]);n="";for(var i=0,s=r.length;i<s;i++){switch(i){case 5:s>6&&(n+="-")}n+=r[i]}t.val(n)}},getHumanTime:function(e){var t=typeof e!="object"?new Date(e*1e3):new Date(e.$date),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=t.getFullYear(),i=n[t.getMonth()],s=t.getDate(),o=t.getHours(),u=t.getMinutes(),a=t.getSeconds(),f="AM";return o>=12&&(o-=12,o===0&&(o=12),f="PM"),o<10&&(o="0"+o),u<10&&(u="0"+u),a<10&&(a="0"+a),i+" "+s+", "+r+" "+o+":"+u+":"+a+" "+f},getSpecialFieldsName:function(e,t){var n=[];switch(t.toLowerCase()){case"fullname":n.push(e+"_fullname_first_name"),n.push(e+"_fullname_middle_name"),n.push(e+"_fullname_last_name");break;case"address":n.push(e+"_address_street"),n.push(e+"_address_city"),n.push(e+"_address_state"),n.push(e+"_address_zip"),n.push(e+"_address_country"),n.push(e+"_address_street_number"),n.push(e+"_address_unit_number");break;default:n.push(e)}return n},setFieldsValues:function(e,t,n,r){r=r||!1,_.each(n,function(n,i){var s=r&&r[i]?r[i]:"",o=$(':input[name="'+n+'"]',e).val(s).trigger("change");t.set(n,s),t.isValid(n)&&o.removeClass("invalid")})},setupClassAttr:function(e,t){e=e||!1,t=t||"",t.toLowerCase();if(e){e=e.toLowerCase();var n=new RegExp(t,"i");return n.test(e)?e:e+" "+t}return t},genericSetup:function(e){var t=e.$el;this.setupCounty(t)},finalSetup:function(e){var t=this,n=$("select.has-default-val",e.el),r=$(e.el);e.options.mode==="update"&&e._visibleOn.length>0&&e.options.formData&&setValueDependOn(e.el,e._visibleOn,e.options.formData),e.options.mode==="create"&&n.length>0&&n.each(function(){var e=$('option[selected=""],option[selected="selected"]',this);e.length>0&&e.val()!==""?$(this).val(e.val()):$(this).hasClass("us-state")?$(this).val("NV"):$(this).hasClass("us-country")&&$(this).val("US")}),e._multiFiles.length>0&&_.each(e._multiFiles,function(n){require(["views/file-upload/multifiles"],function(r){var i=Vm.create(t,"MultiFilesView"+n.name,r,{field:n,name:e.el,model:e.model,validation:e.options.formSchema.validation});i.render()})}),$("a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]").each(function(){var e=$(this);$("<img>",{src:e.attr("href"),error:function(){e.hide(),e.next(".lightbox-fallback").show()}})}),e._ajaxDataCall.length>0&&this.setupAjaxCall(e,r),e._hasUserId&&this.setupUserIdAjaxCall(r),e._hasBooleanInput&&this.setupBooleanInput(r,e),e._hasRadioBtnGroup&&(this.setupRadioBtnGroup(r),this.setupRadioBtnGroupValue(r)),(e._hasSelectAllCheckBox||e._hasClearAllCheckBox)&&this.setupCheckBoxSelectAndClear(r),e._hasOtherTextBox&&this.setupCheckBoxOtherTextBox(r),e._radioFieldName.length&&this.setupRadioButtonsValue(e),e._buttonDecision.length>0&&_.each(e._buttonDecision,function(n){var i=$("a#"+n.name,e.el),s='<input type="hidden" name="'+n.name+'" id="'+n.name+'_btn_condition"/>';if(!n.url||!n.data)throw"ButtonDecision require Url and Data options!";e.options.mode==="update"&&(i.after(s),e.options.formData.fields[n.name]&&i.next('input[type="hidden"]').val(e.options.formData.fields[n.name]).trigger("change"));if(e.options.internal===!0){var o=i.parents(".control-group");return o.length>0?o.hide():i.hide(),!0}i.click(function(i){i.preventDefault();var o=$(i.currentTarget);if(o.attr("disabled"))return!1;var u=n.url+"?",a={},f=!1,l,c=[],h=n.options.datacanempty?n.options.datacanempty:[],p=n.options.events||function(i){var u=$("#"+n.name+"_btn_condition",r);if(i.status&&i.status==="error")return o.attr("disabled",!1).popover("destroy"),o.next(".popover").remove(),l={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-edit"></i> Error',content:i.error_message},o.attr("disabled",!0).popover(l).popover("show"),window.setTimeout(function(){o.attr("disabled",!1).popover("destroy"),o.next(".popover").remove()},3e3),!1;if(!i.value)throw'Result JSON must have "value" key';u.length===0&&o.after(s),n.options.renderresult&&i.data?(e.model.set(n.name,""),require(["views/subform-layouts/buttondecision"],function(r){var s=Vm.create(t,n.name+"View",r,{model:e.model,el:o,name:n.name});s.render(i.data)})):(o.parent().find("div.btn-decision-data-wrapper").remove(),e.model.set(n.name,i.value)),window.setTimeout(function(){o.attr("disabled",!1).popover("destroy"),o.next(".popover").remove()},1e3)};_.each(n.data,function(n,r){if(typeof n!="string"){typeof f=="boolean"&&(f=[]);var i;_.each(n,function(n,r){i=t.setUpButtonDecision(n,r,a,e.el,h,c)}),f.push(i)}else f=t.setUpButtonDecision(n,r,a,e.el,h)}),typeof f!="boolean"&&f.indexOf(!1)>-1&&(f=!1);if(f)return l={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-edit"></i> Error',content:"Please correct the form"},o.attr("disabled",!0).popover(l).popover("show"),window.setTimeout(function(){o.attr("disabled",!1).popover("destroy"),o.next(".popover").remove()},2e3),!1;_.each(c,function(e){e.removeClass("invalid")}),u+=$.param(a);var d,v;switch(e.options.lang){case"sp":d="Por Favor Espere",v="Bajando Informaci&oacute;n";break;default:d="Please wait",v="Loading data"}l={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-time"></i> '+d+".",content:'<i class="icon-spinner icon-spin icon-large"></i> '+v+" ..."},o.attr("disabled",!0).popover(l).popover("show"),$.getJSON(u,p)})})},isRenderVisibleOn:function(e,t,n){if(t.options.visibleon&&n!=="html"){var r=t.options.visibleon.name;r.match(/\[\]$/gi)&&(r=r.substr(0,r.length-2));if(_.isArray(e.options.formData.fields[r])){var i=!1;_.each(e.options.formData.fields[r],function(e){if(i)return;i=t.options.visibleon.values.indexOf(e)!==-1});if(!i)return!1}else{var s;e._lookupValues&&e._lookupValues[r]?s=e._lookupValues[r].value:s=e.options.formData.fields[r];if(t.options.visibleon.values.indexOf(s)===-1)return!1}}return!0},finalReadSetup:function(e){var t=$(e.el);if(!t.length)throw"[x] finalReadSetup: could not be able to find form.";var n=e.options.formData._id.$oid;if(typeof n!="string"||n==="")throw"FormID is invalid. Requires a valid string.";var r=3e3,i=humane.create({baseCls:"humane-bigbox",timeout:r,clickToClose:!1,waitForMove:!1});i.error=i.spawn({addnCls:"humane-bigbox-error"}),t.on("click",".update-on-read-mode",function(e){var t=$(e.currentTarget),s=!1;s&&(console.log("[*] finalReadSetup:click - update-on-read-mode"),console.log(arguments),console.log(t));if(t.hasClass("ajax")){if(t.hasClass("is-radio")||t.hasClass("is-clickable"))return;return e.preventDefault(),!1}e.preventDefault(),t.addClass("ajax");var o=new FormModel({id:n});return o.fetch({success:function(){var e=o.get("Fields");s&&(console.log('[*] Success getting "'+n+'"'),console.log(arguments),console.log(o.toJSON()),console.log(e));var r=t.attr("data-field-name");if(typeof r!="string"||r==="")throw"Could not be able to find Field Name.";var i=t.find(':input[name="'+r+'"]');if(!i.length)throw'Error: Could not be able to find input name "'+r+'".';if(typeof e[r]=="undefined")throw'Response: Field "'+r+'" is invalid.';var u=t.find("#"+r);if(!u.length)throw'Error: Could not be able to find span for "'+r+'".';u.html(e[r]).fadeOut("slow",function(){if(i.hasClass("force-hide"))i.val(e[r]),i.hide(function(){i.removeClass("force-hide").fadeIn("slow",function(){i.focus(),i.val(""),i.val(e[r])})});else if(i.hasClass("has-field-container")){var n=i.closest(".force-hide");if(!n.length)throw"Could not be able to find "+i.attr("name")+" wrapper.";n.removeClass("force-hide").fadeIn("slow",function(){var n=e[r];i.hasClass("is-date-picker")||i.focus(),i.val("");if(i.hasClass("is-date-picker")&&n&&n.$date){var s=new Date(n.$date);i.val(s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear())}else i.val(n);t.addClass("is-clickable"),i.hasClass("is-date-picker")&&i.datepicker()})}else{if(!i.is(":radio"))throw console&&console.error&&console.error(i),"Not Implement Advance Update On Read Mode Type.";var s=i.closest(".force-hide");if(!s.length)throw"Could not be able to find "+i.attr("name")+" wrapper.";s.removeClass("force-hide").fadeIn("slow",function(){i.attr("checked",!1),i.filter('[value="'+e[r]+'"]').attr("checked",!0),t.addClass("is-radio")})}})},error:function(){console&&console.error&&(console.error('[x] Error getting "'+n+'"'),console.error(arguments)),i.error("Error: Could not get data."),setTimeout(function(){t.removeClass("ajax")},r)}}),!1}),e._buttonClipboards.length>0&&_.each(e._buttonClipboards,function(e){$("button#"+e.name).zclip({path:"//public.southernnevadahealthdistrict.org/assets/js/apps/formrender/libs/copy/ZeroClipboard.swf",copy:function(){var t="";return _.each(e.values,function(e){t+=$("#"+e).text()+"\r\n"}),t}})}),$("a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]").each(function(){var e=$(this);$("<img>",{src:e.attr("href"),error:function(){e.hide(),e.next(".lightbox-fallback").show()}})});var s=$('[data-popover-confirm^="{"]',e.el);s.length&&(t.on("click",".btn-confirmed",function(e){e.preventDefault();var t=$(this),n=t.attr("data-href")||!1;if(!n){s.each(function(e){$(this).popover("hide")});return}s.each(function(e){$(this).popover("destroy")}),window.location=n}),s.each(function(e){var t=$(this),n=$.parseJSON(t.attr("data-popover-confirm"));t.popover(n).click(function(t){t.preventDefault(),s.each(function(t){if(t===e)return;$(this).popover("hide")})})})),t.on("click",".btn-auto-refresh",function(e){var t=$(e.target).attr("data-refresh-delay");e.stopPropagation(),setTimeout(function(){location.reload()},t)});var o=$("table.stupidtable").stupidtable();o.length&&o.on("aftertablesort",function(e,t){var n=$(this).find("th");n.find(".dir-icon").remove();var r=t.direction==="asc"?"icon-arrow-up":"icon-arrow-down";n.eq(t.column).append('<i class="dir-icon '+r+'" style="position:relative; left: 10px; top: -3px;"></i>')}),$(".select-tags").each(function(){var e=$(this),t=0;e.find("li").each(function(){var e=$(this),n=e.outerWidth(!0);n>t&&(t=n)}).width(t)}),this.setupFileRepositoryEvent(t)},isRenderReadMode:function(e,t){var n=["buttonclipboard","filerepository"],r=t.type.toLowerCase();if(t.options.internal&&t.options.internal!==e.options.internal)return!1;if(_.indexOf(n,r)>-1)return!0;if(e.options.formData.fields[t.name]==="")return!1;if(r==="fullname"){var i=this.getSpecialFieldsName(t.name,t.type),s=!1;return _.each(i,function(t){!s&&e.options.formData.fields[t]&&e.options.formData.fields[t]!==""&&(s=!0)}),s}if(typeof e.options.formData.fields[t.name]=="undefined")switch(r){case"fieldsetstart":case"fieldsetend":case"html":case"action":case"submit":case"clear":case"address":break;case"button":var o=t.description.toLowerCase();if(e.options.internal&&e.options.mode==="read"&&o==="delete"&&e.options.formSchema.deleteenabled){if(!e.options.formData.createddate.$date)throw'In order to used "DeleteEnabled", form data must have "CreatedDate".';if(e.options.formSchema.deleteenabled.fieldexists){var u=e.options.formSchema.deleteenabled.fieldexists;if(!e.options.formData.fields[u])return!1}if(e.options.formSchema.deleteenabled.afterxdays){var a=new Date,f=new Date(e.options.formData.createddate.$date),l=this.calculateDateDiffByDays(a,f);if(l<e.options.formSchema.deleteenabled.afterxdays)return!1}}break;default:return!1}return!0},resetPlaceHolderValue:function(e){var t=$(":input.placeholder",e);t.each(function(){var e=$(this);e.attr("placeholder")===e.val()&&e.val("")})},createHiddenForm:function(e){require(["views/hiddenForm"],function(t){var n=Vm.create({},"FormView",t);n.render(e)})},setupAjaxCall:function(e,t){_.each(e._ajaxDataCall,function(e){var n=e.type.toLowerCase(),r=[],i={};if(typeof e.options.data=="undefined")throw"In order to use ajax call, we need Options.Data.";_.each(e.options.data,function(e){_.each(e,function(e){i[e]=""})});switch(n){case"fullname":r.push(e.name+"_fullname_first_name"),r.push(e.name+"_fullname_middle_name"),r.push(e.name+"_fullname_last_name");break;default:r.push(e.name)}_.each(r,function(n){t.on("change",':input[name="'+n+'"]',function(t){var r=$(this),s=r.val(),o=!1;s!==""&&(i[n]=s),_.each(i,function(e,t){e===""&&(o=!0)});if(!o){var u={},a=e.options.url+"?";_.each(e.options.data,function(e){_.each(e,function(e,t){u[t]=i[e]})}),$.getJSON(a+$.param(u),function(e){e.data&&_.each(e.data,function(e,t){if(typeof i[t]=="undefined"){var n=$(':input[name="'+t+'"]').val(e).trigger("change"),r;if(n.attr("type")==="hidden"){r=n.parent(".emailpicker");if(r.length>0){var s=e.split("@");$(":input.not_sending",r).each(function(e,t){$(t).val(s[e])})}}}})})}})})})},setUpButtonDecision:function(e,t,n,r,i,s){i=i||[],s=s||!1;var o=$("#"+e),u=o.parent(".birthday-picker"),a,f=!1,l;u.length>0&&(a=$(".not_sending",u).trigger("change"));var c=o.val();if(c!==""&&c.search(/NaN/)===-1||i.indexOf(t)>-1)n[t]=c;else{f=!0,l=$(':input[name="'+e+'"]',r).addClass("invalid"),s&&s.push(l);if(u.length>0){var h=c.split("/");_.each(h,function(e,t){e==="NaN"&&(l=$(a[t]).addClass("invalid"),s&&s.push(l))})}}return f},setupUrlAjaxCall:function(e,t,n){var r=!1;r&&(console.log("[*] setupUrlAjaxCall"),console.log(arguments)),t=t||null,n=n||null;var i=t?t:$(":input[data-url]"),s=this;if(i.length===0||!i.attr("data-url"))return;i.each(function(){var t=$(this),o=t.attr("data-url");if(t.hasClass("tags"))return;r&&(console.log("- Element"),console.log(t),console.log(o));var u=s.parseTemplateString(o);r&&console.log(u);if(n){var a=n.get(t.attr("name"));a&&a!==""&&t.attr("data-select-value",a)}if(u){var f=s.parseTemplateStringGet(o);if(f){var l={};_.each(f,function(e){var t=e.split("=");if(t.length!==2)return;l[t[0]]=t[1]})}if(!t.select2)throw'Error: select2 is not yet loaded. Please refresh this page again! (Setup "'+t.attr("id")+'"")';var c='<input type="hidden" name="'+t.attr("name")+'" id="'+t.attr("id")+'" class="'+t.attr("class")+' has-select2-dynamic" />',h=t.attr("data-select-key-value"),p=t.attr("data-select-key-text"),d=t.attr("data-select-value");t.replaceWith(c),t=$(':input[name="'+t.attr("name")+'"]'),d&&t.val(d);var v={url:o.match(/^(\w|\.|\/|:)+\(?/ig).shift(),data:function(e,t){var n=l||{};return _.each(u,function(t){var r=t.split("="),i=r.pop().replace(/(\{\{|\}\})/ig,""),s;switch(i){case"this":s=e;break;default:var o=$(':input[name="'+i+'"]');s=o.val()}n[r]=s}),n},results:function(e,n){if(h||p){var r=[];_.each(e,function(e){var n={};h&&p?(n.id=e[h],n.text=e[p]):h?(n.id=e[h],n.text=e.text):p&&(n.id=e.id,n.text=e[p]),_.isEmpty(n)||(t.hasClass("tolowercase")&&n.id&&n.text&&n.id.toLowerCase&&n.text.toLowerCase&&(n.id=n.id.toLowerCase()),r.push(n))}),e=r}return{more:!1,results:e}}},m={placeholder:"--- Please Select ---",minimumInputLength:3,initSelection:function(e,t){d&&$.ajax({url:v.url,data:v.data(d),success:function(e,n,r){if(e.length===1){var i=e.pop(),s={};h&&p?(s.id=i[h],s.text=i[p]):h?(s.id=i[h],s.text=i.text):p&&(s.id=i.id,s.text=i[p]),t(s)}else t({id:d,text:d})},error:function(e,n,r){t({id:d,text:d})}})},ajax:v};t.select2(m)}else if(!t.hasClass("send-ajax-request")){r&&console.log("- about to send ajax."),t.addClass("send-ajax-request");var g=t.find("option").html();t.find("option").remove(),t.append('<option value="">--- Loading Data ---</option>'),$.ajax({url:o,dataType:"json",success:function(u,a){if(a==="success"){var f='<option value="">'+g+"</option>",l=i.prop("type"),c=[],h=t.attr("data-select-value");r&&(console.log("- response: "+o),console.log(l));switch(l){case"select-multiple":case"select-one":t.find("option").remove()}_.each(u,function(e){var n;switch(l){case"select-multiple":case"select-one":_.isObject(e)&&e.id&&e.text?(n=h&&h===e.id?" selected ":"",f+='<option value="'+e.id+'" '+n+">"+e.text+"</option>"):(n=h&&h===e?" selected ":"",f+='<option value="'+e+'" '+n+">"+e+"</option>");break;default:c.push(e[t.attr("id")])}}),r&&console.log(c);if(c.length){t.attr({autocomplete:"off"}),t.typeahead({minLength:3,source:c});var p=function(n){t.removeClass("attached-change");var r=t.val(),i=_.find(u,function(e){if(r===e[t.attr("id")])return!0}),o=!0;i&&_.each(i,function(n,r){if(n==="")return;if(typeof n=="object"){var i;n.length?(_.some(n[0],function(e,t){return i=t.split("_").shift(),!0}),$("#subform_"+i,e).trigger("subform_"+i+".ajaxUpdate",[n])):n.data&&n.view&&n.title&&(_.some(n.data[0],function(e,t){return i=t.split("_").shift(),!0}),o=!1,require(["views/"+n.view+"AjaxView"],function(o){var u={$form:e,collection:new Backbone.Collection(n.data),id:r+"_AjaxView",$input:t,input_callback:p,title:n.title,listName:i},a=Vm.create(s,"AjaxView",o,u);a.render()}))}else{var u=$(':input[name="'+r+'"]',e);u&&u.val(n).trigger("change")}}),o&&!t.hasClass("attached-change")&&(t.addClass("attached-change"),t.one("change",p))};t.hasClass("attached-change")||(t.addClass("attached-change"),t.one("change",p))}else{r&&console.log(t),t.append(f);var d={containerCssClass:"span12"},v=t.attr("data-select-value"),m=t.attr("multiple");v&&m&&t.val(v.split(",")),m&&(n&&n.toJSON,t.attr("name",t.attr("name")+"[]")),t.select2(d),$("#s2id_"+t.attr("id")+" .select2-drop",e).hide()}t.trigger("dataloaded")}},error:function(e,n,r){alert('Error: when trying to request AJAX data to "'+o+'" for "'+t.attr("id")+'". Please try again.')}})}})},setupSelect2:function(e){function n(e,t){e.hasClass("tags")?Select2Helper.renderTags(e,t):Select2Helper.render(e,t)}var t=!1;if(!e)return;t&&(console.log("[*] setupSelect2"),console.log(arguments));if(e.el){var r=e.el;_.isString(r)||(r=$(r).attr("id"),r&&(r="#"+r)),$(r+" .selecttwo-render").each(function(){var r=$(this);t&&console.log(r),n(r,e)})}else if(e.find){var i=e.find(".selecttwo-render");i.length&&n(i,e)}else console&&console.warn&&console.warn("Not set up Select2.")},setupCheckBoxSelectAndClear:function(e){e.on("click",".checkbox-container button",function(e){e.preventDefault();var t=$(e.target),n=t.closest(".checkbox-container"),r=n.find("input:checkbox");t.hasClass("btn-primary")?(r.prop("checked",!0),r.filter(".checkbox-other").click().prop("checked",!0)):(r.prop("checked",!1),r.filter(".checkbox-other").click().prop("checked",!1))})},setupCheckBoxOtherTextBox:function(e){e.on("click",'.checkbox-container input[type="checkbox"].checkbox-other',function(e){var t=$(e.target),n=t.parent().next(".other-textbox");t.is(":checked")?n.removeClass("not_sending").show("slow"):n.addClass("not_sending").hide("slow")})},setupBooleanInput:function(e,t){e.on("click",".form-render_booleaninput button",function(e){var t=$(this),n=t.attr("data-value"),r=t.attr("data-id"),i;$("#"+r,t.parent()).removeClass("invalid").val(n).trigger("change"),i='<span class="text-'+(n==="true"?"success":"error")+'">'+t.html()+"<span>",t.parent().next().html(i).show("slow")});var n=$('.form-render_booleaninput input[type="hidden"]',e);n.each(function(){var e=$(this),t=e.val();if(t==="")return;switch(t){case"true":e.parent().find("button.btn-yes").click();break;case"false":e.parent().find("button.btn-no").click()}})},setupRadioBtnGroup:function(e){e.on("click",".radio-container button",function(e){e.preventDefault();var t=$(e.target),n=t.attr("value"),r=t.closest(".radio-container"),i=r.find('input[type="hidden"]');i.val(n).trigger("change"),r.find(".radio-value-render").html(n).show("slow")});var t=e.find(".radio-container");t.each(function(){var e=$(this),t=e.find('input[type="hidden"]'),n=$.trim(t.val());if(n==="")return;e.find('button[value="'+n+'"]').trigger("click")})},setupRadioBtnGroupValue:function(e){var t=$(".radio-container input.has-default-val",e);t.each(function(){var e=$(this),t=e.closest(".radio-container").find('button[value="'+e.val()+'"]');t?t.addClass("active"):e.val(""),e.removeClass("has-default-val")})},setupUserIdAjaxCall:function(e){var t="/user?$filter=Username eq ",n=$(":input.userid-lookup",e),r=this;n.each(function(){var e=$(this);e.is("select")?e.is("[data-url]")?$.getJSON(e.attr("data-url"),function(t,n){if(n==="success"){var i="";_.each(t,function(e){i+='<option value="'+e.Id+'">'+e.Username+"</option>"}),e.append(i),e.select2({containerCssClass:"span12"}).on("change",function(t){t.val&&t.val!==""&&e.removeClass("invalid")})}else r.setUpErrorNotice(e,"Please refresh this page!",1e4)}):e.select2({containerCssClass:"span12"}):$(this).change(function(e){var n=$(this),i=n.val(),s=n.attr("data-url")||t,o={dataType:"json",complete:function(e,t){n.removeAttr("data-send");if(n.hasClass("invalid"))return;if(t==="success"){var i=$.parseJSON(e.responseText);switch(typeof i){case"boolean":i&&(n.addClass("invalid").val(""),r.setUpErrorNotice(n,'Username "'+n.val()+'" is already existed!'))}}else r.setUpErrorNotice(n,"Could not get information!")}};if(i==="")return;s.search(/\?/)===-1&&(s+="?"),typeof username!="undefined"&&(o.username=username,o.password=password);if(n.is("[data-url-data]")){var u="",a=$.parseJSON(n.attr("data-url-data"));_.each(a,function(e,t){u+=t+"="+$(':input[name="'+e+'"]').val()+"&"}),u=encodeURI(u.substr(0,u.length-1)),s+=u}o.url=s,n.is("[data-send]")||(n.attr("data-send",!0),$.ajax(o))})})},setupAddressEvent:function(e,t){var n=$("form",e);n.on("change",".country",function(e){e.preventDefault();var t=$(this),n=t.parentsUntil("form","div.address-fieldset"),r=n.find("select.us-state"),i=n.find("input.us-state"),s=n.find("input.postal-code"),o=t.val();if(o===t.attr("data-value"))return;t.attr("data-value",o);switch(o){case"":case"US":r.is(":hidden")&&i.attr("disabled",!0).hide("slow",function(){r.attr("disabled",!1).show("slow")}),s.hasClass("allowzipcodeplusfour")||s.addClass("allowzipcode").attr("maxlength",5);break;default:i.is(":hidden")&&r.attr("disabled",!0).hide("slow",function(){i.attr("disabled",!1).val("").show("slow"),i.is("[data-default-value]")&&i.val(i.attr("data-default-value")).removeAttr("data-default-value")}),s.removeClass("allowzipcode").removeAttr("maxlength")}});if(t.options.mode==="update"){var r=$("div.address-fieldset",n);r.each(function(){var e=$(this);$(".country",this).trigger("change")})}},setUpErrorNotice:function(e,t,n,r){r=r||"en",n=n||3e3,t=t||"";var i,s;switch(r){case"sp":i="Error",s="Por favor, vuelve a intentarlo";break;default:i="Error",s="Please try again."}var o={html:!0,placement:"top",trigger:"manual",title:'<i class="icon-edit"></i> '+i+".",content:'<i class="icon-spinner icon-spin icon-large"></i> '+s+" ..."+(t!==""?"<br>"+t:"")};e.attr("disabled",!0).popover(o).popover("show"),window.setTimeout(function(){e.attr("disabled",!1).popover("destroy"),e.next(".popover").remove()},n)},parseInternalFieldsBeforeSubmit:function(e,t){var n;if(!t.length)return;_.each(t,function(t){var r=$(':input[name="'+t+'"]',e);if(!r.length)return;n=t.match(/\[\]$/gi),n?n=t.substr(0,t.length-2)+"_internal[]":n=t+"_internal",r.attr("name",n)})},setupPopover:function(e){var t=$('[data-toggle="popover"]',e);t.popover()},destroyPopover:function(e){var t=$('[data-toggle="popover"]',e);t.popover("destroy")},calculateDateDiffByDays:function(e,t){var n=864e5,r=e.getTime(),i=t.getTime(),s=Math.abs(r-i);return Math.round(s/n)},convertDataToArrayString:function(e){var t=["value-as-array"];_.each(t,function(t){var n=$(":input."+t,e);n.each(function(){var e=$(this),t=n.val();t&&t!==""?t=t.split(","):t=[],e.val(JSON.stringify(t))})})},convertNumberToDecimal:function(e){e.find(":input[data-decimal]").each(function(){var e=$(this),t=e.val(),n=parseInt(e.attr("data-decimal"),10);t*=Math.pow(10,n),e.val(parseInt(t,10))})},setupRadioButtonsValue:function(e){if(!e.options.formData||!e.options.formData.fields)return;_.each(e._radioFieldName,function(t){if(!e.options.formData.fields[t])return;var n=$(':radio[name="'+t+'"]').filter('[value="'+e.options.formData.fields[t]+'"]');n.attr("checked",!0).trigger("change")})},setModelRadioValues:function(e,t){var n=!1;t=t||null;var r=e.find(":radio:checked");if(!r.length)return;n&&(console.log("[*] Debug - setModelRadioValues"),console.log(r),console.log(t),console.log(t.model),console.log(t.model.toJSON())),r.each(function(){try{var e=$(this);n&&console.log(e),e.attr("checked",!0).trigger("change");if(t&&t.model){var r=e.attr("name"),i=e.val();n&&console.log('    Model["'+r+'"] : '+t.model.get(r)),t.model.set(r,i)}}catch(s){console&&console.log&&(console.log("[x] Exception in setModelRadioValues"),console.log(s))}})},setModelCheckValues:function(e,t){t=t||null;var n=e.find(":checkbox:checked");if(!n.length)return;n.each(function(){try{var e=$(this);e.attr("checked",!0).trigger("change");if(t&&t.model){var n=e.attr("name"),r=e.val();t.model.set(n,r)}}catch(i){console&&console.log&&(console.log("[x] Exception in setModelCheckValues"),console.log(i))}})},formatAMPM:function(e){var t=e.getHours(),n=e.getMinutes(),r=t>=12?"PM":"AM";t%=12,t=t?t:12,n=n<10?"0"+n:n;var i=t+":"+n+" "+r;return i},addFormSubmittedData:function(e,t){if(e.name&&e.name==="LogEntries"&&t.options.formData.fields){var n={LogMessage:"Form submitted",LogTime:t.options.formData.createddate&&t.options.formData.createddate.$date?t.options.formData.createddate.$date/1e3:null,LogUser:t.options.formData.createduser?t.options.formData.createduser:null};t.options.formData.fields[e.name]||(t.options.formData.fields[e.name]=[]),t.options.formData.fields[e.name].unshift(n)}},getUserIdFormHtml:function(e){e=e||null;if(!e)return $("#snhd_user_network_login").text().toLowerCase()},shouldRenderWithShowOnStatusOrShowOnMode:function(e,t,n){return e.options.showonstatus&&_.indexOf(e.options.showonstatus,t)<0?!1:e.options.showonmode&&_.indexOf(e.options.showonmode,n)<0?!1:!0},shouldRenderShowOnUser:function(e){if(!e.options||!e.options.showonuser)return!0;if(!_.isArray(e.options.showonuser))throw"In order to use Options.ShowOnUser for "+e.type+' with "'+e.name+'" required an array!';var t=this.getUserIdFormHtml();if(t&&t!==""){var n=/(\w+)$/i,r=t.match(n);if(r&&_.indexOf(e.options.showonuser,r.pop())>-1)return!0}return!1},validateCheckBox:function(e){var t=!0;try{e.find('.checkbox-container[data-check-required="true"]').each(function(){var e=$(this),n=e.find("label.checkbox");e.find(":checked").length?n.removeClass("invalid"):(n.addClass("invalid"),t=!1)})}catch(n){console&&console.log&&(console.log("[x] Error: validateCheckBox"),console.log(n)),t=!1}return t},resetSelectsOption:function(e){var t=!1;if(!e||!e.length)return;t&&(console.log("[*] resetSelectsOption -"),console.log(arguments)),e.each(function(){var e=$(this),t=e.val();(_.isNull(t)||t==="")&&e.removeAttr("selected")})},formatUriSegment:function(e,t){var n=!1;t=t||null;if(!t){console&&console.log&&console.log('[x] formData is null in "formatUriSegment".');return}var r=e.match(/{\w+}/ig);return n&&(console.log("[*] Current URL"),console.log(r),console.log("[*] FormData"),console.log(t)),_.each(r,function(r){n&&(console.log("***"),console.log(r));switch(r){case"{id}":if(!t||!t._id||!t._id.$oid)throw"formatUriSegment could not find _id.$oid.";e=e.replace(r,t._id.$oid)}}),n&&(console.log("[*] New URL"),console.log(e)),e},setupFileRepositoryEvent:function(e){var t=this;if(!e.length)throw"setupFileRepositoryEvent form not found.";e.on("hidden",".filerepository-form-wrapper",function(){var e=$(this);e.find(":input").removeClass("invalid").each(function(){var e=$(this);e.val("")})}).on("click",".filerepository-button",function(e){e.preventDefault();var t=$(e.currentTarget),n=t.closest(".filerepository-wrapper");return n.find(".filerepository-form-wrapper").modal("show"),!1}).on("click",".filerepository-form-wrapper .btn-submit-filerepository",function(e){e.preventDefault();var n=$(e.currentTarget).closest(".filerepository-form-wrapper"),r=n.find(".filerepository-form"),i=$(":input",r),s=!1;i.each(function(){var e=$(this),t=e.val(),n=!1;if(!t||t==="")n=!0,s=!0;n?e.addClass("invalid"):e.removeClass("invalid")});if(s)return!1;var o=n.find(".modal-footer");return o.find(".btn").fadeOut(),n.find(".modal-body .alert").html('<i class="icon-spinner icon-spin icon-large"></i> Sending information, please wait.'),t.buildFormAppendToBody(i.parent(),n.attr("data-url")),!1})},setupCounty:function(e){var t=e.find(".select2-county");if(!$().select2)throw"Select 2 is not found!";t.each(function(){var e=$(this);e.select2()});var n=e.find(".select2-county-lookup");typeof countyData=="string"&&(countyData=$.parseJSON(countyData)),n.each(function(){var t=$(this),n=t.attr("data-filterbyid");t.select2(),e.on("change","#"+n,function(){var e=$(this),n=e.val(),r=t.attr("data-state");if(r===n)return;var i='<option value="">-- Select County in '+n+" --</option>";_.each(countyData[n],function(e){i+='<option value="'+e+'">'+e+"</option>"}),t.val(""),t.select2("val",""),t.select2("destroy"),t.empty().append(i),t.select2(),t.val(""),t.select2("val",""),t.select2("open"),t.select2("close"),t.attr("data-state",n)});var r=$("#"+n,e),i=r.val();i&&i!==""&&r.trigger("change");var s=t.attr("data-countyvalue");s&&s!==""&&(t.select2("destroy"),t.select2(),t.select2("val",s))})},buildFormAppendToBody:function(e,t){if(!t||t===""||typeof t!="string")throw"Expected url to be a valid string.";var n=$('<form action="'+t+'" method="POST" enctype="multipart/form-data"></form>');n.append(e),n.appendTo("body"),n.submit()},finalSetupAllMode:function(e){var t=$(e.el);if(!t.length)throw"[x] finalSetupAllMode: could not be able to find form."},showHumaneSuccessBox:function(e,t){var n=humane.create({baseCls:"humane-jackedup",addnCls:"humane-jackedup-success",timeout:3e3,clickToClose:!1,waitForMove:!1});n.log(e,t)},showHumaneErrorBox:function(e,t){var n=humane.create({baseCls:"humane-bigbox",timeout:3e3,clickToClose:!1,waitForMove:!1});n.error=n.spawn({addnCls:"humane-bigbox-error"}),n.error(e,t)},formatDateAsString:function(e,t){t=t||null;var n=new Date(e);if(!t)return n.toUTCString();var r=n.getMonth()+1;r<10&&(r="0"+r);var i=n.getDate();i<10&&(i="0"+i);switch(t){case"m/d/Y":return r+"/"+i+"/"+n.getFullYear();default:throw"Not Implement "+t+' yet in "formatDateAsString"!'}},sortNumber:function(e,t){return e-t}}});