/*!
 * jQuery Birthday Picker: v1.4 - 10/16/2011
 * http://abecoffman.com/stuff/birthdaypicker
 *
 * Copyright (c) 2010 Abe Coffman
 * Dual licensed under the MIT and GPL licenses.
 *
 */

(function(e){var t={"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"long":["January","February","March","April","May","June","July","August","September","October","November","December"]},n=new Date,r=n.getFullYear(),i=n.getMonth()+1,s=n.getDate();e.fn.birthdaypicker=function(n){n&&typeof n=="string"&&(n=e.parseJSON(n));var i={maxage:120,minage:0,futuredates:!1,maxyear:r,minyear:"",dateformat:"middleEndian",monthformat:"short",placeholder:!0,legend:"",defaultdate:!1,fieldname:"birthdate",fieldid:"birthdate",hiddendate:!0,onchange:null,tabindex:null,required:!1,errorname:"",id:"",mindate:"",maxdate:""};return this.each(function(){n&&(_.each(n,function(e,t){delete n[t],n[t.toLowerCase()]=e}),e.extend(i,n));if(i.mindate!==""){var s=i.mindate.split("/");s.length===3&&(i.minyear=s[2])}var o=i.required?" required":"",u=e("<fieldset class='birthday-picker'></fieldset>"),a=e("<select class='birth-year not_sending' name='"+i.id+"_birth[year]'"+o+"></select>"),f=e("<select class='birth-month not_sending' name='"+i.id+"_birth[month]'"+o+"></select>"),l=e("<select class='birth-day not_sending' name='"+i.id+"_birth[day]'"+o+"></select>");i.legend&&e("<legend>"+i.legend+"</legend>").appendTo(u),i.id!==""&&(i.fieldid=i.id,i.fieldname=i.id);var c=i.tabindex;i["dateformat"]=="bigEndian"?(u.append(a).append(f).append(l),c!=null&&(a.attr("tabindex",c),f.attr("tabindex",c++),l.attr("tabindex",c++))):i["dateformat"]=="littleEndian"?(u.append(l).append(f).append(a),c!=null&&(l.attr("tabindex",c),f.attr("tabindex",c++),a.attr("tabindex",c++))):(u.append(f).append(l).append(a),c!=null&&(f.attr("tabindex",c),l.attr("tabindex",c++),a.attr("tabindex",c++))),i.placeholder&&(e("<option value=''>Year:</option>").appendTo(a),e("<option value=''>Month:</option>").appendTo(f),e("<option value=''>Day:</option>").appendTo(l));var h,p,d,v,m,g;i.defaultdate?(p=i.defaultdate.split("/"),e.isArray(p)&&p.length===3?(d=new Date(p[2],p[0]-1,p[1]),v=d.getFullYear(),m=d.getMonth()+1):(d=new Date(i.defaultdate+"T00:00:00"),v=d.getFullYear(),m=d.getMonth())):(d=new Date,v=d.getFullYear()-1,m=d.getMonth()+1),g=d.getDate(),m=m<10?"0"+m:m,g=g<10?"0"+g:g,h=m+"/"+g+"/"+v,i.hiddendate&&e("<input type='hidden' name='"+i.fieldname+"'/>").attr("id",i.fieldid).val(h).appendTo(u);var y=r-i.minage,b=i.minyear!==""?i.minyear:r-i.maxage;i.futuredates&&i["maxyear"]!=r&&(i.maxyear>1e3?y=i.maxyear:y=r+i.maxyear);for(var w=y;w>=b;w--)e("<option></option>").attr("value",w).text(w).appendTo(a);for(var E=0;E<12;E++)e("<option></option>").attr("value",E+1).text(t[i.monthformat][E]).appendTo(f);for(var S=1;S<32;S++)e("<option></option>").attr("value",S).text(S).appendTo(l);e(this).append(u);if(i.defaultdate){var x;e.isArray(p)&&p.length===3?x=new Date(p[2],p[0]-1,p[1]):x=new Date(i.defaultdate+"T00:00:00"),a.val(x.getFullYear()),f.val(x.getMonth()+1),l.val(x.getDate())}u.change(function(){var n=new Date,r=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),u=parseInt(a.val(),10),c=parseInt(f.val(),10),p=parseInt(l.val(),10),d=(new Date(u,c,0)).getDate(),v=parseInt(f.children(":last").val()),m=parseInt(l.children(":last").val());if(m>d)while(m>d)l.children(":last").remove(),m--;else if(m<d)while(m<d)m++,l.append("<option value="+m+">"+m+"</option>");if(!i.futuredates&&u==y){if(v>s){while(v>s)f.children(":last").remove(),v--;l.children(":first").attr("selected","selected")}if(c===s)while(m>o)l.children(":last").remove(),m-=1}if(u!=y&&v!=12)while(v<12)f.append("<option value="+(v+1)+">"+t[i.monthformat][v]+"</option>"),v++;u*c*p!=0&&(c=c<10?"0"+c:c,p=p<10?"0"+p:p,h=c+"/"+p+"/"+u,e(this).find("#"+i.fieldid).val(h),i["onchange"]!=null&&i.onchange(h))})})}})(jQuery);