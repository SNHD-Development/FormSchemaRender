/*!
 * jQuery Birthday Picker: v1.4 - 10/16/2011
 * http://abecoffman.com/stuff/birthdaypicker
 *
 * Copyright (c) 2010 Abe Coffman
 * Dual licensed under the MIT and GPL licenses.
 *
 */

!function(e){var a={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"short-sp":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]},t=new Date,n=t.getFullYear();t.getMonth(),t.getDate();e.fn.birthdaypicker=function(t){t&&"string"==typeof t&&(t=e.parseJSON(t));var r={maxage:120,minage:0,futuredates:!1,maxyear:n,minyear:"",dateformat:"middleEndian",monthformat:"short",placeholder:!0,legend:"",defaultdate:!1,fieldname:"birthdate",fieldid:"birthdate",hiddendate:!0,onchange:null,tabindex:null,required:!1,errorname:"",id:"",mindate:"",maxdate:"",lang:"",nodefaultvalue:!1};return this.each(function(){if(t&&(_.each(t,function(e,a){delete t[a],t[a.toLowerCase()]=e}),e.extend(r,t)),""!==r.mindate){var i=r.mindate.split("/");3===i.length&&(r.minyear=i[2])}var d=r.required?" required":"",l=e("<fieldset class='birthday-picker'></fieldset>"),o=e("<select class='birth-year not_sending' name='"+r.id+"_birth[year]'"+d+"></select>"),p=e("<select class='birth-month not_sending' name='"+r.id+"_birth[month]'"+d+"></select>"),f=e("<select class='birth-day not_sending' name='"+r.id+"_birth[day]'"+d+"></select>");r.legend&&e("<legend>"+r.legend+"</legend>").appendTo(l),""!==r.id&&(r.fieldid=r.id,r.fieldname=r.id),""!==r.lang&&(r.monthformat="short-"+r.lang);var u=r.tabindex;if("bigEndian"==r.dateformat?(l.append(o).append(p).append(f),null!=u&&(o.attr("tabindex",u),p.attr("tabindex",u++),f.attr("tabindex",u++))):"littleEndian"==r.dateformat?(l.append(f).append(p).append(o),null!=u&&(f.attr("tabindex",u),p.attr("tabindex",u++),o.attr("tabindex",u++))):(l.append(p).append(f).append(o),null!=u&&(p.attr("tabindex",u),f.attr("tabindex",u++),o.attr("tabindex",u++))),r.placeholder){var s,h,m;switch(r.lang){case"sp":h="A&ntilde;o",s="Mes",m="D&iacute;a";break;default:h="Year",s="Month",m="Day"}e("<option value=''>"+h+":</option>").appendTo(o),e("<option value=''>"+s+":</option>").appendTo(p),e("<option value=''>"+m+":</option>").appendTo(f)}var g,v,c,b,y,x;r.defaultdate?(v=r.defaultdate.split("/"),e.isArray(v)&&3===v.length?(c=new Date(v[2],v[0]-1,v[1]),b=c.getFullYear(),y=c.getMonth()+1):(c=new Date(r.defaultdate+"T00:00:00"),b=c.getFullYear(),y=c.getMonth())):r.nodefaultvalue||(c=new Date,b=c.getFullYear()-1,y=c.getMonth()+1),c&&(x=c.getDate()),c&&(y=y<10?"0"+y:y,x=x<10?"0"+x:x,g=y+"/"+x+"/"+b),r.hiddendate&&e("<input type='hidden' name='"+r.fieldname+"'/>").attr("id",r.fieldid).val(g).appendTo(l);var D=n-r.minage,M=""!==r.minyear?r.minyear:n-r.maxage;r.futuredates&&r.maxyear!=n&&(D=r.maxyear>1e3?r.maxyear:n+r.maxyear);for(var Y=D;Y>=M;Y--)e("<option></option>").attr("value",Y).text(Y).appendTo(o);for(var w=0;w<12;w++)e("<option></option>").attr("value",w+1).text(a[r.monthformat][w]).appendTo(p);for(var A=1;A<32;A++)e("<option></option>").attr("value",A).text(A).appendTo(f);if(e(this).append(l),l.change(function(){var t=new Date,n=(t.getFullYear(),t.getMonth()+1),i=t.getDate(),d=parseInt(o.val(),10),l=parseInt(p.val(),10),u=parseInt(f.val(),10),s=new Date(d,l,0).getDate(),h=parseInt(p.children(":last").val(),10),m=parseInt(f.children(":last").val(),10);if(m>s)for(;m>s;)f.children(":last").remove(),m--;else if(m<s)for(;m<s;)m++,f.append("<option value="+m+">"+m+"</option>");var v=f.find('option[value="'+u+'"]');if(!r.futuredates&&d==D){if(h>n){for(;h>n;)p.children(":last").remove(),h--;v.length}if(l===n)for(;m>i;)f.children(":last").remove(),m-=1}if(d!=D&&12!=h)for(;h<12;)p.append("<option value="+(h+1)+">"+a[r.monthformat][h]+"</option>"),h++;if(d*l*u!=0){l=l<10?"0"+l:l,u=u<10?"0"+u:u,g=l+"/"+u+"/"+d,e(this).find("#"+r.fieldid).val(g);var c=moment(g);if(c&&c.isValid()){var b=moment(moment().format("MM/DD/YYYY"));c.isAfter(b)&&(l=b.month()+1,u=b.date(),p.val(l),f.val(u),e(this).find("#"+r.fieldid).val(b.format("MM/DD/YYYY")))}null!=r.onchange&&r.onchange(g)}}),r.defaultdate){var T;T=e.isArray(v)&&3===v.length?new Date(v[2],v[0]-1,v[1]):new Date(r.defaultdate+"T00:00:00"),o.val(T.getFullYear()),p.val(T.getMonth()+1),f.val(T.getDate()).trigger("change")}})}}(jQuery);