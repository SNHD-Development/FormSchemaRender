/*!
 * jQuery Birthday Picker: v1.4 - 10/16/2011
 * http://abecoffman.com/stuff/birthdaypicker
 *
 * Copyright (c) 2010 Abe Coffman
 * Dual licensed under the MIT and GPL licenses.
 *
 */

!function(e){var a={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"short-sp":["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]},t=new Date,n=t.getFullYear();t.getMonth()+1,t.getDate();e.fn.birthdaypicker=function(t){t&&"string"==typeof t&&(t=e.parseJSON(t));var r={maxage:120,minage:0,futuredates:!1,maxyear:n,minyear:"",dateformat:"middleEndian",monthformat:"short",placeholder:!0,legend:"",defaultdate:!1,fieldname:"birthdate",fieldid:"birthdate",hiddendate:!0,onchange:null,tabindex:null,required:!1,errorname:"",id:"",mindate:"",maxdate:"",lang:"",nodefaultvalue:!1};return this.each(function(){if(t&&(_.each(t,function(e,a){delete t[a],t[a.toLowerCase()]=e}),e.extend(r,t)),""!==r.mindate){var i=r.mindate.split("/");3===i.length&&(r.minyear=i[2])}var d=r.required?" required":"",l=e("<fieldset class='birthday-picker'></fieldset>"),o=e("<select class='birth-year not_sending' name='"+r.id+"_birth[year]'"+d+"></select>"),p=e("<select class='birth-month not_sending' name='"+r.id+"_birth[month]'"+d+"></select>"),u=e("<select class='birth-day not_sending' name='"+r.id+"_birth[day]'"+d+"></select>");r.legend&&e("<legend>"+r.legend+"</legend>").appendTo(l),""!==r.id&&(r.fieldid=r.id,r.fieldname=r.id),""!==r.lang&&(r.monthformat="short-"+r.lang);var s=r.tabindex;if("bigEndian"==r.dateformat?(l.append(o).append(p).append(u),null!=s&&(o.attr("tabindex",s),p.attr("tabindex",s++),u.attr("tabindex",s++))):"littleEndian"==r.dateformat?(l.append(u).append(p).append(o),null!=s&&(u.attr("tabindex",s),p.attr("tabindex",s++),o.attr("tabindex",s++))):(l.append(p).append(u).append(o),null!=s&&(p.attr("tabindex",s),u.attr("tabindex",s++),o.attr("tabindex",s++))),r.placeholder){var f,h,g;switch(r.lang){case"sp":h="A&ntilde;o",f="Mes",g="D&iacute;a";break;default:h="Year",f="Month",g="Day"}e("<option value=''>"+h+":</option>").appendTo(o),e("<option value=''>"+f+":</option>").appendTo(p),e("<option value=''>"+g+":</option>").appendTo(u)}var m,c,v,b,y,x;r.defaultdate?(c=r.defaultdate.split("/"),e.isArray(c)&&3===c.length?(v=new Date(c[2],c[0]-1,c[1]),b=v.getFullYear(),y=v.getMonth()+1):(v=new Date(r.defaultdate+"T00:00:00"),b=v.getFullYear(),y=v.getMonth())):r.nodefaultvalue||(v=new Date,b=v.getFullYear()-1,y=v.getMonth()+1),v&&(x=v.getDate()),v&&(y=y<10?"0"+y:y,x=x<10?"0"+x:x,m=y+"/"+x+"/"+b),r.hiddendate&&e("<input type='hidden' name='"+r.fieldname+"'/>").attr("id",r.fieldid).val(m).appendTo(l);var D=n-r.minage,M=""!==r.minyear?r.minyear:n-r.maxage;r.futuredates&&r.maxyear!=n&&(D=r.maxyear>1e3?r.maxyear:n+r.maxyear);for(var w=D;w>=M;w--)e("<option></option>").attr("value",w).text(w).appendTo(o);for(var T=0;T<12;T++)e("<option></option>").attr("value",T+1).text(a[r.monthformat][T]).appendTo(p);for(var A=1;A<32;A++)e("<option></option>").attr("value",A).text(A).appendTo(u);if(e(this).append(l),l.change(function(){var t=new Date,n=(t.getFullYear(),t.getMonth()+1),i=t.getDate(),d=parseInt(o.val(),10),l=parseInt(p.val(),10),s=parseInt(u.val(),10),f=new Date(d,l,0).getDate(),h=parseInt(p.children(":last").val(),10),g=parseInt(u.children(":last").val(),10);if(g>f)for(;g>f;)u.children(":last").remove(),g--;else if(g<f)for(;g<f;)g++,u.append("<option value="+g+">"+g+"</option>");u=e(':input[name="'+r.id+'_birth[day]"]');var c=u.find('option[value="'+s+'"]');if(c.attr("selected",!0),!r.futuredates&&d==D){if(h>n){for(;h>n;)p.children(":last").remove(),h--;c.length||u.children(":first").attr("selected","selected")}if(l===n)for(;g>i;)u.children(":last").remove(),g-=1}if(d!=D&&12!=h)for(;h<12;)p.append("<option value="+(h+1)+">"+a[r.monthformat][h]+"</option>"),h++;d*l*s!=0&&(l=l<10?"0"+l:l,s=s<10?"0"+s:s,m=l+"/"+s+"/"+d,e(this).find("#"+r.fieldid).val(m),null!=r.onchange&&r.onchange(m))}),r.defaultdate){var F;F=e.isArray(c)&&3===c.length?new Date(c[2],c[0]-1,c[1]):new Date(r.defaultdate+"T00:00:00"),o.val(F.getFullYear()),p.val(F.getMonth()+1),u.val(F.getDate()).trigger("change")}})}}(jQuery);