// Backbone.Validation v0.8.0
//
// Copyright (c) 2011-2013 Thomas Pedersen
// Distributed under MIT License
//
// Documentation and full license available at:
// http://thedersen.com/projects/backbone-validation

!function(t){"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):"function"==typeof define&&define.amd&&define(["backbone","underscore"],t)}(function(t,e){return t.Validation=function(e){"use strict";var n={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},a={formatLabel:function(t,e){return s[n.labelFormatter](t,e)},format:function(){var t=Array.prototype.slice.call(arguments);return t.shift().replace(/\{(\d+)\}/g,function(e,n){return void 0!==t[n]?t[n]:e})}},i=function(n,a,r){return a=a||{},r=r||"",e.each(n,function(e,u){n.hasOwnProperty(u)&&(e&&"object"==typeof e&&!(e instanceof Date||e instanceof RegExp||e instanceof t.Model||e instanceof t.Collection)?i(e,a,r+u+"."):a[r+u]=e)}),a},r=function(){var t=function(t){return e.reduce(e.keys(t.validation||{}),function(t,e){return t[e]=void 0,t},{})},r=function(t,n){var a=t.validation?t.validation[n]||{}:{};return(e.isFunction(a)||e.isString(a))&&(a={fn:a}),e.isArray(a)||(a=[a]),e.reduce(a,function(t,n){return e.each(e.without(e.keys(n),"msg"),function(e){t.push({fn:l[e],val:n[e],msg:n.msg})}),t},[])},F=function(t,n,i,u){return e.reduce(r(t,n),function(r,F){var o,s=e.extend({},a,l);return void 0!==F.fn&&(o=F.fn.call(s,i,n,F.val,t,u)),!1!==o&&!1!==r&&(o&&!r?F.msg||o:r)},"")},o=function(t,n){var a,r={},u=!0,o=e.clone(n),s=i(n);return e.each(s,function(e,n){(a=F(t,n,e,o))&&(r[n]=a,u=!1)}),{invalidAttrs:r,isValid:u}},s=function(n,a){return{preValidate:function(t,n){return F(this,t,n,e.extend({},this.attributes))},isValid:function(t){var n=i(this.attributes);return e.isString(t)?!F(this,t,n[t],e.extend({},this.attributes)):e.isArray(t)?e.reduce(t,function(t,a){return t&&!F(this,a,n[a],e.extend({},this.attributes))},!0,this):(!0===t&&this.validate(),!this.validation||this._isValid)},validate:function(r,u){var F=this,s=!r,l=e.extend({},a,u),d=t(F),f=e.extend({},d,F.attributes,r),c=i(r||f),h=o(F,f);if(F._isValid=h.isValid,e.each(d,function(t,e){h.invalidAttrs.hasOwnProperty(e)||l.valid(n,e,l.selector)}),e.each(d,function(t,e){var a=h.invalidAttrs.hasOwnProperty(e),i=c.hasOwnProperty(e);a&&(i||s)&&l.invalid(n,e,h.invalidAttrs[e],l.selector)}),e.defer(function(){F.trigger("validated",F._isValid,F,h.invalidAttrs),F.trigger("validated:"+(F._isValid?"valid":"invalid"),F,h.invalidAttrs)}),!l.forceUpdate&&e.intersection(e.keys(h.invalidAttrs),e.keys(c)).length>0)return h.invalidAttrs}}},d=function(t,n,a){e.extend(n,s(t,a))},f=function(t){delete t.validate,delete t.preValidate,delete t.isValid},c=function(t){d(this.view,t,this.options)},h=function(t){f(t)};return{version:"0.8.0",configure:function(t){e.extend(n,t)},bind:function(t,a){var i=t.model,r=t.collection;if(a=e.extend({},n,u,a),void 0===i&&void 0===r)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";i?d(t,i,a):r&&(r.each(function(e){d(t,e,a)}),r.bind("add",c,{view:t,options:a}),r.bind("remove",h))},unbind:function(t){var e=t.model,n=t.collection;e&&f(t.model),n&&(n.each(function(t){f(t)}),n.unbind("add",c),n.unbind("remove",h))},mixin:s(null,n)}}(),u=r.callbacks={valid:function(t,e,n){t.$("["+n+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,n,a){t.$("["+a+'~="'+e+'"]').addClass("invalid").attr("data-error",n)}},F=r.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o=r.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",pattern:"{0} must be a valid {1}",mindate:"{0} must be before {1}",maxdate:"{0} must be after {1}"},s=r.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace("_"," ")},label:function(t,e){return e.labels&&e.labels[t]||s.sentenceCase(t,e)}},l=r.validators=function(){var t=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){var e=/^\s+/,n=/\s+$/;return null===t?"":t.toString().replace(e,"").replace(n,"")},n=function(t){return e.isNumber(t)||e.isString(t)&&t.match(F.number)},a=function(n){return!(e.isNull(n)||e.isUndefined(n)||e.isString(n)&&""===t(n))};return{fn:function(t,n,a,i,r){return e.isString(a)&&(a=i[a]),a.call(i,t,n,r)},required:function(t,n,i,r,u){var F=e.isFunction(i)?i.call(r,t,n,u):i;return!(!F&&!a(t))&&(F&&!a(t)?this.format(o.required,this.formatLabel(n,r)):void 0)},acceptance:function(t,n,a,i){if("true"!==t&&(!e.isBoolean(t)||!1===t))return this.format(o.acceptance,this.formatLabel(n,i))},min:function(t,e,a,i){if(!n(t)||t<a)return this.format(o.min,this.formatLabel(e,i),a)},max:function(t,e,a,i){if(!n(t)||t>a)return this.format(o.max,this.formatLabel(e,i),a)},mindate:function(t,n,a,i){if(t&&""!==t){t&&t.length&&""!==t||(t=jQuery("#"+n).val(),i.has(n)&&""===i.get(n)&&i.set(n,t));var r=t&&t.split?t.split("/"):[];if(3===r.length){if(a.match(/^\d+$/gi)){for(var u=[0,6],F=new Date,s=parseInt(a,10),l=1;l<=s;l++)F.setDate(F.getDate()+1),e.indexOf(u,F.getDay())>=0&&s++;5===F.getDay()&&F.setDate(F.getDate()+3),a=F.getMonth()+1+"/"+F.getDate()+"/"+F.getFullYear()}else if(a.search(/\//i)<0){var d=a.toLowerCase();switch(d){case"today":d=new Date,a=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear()}}var f=new Date,c=new Date,h=a.split("/");if(f.setFullYear(parseInt(r[2]),parseInt(r[0])-1,parseInt(r[1])),c.setFullYear(parseInt(h[2]),parseInt(h[0])-1,parseInt(h[1])),f>=c)return}return this.format(o.mindate,this.formatLabel(n,i))}},maxdate:function(t,e,n,a){if(t&&""!==t){if("string"==typeof n)switch(n){case"today":n=new Date,n=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();break;case"":return}var i=t&&t.split?t.split("/"):[];if(3===i.length){var r=new Date,u=new Date,F=n.split("/");if(r.setFullYear(parseInt(i[2]),parseInt(i[0])-1,parseInt(i[1])),u.setFullYear(parseInt(F[2]),parseInt(F[0])-1,parseInt(F[1])),r<=u)return}return this.format(o.maxdate,this.formatLabel(e,a))}},range:function(t,e,a,i){if(!n(t)||t<a[0]||t>a[1])return this.format(o.range,this.formatLabel(e,i),a[0],a[1])},length:function(e,n,i,r){if(!a(e)||t(e).length!==i)return this.format(o.length,this.formatLabel(n,r),i)},minLength:function(e,n,i,r){if(!a(e)||t(e).length<i)return this.format(o.minLength,this.formatLabel(n,r),i)},maxLength:function(e,n,i,r){if(!a(e)||t(e).length>i)return this.format(o.maxLength,this.formatLabel(n,r),i)},rangeLength:function(e,n,i,r){if(!a(e)||t(e).length<i[0]||t(e).length>i[1])return this.format(o.rangeLength,this.formatLabel(n,r),i[0],i[1])},oneOf:function(t,n,a,i){if(!e.include(a,t))return this.format(o.oneOf,this.formatLabel(n,i),a.join(", "))},filetype:function(t,n,a,i){var r=t.split(".").pop().toLowerCase();if(!e.include(a,r)){if(""!==r&&$().popover){var u=$('[name="'+n+'"][type="file"]');u.parent().find(".alert.alert-error").length||u.attr("disabled")||u.attr("disabled",!0).before('<div class="alert alert-error" style="display:none;"><i class="icon-edit"></i> Invalid File Type<br>File type must be "'+a.join(", ")+'"</div>').prev().delay(500).show("slow",function(){window.setTimeout(function(){u.attr("disabled",!1).prev().hide("slow",function(){$(this).remove()}),u.val("")},2500)})}return this.format(o.oneOf,this.formatLabel(n,i),a.join(", "))}},equalTo:function(t,e,n,a,i){if(t!==i[n])return this.format(o.equalTo,this.formatLabel(e,a),this.formatLabel(n,a))},pattern:function(t,e,n,i){if(!a(t)||!t.toString().match(F[n]||n))return this.format(o.pattern,this.formatLabel(e,i),n)}}}();return r}(e),t.Validation});