// Backbone.Validation v0.8.0
//
// Copyright (c) 2011-2013 Thomas Pedersen
// Distributed under MIT License
//
// Documentation and full license available at:
// http://thedersen.com/projects/backbone-validation

!function(t){"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):"function"==typeof define&&define.amd&&define(["backbone","underscore"],t)}(function(t,e){return t.Validation=function(e){"use strict";var n={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},a={formatLabel:function(t,e){return s[n.labelFormatter](t,e)},format:function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return e.replace(/\{(\d+)\}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})}},i=function(n,a,u){return a=a||{},u=u||"",e.each(n,function(e,r){n.hasOwnProperty(r)&&(e&&"object"==typeof e&&!(e instanceof Date||e instanceof RegExp||e instanceof t.Model||e instanceof t.Collection)?i(e,a,u+r+"."):a[u+r]=e)}),a},u=function(){var t=function(t){return e.reduce(e.keys(t.validation||{}),function(t,e){return t[e]=void 0,t},{})},u=function(t,n){var a=t.validation?t.validation[n]||{}:{};return(e.isFunction(a)||e.isString(a))&&(a={fn:a}),e.isArray(a)||(a=[a]),e.reduce(a,function(t,n){return e.each(e.without(e.keys(n),"msg"),function(e){t.push({fn:d[e],val:n[e],msg:n.msg})}),t},[])},F=function(t,n,i,r){return e.reduce(u(t,n),function(u,F){var o,s=e.extend({},a,d);return"undefined"!=typeof F.fn&&(o=F.fn.call(s,i,n,F.val,t,r)),o!==!1&&u!==!1&&(o&&!u?F.msg||o:u)},"")},o=function(t,n){var a,u={},r=!0,o=e.clone(n),s=i(n);return e.each(s,function(e,n){a=F(t,n,e,o),a&&(u[n]=a,r=!1)}),{invalidAttrs:u,isValid:r}},s=function(n,a){return{preValidate:function(t,n){return F(this,t,n,e.extend({},this.attributes))},isValid:function(t){var n=i(this.attributes);return e.isString(t)?!F(this,t,n[t],e.extend({},this.attributes)):e.isArray(t)?e.reduce(t,function(t,a){return t&&!F(this,a,n[a],e.extend({},this.attributes))},!0,this):(t===!0&&this.validate(),!this.validation||this._isValid)},validate:function(u,r){var F=this,s=!u,d=e.extend({},a,r),l=t(F),f=e.extend({},l,F.attributes,u),c=i(u||f),m=o(F,f);if(F._isValid=m.isValid,e.each(l,function(t,e){var a=m.invalidAttrs.hasOwnProperty(e);a||d.valid(n,e,d.selector)}),e.each(l,function(t,e){var a=m.invalidAttrs.hasOwnProperty(e),i=c.hasOwnProperty(e);a&&(i||s)&&d.invalid(n,e,m.invalidAttrs[e],d.selector)}),e.defer(function(){F.trigger("validated",F._isValid,F,m.invalidAttrs),F.trigger("validated:"+(F._isValid?"valid":"invalid"),F,m.invalidAttrs)}),!d.forceUpdate&&e.intersection(e.keys(m.invalidAttrs),e.keys(c)).length>0)return m.invalidAttrs}}},l=function(t,n,a){e.extend(n,s(t,a))},f=function(t){delete t.validate,delete t.preValidate,delete t.isValid},c=function(t){l(this.view,t,this.options)},m=function(t){f(t)};return{version:"0.8.0",configure:function(t){e.extend(n,t)},bind:function(t,a){var i=t.model,u=t.collection;if(a=e.extend({},n,r,a),"undefined"==typeof i&&"undefined"==typeof u)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";i?l(t,i,a):u&&(u.each(function(e){l(t,e,a)}),u.bind("add",c,{view:t,options:a}),u.bind("remove",m))},unbind:function(t){var e=t.model,n=t.collection;e&&f(t.model),n&&(n.each(function(t){f(t)}),n.unbind("add",c),n.unbind("remove",m))},mixin:s(null,n)}}(),r=u.callbacks={valid:function(t,e,n){t.$("["+n+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,n,a){t.$("["+a+'~="'+e+'"]').addClass("invalid").attr("data-error",n)}},F=u.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o=u.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",pattern:"{0} must be a valid {1}",mindate:"{0} must be before {1}",maxdate:"{0} must be after {1}"},s=u.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace("_"," ")},label:function(t,e){return e.labels&&e.labels[t]||s.sentenceCase(t,e)}},d=u.validators=function(){var t=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){var e=/^\s+/,n=/\s+$/;return null===t?"":t.toString().replace(e,"").replace(n,"")},n=function(t){return e.isNumber(t)||e.isString(t)&&t.match(F.number)},a=function(n){return!(e.isNull(n)||e.isUndefined(n)||e.isString(n)&&""===t(n))};return{fn:function(t,n,a,i,u){return e.isString(a)&&(a=i[a]),a.call(i,t,n,u)},required:function(t,n,i,u,r){var F=e.isFunction(i)?i.call(u,t,n,r):i;return!(!F&&!a(t))&&(F&&!a(t)?this.format(o.required,this.formatLabel(n,u)):void 0)},acceptance:function(t,n,a,i){if("true"!==t&&(!e.isBoolean(t)||t===!1))return this.format(o.acceptance,this.formatLabel(n,i))},min:function(t,e,a,i){if(!n(t)||t<a)return this.format(o.min,this.formatLabel(e,i),a)},max:function(t,e,a,i){if(!n(t)||t>a)return this.format(o.max,this.formatLabel(e,i),a)},mindate:function(t,e,n,a){if(t&&""!==t){t&&t.length&&""!==t||(t=jQuery("#"+e).val(),a.has(e)&&""===a.get(e)&&a.set(e,t));var i=t&&t.split?t.split("/"):[];if(3===i.length){if(n.search(/\//i)<0){var u=n.toLowerCase();switch(u){case"today":u=new Date,n=u.getMonth()+1+"/"+u.getDate()+"/"+u.getFullYear()}}var r=new Date,F=new Date,s=n.split("/");if(r.setFullYear(parseInt(i[2]),parseInt(i[0])-1,parseInt(i[1])),F.setFullYear(parseInt(s[2]),parseInt(s[0])-1,parseInt(s[1])),r>=F)return}return this.format(o.mindate,this.formatLabel(e,a))}},maxdate:function(t,e,n,a){var i=!1;if(i&&(console.log("[*] backbone-validation-amd:maxdate"),console.log(arguments)),t&&""!==t){if("string"==typeof n)switch(n){case"today":n=new Date,n=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();break;case"":return}var u=t&&t.split?t.split("/"):[];if(3===u.length){var r=new Date,F=new Date,s=n.split("/");if(r.setFullYear(parseInt(u[2]),parseInt(u[0])-1,parseInt(u[1])),F.setFullYear(parseInt(s[2]),parseInt(s[0])-1,parseInt(s[1])),r<=F)return}return this.format(o.maxdate,this.formatLabel(e,a))}},range:function(t,e,a,i){if(!n(t)||t<a[0]||t>a[1])return this.format(o.range,this.formatLabel(e,i),a[0],a[1])},length:function(e,n,i,u){if(!a(e)||t(e).length!==i)return this.format(o.length,this.formatLabel(n,u),i)},minLength:function(e,n,i,u){if(!a(e)||t(e).length<i)return this.format(o.minLength,this.formatLabel(n,u),i)},maxLength:function(e,n,i,u){if(!a(e)||t(e).length>i)return this.format(o.maxLength,this.formatLabel(n,u),i)},rangeLength:function(e,n,i,u){if(!a(e)||t(e).length<i[0]||t(e).length>i[1])return this.format(o.rangeLength,this.formatLabel(n,u),i[0],i[1])},oneOf:function(t,n,a,i){if(!e.include(a,t))return this.format(o.oneOf,this.formatLabel(n,i),a.join(", "))},filetype:function(t,n,a,i){var u=t.split(".").pop().toLowerCase();if(!e.include(a,u)){if(""!==u&&$().popover){var r=$('[name="'+n+'"][type="file"]'),F=r.parent().find(".alert.alert-error");F.length||r.attr("disabled")||r.attr("disabled",!0).before('<div class="alert alert-error" style="display:none;"><i class="icon-edit"></i> Invalid File Type<br>File type must be "'+a.join(", ")+'"</div>').prev().delay(500).show("slow",function(){window.setTimeout(function(){r.attr("disabled",!1).prev().hide("slow",function(){$(this).remove()}),r.val("")},2500)})}return this.format(o.oneOf,this.formatLabel(n,i),a.join(", "))}},equalTo:function(t,e,n,a,i){if(t!==i[n])return this.format(o.equalTo,this.formatLabel(e,a),this.formatLabel(n,a))},pattern:function(t,e,n,i){if(!a(t)||!t.toString().match(F[n]||n))return this.format(o.pattern,this.formatLabel(e,i),n)}}}();return u}(e),t.Validation});