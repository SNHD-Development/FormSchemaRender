define(["jquery","underscore","backbone","collections/collections"],function(e,t,n,r){var i=function(e,n){var i={},s={};return t.each(n.fields,function(e){e.options=e.options||{};switch(e.type.toLowerCase()){case"address":var o=typeof n.validation[e.name]!="undefined",u=o&&n.validation[e.name].msg?n.validation[e.name].msg:!1;i[e.name+"_address_street"]="",i[e.name+"_address_city"]="",i[e.name+"_address_state"]="",i[e.name+"_address_zip"]="",i[e.name+"_address_country"]="",o&&(s[e.name+"_address_street"]=t.clone(n.validation[e.name]),s[e.name+"_address_city"]=t.clone(n.validation[e.name]),s[e.name+"_address_state"]=t.clone(n.validation[e.name]),s[e.name+"_address_zip"]=t.clone(n.validation[e.name]),s[e.name+"_address_country"]=t.clone(n.validation[e.name]),u&&(s[e.name+"_address_street"].msg=n.validation[e.name].msg+" (Street)",s[e.name+"_address_city"].msg=n.validation[e.name].msg+" (City)",s[e.name+"_address_state"].msg=n.validation[e.name].msg+" (State)",s[e.name+"_address_zip"].msg=n.validation[e.name].msg+" (ZIP)",s[e.name+"_address_country"].msg=n.validation[e.name].msg+" (Country)"));break;case"fullname":var o=typeof n.validation[e.name]!="undefined",u=o&&n.validation[e.name].msg?n.validation[e.name].msg:!1;typeof e.options.middlename!="undefined"&&e.options.middlename&&(i[e.name+"_fullname_middle_name"]=""),i[e.name+"_fullname_first_name"]="",i[e.name+"_fullname_last_name"]="",o&&(s[e.name+"_fullname_first_name"]=t.clone(n.validation[e.name]),s[e.name+"_fullname_last_name"]=t.clone(n.validation[e.name]),u&&(s[e.name+"_fullname_first_name"].msg=n.validation[e.name].msg+" (First Name)",s[e.name+"_fullname_last_name"].msg=n.validation[e.name].msg+" (Last Name)"));break;case"list":i[e.name]=new r,typeof n.validation[e.name]!="undefined"&&(s[e.name]=t.clone(n.validation[e.name]));break;case"fieldsetstart":case"fieldsetend":case"fieldset":case"clear":case"action":case"button":case"submit":case"hr":case"html":case"step":break;case"birthdate":i[e.name]="",i[e.name+"_birth[month]"]="",i[e.name+"_birth[day]"]="",i[e.name+"_birth[year]"]="",typeof n.validation[e.name]!="undefined"&&(s[e.name]=t.clone(n.validation[e.name]),s[e.name+"_birth[month]"]=t.clone(n.validation[e.name]),s[e.name+"_birth[day]"]=t.clone(n.validation[e.name]),s[e.name+"_birth[year]"]=t.clone(n.validation[e.name]));break;case"email":i[e.name]="",typeof n.validation[e.name]!="undefined"&&(s[e.name]=t.clone(n.validation[e.name]),e.options.autocomplete&&(s[e.name+"_username"]=t.clone(n.validation[e.name]),s[e.name+"_server"]=t.clone(n.validation[e.name])));break;default:i[e.name]="",typeof n.validation[e.name]!="undefined"&&(s[e.name]=t.clone(n.validation[e.name]))}}),e.validation=s,i};return n.Model.extend({initialize:function(){var n=i(this,this.attributes);this.clear(),this.set(n),this.on("validated:invalid",function(n,r){t.each(r,function(t,n){e(':input[name="'+n+'"]').addClass("invalid")})})},setTrim:function(r,i,s){var o;i=e.trim(i),t.isObject(r)||r==null?(o=r,s=i):(o={},o[r]=i),s=s||{},s.trim&&(o[r]=e.trim(o[r])),n.Model.prototype.set.call(this,o,s)},appendSubFormInput:function(n){var r=t.clone(this.toJSON());t.each(r,function(t,r){typeof t.toJSON=="function"&&e("#"+n).prepend('<input type="hidden" name="'+r+"\" value='"+JSON.stringify(t.toJSON())+'\' class="subform_before_submit">')})}})});