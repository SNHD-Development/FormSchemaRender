define(["jquery","underscore","backbone","text!templates/modules/formreloadwhenstatuschange.html","jquery.purl"],function(t,e,o,a){function n(o){setTimeout(function(){t.ajax({cache:!1,url:o.ajaxUrl,success:function(a,r){if(e.isString(a)&&(a=JSON.parse(a)),!e.isObject(a))throw"FormReloadWhenStatusChange Module expected data to be an object. (got "+typeof a+")";var i=t.trim(a.Status);if(o.tmpData.from=t.trim(o.tmpData.from),i===o.tmpData.from)return void n(o);o.tmpData.to=i,o.render(!0)},error:function(t,e,o){throw"FormReloadWhenStatusChange Module Ajax Error: "+o}})},o.timer)}return o.View.extend({template:e.template(a),shouldRenderModules:function(){var t=this.options.options;return t.internal&&t.formData&&t.formData._id},initialize:function(){if(this.shouldRenderModules()){if(!t.url)throw"Could not be able to load $.url plugin.";var e=(t.url(),this.options.options);this.ajaxUrl="/formproxy",e.formData._id&&e.formData._id.$oid&&(this.ajaxUrl+="?id="+t.trim(e.formData._id.$oid)),this.timer=3e3,this.refreshTimer=5e3,this.tmpData={from:e.formData.status,to:null,seconds:this.refreshTimer/1e3},this.modalOptions={keyboard:!1,show:!0,backdrop:"static"}}},render:function(t){var e=this;if(t=t||!1,this.shouldRenderModules())if(t){this.$el.append(this.template(this.tmpData));var o=this.$("#formreloadwhenstatuschange");o.on("shown",function(){var t=o.find("#formreloadwhenstatuschange-cnt");e._countDown=setInterval(function(){var o=parseInt(t.text(),10);o--,o>0?t.text(o):(clearInterval(e._countDown),delete e._countDown,location.reload())},1e3)}).modal(this.modalOptions)}else n(this)},events:{"click #formreloadwhenstatuschange button.btn-danger":function(t){this._countDown&&(clearInterval(this._countDown),delete this._countDown)},"click #formreloadwhenstatuschange button.btn-primary":function(t){location.reload()}}})});