define(["jquery","lodash","backbone","vm","utils","events","text!templates/subform-layouts/table.html","text!templates/notice/confirmation.html"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({template:t.template(o),popTemplate:t.template(u),initialize:function(){this.collection.on("reset",this.resetCollection,this)},render:function(){var n=this,r=[],s=new Array(this.collection.length),o=new Array(this.collection.length);t.each(this.options.formSchema.fields,function(e){r.push(e.description),t.each(n.collection.models,function(t,n){var u=t.toJSON(),a;typeof s[n]=="undefined"&&(s[n]=[],o[n]=t.cid);switch(e.type.toLowerCase()){case"timestamp":r[r.length-1]="Time",s[n].push(i.getHumanTime(u[e.name]));break;case"fullname":a=u[e.name+"_fullname_first_name"],typeof u[e.name+"_fullname_middle_name"]!="undefined"&&(a+=" "+u[e.name+"_fullname_middle_name"]),a+=" "+u[e.name+"_fullname_last_name"],s[n].push(a);break;default:s[n].push(u[e.name])}})}),e(this.el).html(this.template({labels:r,values:s,modelId:o}))},events:{"click .subform-edit-model":"editModel","click .subform-remove-model":"popoverConfirm","click .popover-action .popover-submit":"removeModel","click .popover-action .popover-cancel":"removePopover"},editModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",this.collection.get(n))},popoverConfirm:function(t){t.preventDefault();var n={html:!0,placement:"bottom",trigger:"manual",title:"Do you want to remove this data?",content:this.popTemplate({id:e(t.currentTarget,this.el).attr("data-id")})};e(t.currentTarget,this.el).popover(n).popover("show")},removeModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");this.collection.remove(this.collection.get(n)),this.collection.length>0?this.render():this.$el.html("")},removePopover:function(t){e(".subform-remove-model",e(t.currentTarget,this.el).parents(".subform-actions")).popover("destroy").next(".popover").remove()},resetCollection:function(e){this.$el.html("")}});return a});