define(["jquery","lodash","backbone","vm","utils","events","views/baseField","text!templates/subform-layouts/table.html","text!templates/notice/confirmation.html","bootstrap"],function(e,t,o,n,i,a,s,l,r){var m=!1,c=o.View.extend({template:t.template(l),popTemplate:t.template(r),clean:function(){i.destroyPopover(this.$el)},initialize:function(){this.collection.on("reset",this.resetCollection,this)},render:function(){var o=!1;o&&console.log("[*] render table.js in subform-layouts -"),this.options||(this.options={}),this.options.options||(this.options.options={});var a,l=this,r=[],m=new Array(this.collection.length),c=new Array(this.collection.length),p=this.options.options.lang,h=this.options.formSchema;this.options&&this.options.formSchema&&!this.options.formSchema.options&&(this.options.formSchema.options={});var d={};h&&t.each(h.fields,function(e){if(e&&e.name&&e.type&&e.values){var t="values-"+p;d[e.name]=e[t]?e[t]:e.values}});var u,f=this.options;t.each(this.options.formSchema.fields,function(o){switch(o&&(o.options||(o.options={})),o.type.toLowerCase()){case"fieldsetstart":case"fieldsetend":return}s.prototype.checkShowOnMode.call(l,o,f.options.mode,f.options.formData.status)&&(o.options&&o.options.showontable===!1||(o.options&&o.options.tabletitle?(a=o.options.tabletitle,a='<a data-content="'+e("<p>"+o.description+"</p>").text()+'" data-original-title="'+o.options.tabletitle+'" data-placement="top" data-toggle="popover" data-trigger="hover" data-html="true">'+a+"</a>"):a=o.description,r.push(a),t.each(l.collection.models,function(e,t){var a,s=e.toJSON();switch("undefined"==typeof m[t]&&(m[t]=[],c[t]=e.cid),o.type.toLowerCase()){case"country":var l=n.getCountry(s[o.name]);l||(l=s[o.name]),m[t].push(l);break;case"timestamp":r[r.length-1]="Timestamps",m[t].push(i.getHumanTime(s[o.name]));break;case"useraccount":u=r.length-1,r[u]="User",m[t].push(s[o.name]);break;case"fullname":a=s[o.name+"_fullname_first_name"]?s[o.name+"_fullname_first_name"]:"","undefined"!=typeof s[o.name+"_fullname_middle_name"]&&(a+=" "+s[o.name+"_fullname_middle_name"]),a&&(a+=" "),a+=s[o.name+"_fullname_last_name"]?s[o.name+"_fullname_last_name"]:"",m[t].push(a);break;case"booleaninput":var p=s[o.name]===!0?"Yes":s[o.name]===!1?"No":"";m[t].push(p);break;case"number":var h;h=o.options&&o.options.decimals&&s[o.name]?(s[o.name]/Math.pow(10,o.options.decimals)).toFixed(o.options.decimals):s[o.name],m[t].push(h);break;case"date":var f=s[o.name];if(f&&f.$date){if(f=moment(f.$date),!f.isValid())throw new Error('Invalid Date in "'+o.name+'" with "'+JSON.stringify(s[o.name])+'"');f=f.format("MM/DD/YYYY")}m[t].push(f);break;default:var v=s[o.name];d&&d[o.name]&&"undefined"!=typeof d[o.name][v]&&(v=d[o.name][v]),m[t].push(v)}})))}),e(this.el).html(this.template({labels:r,values:m,modelId:c,heading:"undefined"!=typeof this.options.formSchema.options.readmodedescription?this.options.formSchema.options.readmodedescription:this.options.formSchema.name,showViewBtn:this.options.formSchema.options.showviewbtn,addOnly:this.options.formSchema.options.addonly,selfOnly:!this.options.formSchema.options.addonly&&this.options.formSchema.options.selfonly,currentUser:i.getUserIdFormHtml(),userIndex:u})),i.setupPopover(this.$el)},events:{"click .subform-read-model":"readModel","click .subform-edit-model":"editModel","click .subform-remove-model":"popoverConfirm","click .popover-action .popover-submit":"removeModel","click .popover-action .popover-cancel":"removePopover"},readModel:function(t){t.preventDefault();var o=e(t.currentTarget,this.el).attr("data-id");if(m){var n=this.collection.toJSON();console.log('[*] Click on readModel with index = "'+o+'" found ['+n.length+"]"),console.log(n),console.log(this.collection.get(o).toJSON())}e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",[this.collection.get(o),void 0,void 0,!0])},editModel:function(t){t.preventDefault();var o=e(t.currentTarget,this.el).attr("data-id");if(m){var n=this.collection.toJSON();console.log('[*] Click on editModel with index = "'+o+'" found ['+n.length+"]"),console.log(n),console.log(this.collection.get(o).toJSON())}e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",this.collection.get(o))},popoverConfirm:function(t){t.preventDefault();var o={html:!0,placement:"top",trigger:"manual",title:"Do you want to remove this data?",content:this.popTemplate({id:e(t.currentTarget,this.el).attr("data-id")})};e(t.currentTarget,this.el).popover(o).popover("show")},removeModel:function(t){t.preventDefault();var o=e(t.currentTarget,this.el).attr("data-id");this.collection.remove(this.collection.get(o)),this.collection.length>0?this.render():this.$el.html("")},removePopover:function(t){e(".subform-remove-model",e(t.currentTarget,this.el).parents(".subform-actions")).popover("destroy").next(".popover").remove()},resetCollection:function(e){this.$el.html("")}});return c});