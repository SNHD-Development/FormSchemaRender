define(["jquery","lodash","backbone","vm","utils","events","text!templates/subform-layouts/table.html","text!templates/notice/confirmation.html","bootstrap"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({template:t.template(o),popTemplate:t.template(u),clean:function(){i.destroyPopover(this.$el)},initialize:function(){this.collection.on("reset",this.resetCollection,this)},render:function(){var n=this,r=[],s=new Array(this.collection.length),o=new Array(this.collection.length),u;t.each(this.options.formSchema.fields,function(a){switch(a.type.toLowerCase()){case"fieldsetstart":case"fieldsetend":return}a.options&&a.options.tabletitle?(u=a.options.tabletitle,u='<a data-content="'+e("<p>"+a.description+"</p>").text()+'" data-original-title="'+a.options.tabletitle+'" data-placement="top" data-toggle="popover" data-trigger="hover" data-html="true">'+u+"</a>"):u=a.description,r.push(u),t.each(n.collection.models,function(e,t){var n=e.toJSON(),u;typeof s[t]=="undefined"&&(s[t]=[],o[t]=e.cid);switch(a.type.toLowerCase()){case"timestamp":r[r.length-1]="Time",s[t].push(i.getHumanTime(n[a.name]));break;case"useraccount":r[r.length-1]="User",s[t].push(n[a.name]);break;case"fullname":u=n[a.name+"_fullname_first_name"],typeof n[a.name+"_fullname_middle_name"]!="undefined"&&(u+=" "+n[a.name+"_fullname_middle_name"]),u+=" "+n[a.name+"_fullname_last_name"],s[t].push(u);break;case"booleaninput":var f=n[a.name]===!0?"Yes":n[a.name]===!1?"No":"";s[t].push(f);break;default:s[t].push(n[a.name])}})}),e(this.el).html(this.template({labels:r,values:s,modelId:o,heading:typeof this.options.formSchema.options.readmodedescription!="undefined"?this.options.formSchema.options.readmodedescription:this.options.formSchema.name})),i.setupPopover(this.$el)},events:{"click .subform-edit-model":"editModel","click .subform-remove-model":"popoverConfirm","click .popover-action .popover-submit":"removeModel","click .popover-action .popover-cancel":"removePopover"},editModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",this.collection.get(n))},popoverConfirm:function(t){t.preventDefault();var n={html:!0,placement:"bottom",trigger:"manual",title:"Do you want to remove this data?",content:this.popTemplate({id:e(t.currentTarget,this.el).attr("data-id")})};e(t.currentTarget,this.el).popover(n).popover("show")},removeModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");this.collection.remove(this.collection.get(n)),this.collection.length>0?this.render():this.$el.html("")},removePopover:function(t){e(".subform-remove-model",e(t.currentTarget,this.el).parents(".subform-actions")).popover("destroy").next(".popover").remove()},resetCollection:function(e){this.$el.html("")}});return a});