define(["jquery","lodash","backbone","vm","utils","events","views/baseField","text!templates/subform-layouts/table.html","text!templates/notice/confirmation.html","bootstrap"],function(e,t,n,r,i,s,o,u,a){var f=!1,l=n.View.extend({template:t.template(u),popTemplate:t.template(a),clean:function(){i.destroyPopover(this.$el)},initialize:function(){this.collection.on("reset",this.resetCollection,this)},render:function(){var n=this,r=[],s=new Array(this.collection.length),u=new Array(this.collection.length),a;this.options&&this.options.formSchema&&!this.options.formSchema.options&&(this.options.formSchema.options={});var f=this.options,l;t.each(this.options.formSchema.fields,function(c){c&&(c.options||(c.options={}));switch(c.type.toLowerCase()){case"fieldsetstart":case"fieldsetend":return}if(!o.prototype.checkShowOnMode.call(n,c,f.options.mode,f.options.formData.status))return;if(c.options&&c.options.showontable===!1)return;c.options&&c.options.tabletitle?(a=c.options.tabletitle,a='<a data-content="'+e("<p>"+c.description+"</p>").text()+'" data-original-title="'+c.options.tabletitle+'" data-placement="top" data-toggle="popover" data-trigger="hover" data-html="true">'+a+"</a>"):a=c.description,r.push(a),t.each(n.collection.models,function(e,t){var n=e.toJSON(),o;typeof s[t]=="undefined"&&(s[t]=[],u[t]=e.cid);switch(c.type.toLowerCase()){case"timestamp":r[r.length-1]="Timestamps",s[t].push(i.getHumanTime(n[c.name]));break;case"useraccount":l=r.length-1,r[l]="User",s[t].push(n[c.name]);break;case"fullname":o=n[c.name+"_fullname_first_name"],typeof n[c.name+"_fullname_middle_name"]!="undefined"&&(o+=" "+n[c.name+"_fullname_middle_name"]),o+=" "+n[c.name+"_fullname_last_name"],s[t].push(o);break;case"booleaninput":var a=n[c.name]===!0?"Yes":n[c.name]===!1?"No":"";s[t].push(a);break;case"number":var f;c.options&&c.options.decimals&&n[c.name]?f=(n[c.name]/Math.pow(10,c.options.decimals)).toFixed(c.options.decimals):f=n[c.name],s[t].push(f);break;default:s[t].push(n[c.name])}})}),e(this.el).html(this.template({labels:r,values:s,modelId:u,heading:typeof this.options.formSchema.options.readmodedescription!="undefined"?this.options.formSchema.options.readmodedescription:this.options.formSchema.name,showViewBtn:this.options.formSchema.options.showviewbtn,addOnly:this.options.formSchema.options.addonly,selfOnly:this.options.formSchema.options.addonly?!1:this.options.formSchema.options.selfonly,currentUser:i.getUserIdFormHtml(),userIndex:l})),i.setupPopover(this.$el)},events:{"click .subform-read-model":"readModel","click .subform-edit-model":"editModel","click .subform-remove-model":"popoverConfirm","click .popover-action .popover-submit":"removeModel","click .popover-action .popover-cancel":"removePopover"},readModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");if(f){var r=this.collection.toJSON();console.log('[*] Click on readModel with index = "'+n+'" found ['+r.length+"]"),console.log(r),console.log(this.collection.get(n).toJSON())}e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",[this.collection.get(n),undefined,undefined,!0])},editModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");if(f){var r=this.collection.toJSON();console.log('[*] Click on editModel with index = "'+n+'" found ['+r.length+"]"),console.log(r),console.log(this.collection.get(n).toJSON())}e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",this.collection.get(n))},popoverConfirm:function(t){t.preventDefault();var n={html:!0,placement:"top",trigger:"manual",title:"Do you want to remove this data?",content:this.popTemplate({id:e(t.currentTarget,this.el).attr("data-id")})};e(t.currentTarget,this.el).popover(n).popover("show")},removeModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");this.collection.remove(this.collection.get(n)),this.collection.length>0?this.render():this.$el.html("")},removePopover:function(t){e(".subform-remove-model",e(t.currentTarget,this.el).parents(".subform-actions")).popover("destroy").next(".popover").remove()},resetCollection:function(e){this.$el.html("")}});return l});