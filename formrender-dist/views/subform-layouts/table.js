define(["jquery","lodash","backbone","vm","utils","events","views/baseField","text!templates/subform-layouts/table.html","text!templates/notice/confirmation.html","bootstrap"],function(e,t,n,r,i,s,o,u,a){var f=!1,l=n.View.extend({template:t.template(u),popTemplate:t.template(a),clean:function(){i.destroyPopover(this.$el)},initialize:function(){this.collection.on("reset",this.resetCollection,this)},render:function(){var n=!1;n&&console.log("[*] render table.js in subform-layouts -"),this.options||(this.options={}),this.options.options||(this.options.options={});var r=this,s=[],u=new Array(this.collection.length),a=new Array(this.collection.length),f,l=this.options.options.lang,c=this.options.formSchema;this.options&&this.options.formSchema&&!this.options.formSchema.options&&(this.options.formSchema.options={});var h={};c&&t.each(c.fields,function(e){if(!e||!e.name||!e.type||!e.values)return;var t="values-"+l;h[e.name]=e[t]?e[t]:e.values});var p=this.options,d;t.each(this.options.formSchema.fields,function(n){n&&(n.options||(n.options={}));switch(n.type.toLowerCase()){case"fieldsetstart":case"fieldsetend":return}if(!o.prototype.checkShowOnMode.call(r,n,p.options.mode,p.options.formData.status))return;if(n.options&&n.options.showontable===!1)return;n.options&&n.options.tabletitle?(f=n.options.tabletitle,f='<a data-content="'+e("<p>"+n.description+"</p>").text()+'" data-original-title="'+n.options.tabletitle+'" data-placement="top" data-toggle="popover" data-trigger="hover" data-html="true">'+f+"</a>"):f=n.description,s.push(f),t.each(r.collection.models,function(e,t){var r=e.toJSON(),o;typeof u[t]=="undefined"&&(u[t]=[],a[t]=e.cid);switch(n.type.toLowerCase()){case"timestamp":s[s.length-1]="Timestamps",u[t].push(i.getHumanTime(r[n.name]));break;case"useraccount":d=s.length-1,s[d]="User",u[t].push(r[n.name]);break;case"fullname":o=r[n.name+"_fullname_first_name"],typeof r[n.name+"_fullname_middle_name"]!="undefined"&&(o+=" "+r[n.name+"_fullname_middle_name"]),o+=" "+r[n.name+"_fullname_last_name"],u[t].push(o);break;case"booleaninput":var f=r[n.name]===!0?"Yes":r[n.name]===!1?"No":"";u[t].push(f);break;case"number":var l;n.options&&n.options.decimals&&r[n.name]?l=(r[n.name]/Math.pow(10,n.options.decimals)).toFixed(n.options.decimals):l=r[n.name],u[t].push(l);break;case"date":var c=r[n.name];if(c&&c.$date){c=moment(c.$date);if(!c.isValid())throw new Error('Invalid Date in "'+n.name+'" with "'+JSON.stringify(r[n.name])+'"');c=c.format("MM/DD/YYYY")}u[t].push(c);break;default:var p=r[n.name];h&&h[n.name]&&typeof h[n.name][p]!="undefined"&&(p=h[n.name][p]),u[t].push(p)}})}),e(this.el).html(this.template({labels:s,values:u,modelId:a,heading:typeof this.options.formSchema.options.readmodedescription!="undefined"?this.options.formSchema.options.readmodedescription:this.options.formSchema.name,showViewBtn:this.options.formSchema.options.showviewbtn,addOnly:this.options.formSchema.options.addonly,selfOnly:this.options.formSchema.options.addonly?!1:this.options.formSchema.options.selfonly,currentUser:i.getUserIdFormHtml(),userIndex:d})),i.setupPopover(this.$el)},events:{"click .subform-read-model":"readModel","click .subform-edit-model":"editModel","click .subform-remove-model":"popoverConfirm","click .popover-action .popover-submit":"removeModel","click .popover-action .popover-cancel":"removePopover"},readModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");if(f){var r=this.collection.toJSON();console.log('[*] Click on readModel with index = "'+n+'" found ['+r.length+"]"),console.log(r),console.log(this.collection.get(n).toJSON())}e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",[this.collection.get(n),undefined,undefined,!0])},editModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");if(f){var r=this.collection.toJSON();console.log('[*] Click on editModel with index = "'+n+'" found ['+r.length+"]"),console.log(r),console.log(this.collection.get(n).toJSON())}e(".actions .form-view",this.$el.parent(".subform-container")).trigger("click",this.collection.get(n))},popoverConfirm:function(t){t.preventDefault();var n={html:!0,placement:"top",trigger:"manual",title:"Do you want to remove this data?",content:this.popTemplate({id:e(t.currentTarget,this.el).attr("data-id")})};e(t.currentTarget,this.el).popover(n).popover("show")},removeModel:function(t){t.preventDefault();var n=e(t.currentTarget,this.el).attr("data-id");this.collection.remove(this.collection.get(n)),this.collection.length>0?this.render():this.$el.html("")},removePopover:function(t){e(".subform-remove-model",e(t.currentTarget,this.el).parents(".subform-actions")).popover("destroy").next(".popover").remove()},resetCollection:function(e){this.$el.html("")}});return l});