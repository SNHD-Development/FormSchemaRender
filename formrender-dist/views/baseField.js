define(["jquery","underscore","backbone","bootstrap","events","vm","utils","models/model","collections/collections","modelbinder","validation","views/fields/list","text!data/email.json","text!data/schooles.json","text!data/schoolclarkcounty.json","text!data/county.json","text!data/country.json","text!templates/fields/html.html","text!templates/fields/label.html","text!templates/fields/text.html","text!templates/fields/password.html","text!templates/fields/telephone.html","text!templates/fields/socialsecurity.html","text!templates/fields/hidden.html","text!templates/fields/timestamp.html","text!templates/fields/useraccount.html","text!templates/fields/fraction.html","text!templates/fields/booleaninput.html","text!templates/fields/radio.html","text!templates/fields/file.html","text!templates/fields/multifiles.html","text!templates/fields/filerepository.html","text!templates/fields/read-filerepository.html","text!templates/fields/state.html","text!templates/fields/county.html","text!templates/fields/zipcode.html","text!templates/fields/country.html","text!templates/fields/fullname.html","text!templates/fields/address.html","text!templates/fields/textarea.html","text!templates/fields/number.html","text!templates/fields/email.html","text!templates/fields/date.html","text!templates/fields/select.html","text!templates/fields/check.html","text!templates/fields/birthdate.html","text!templates/fields/button.html","text!templates/fields/buttongroup.html","text!templates/fields/list.html","text!templates/fields/uneditableinput.html","text!templates/fields/uneditablecheck.html","text!templates/fields/uneditabletag.html","text!templates/fields/uneditabletel.html","text!templates/fields/uneditablefile.html","text!templates/fields/uneditableimage.html","text!templates/fields/buttonclipboard.html","text!templates/subform-layouts/table.html","text!templates/update-on-read/default-input.html","text!templates/update-on-read/default-input-radio.html","text!templates/update-on-read/default-input-textarea.html","text!templates/update-on-read/default-input-date.html","jquery.expose","jquery.datepicker","jquery.birthdaypicker","bootstrap"],function(t,e,a,o,i,s,n,r,l,d,m,p,u,c,f,h,b,v,_,y,g,D,x,w,k,S,C,F,V,O,L,N,j,E,A,B,I,T,U,M,R,$,J,z,P,q,H,Y,G,K,Q,W,X,Z,tt,et,at,ot,it,st,nt){function rt(t){var e,a=!0;if(lt&&(console.log("[*] buildHtmlBasicFormMarkup"),console.log(arguments)),t.attributes||(t.attributes={}),!t.description)throw'Expected a "description" in buildHtmlBasicFormMarkup parameter.';if(!t.name)throw'Expected a "name" in buildHtmlBasicFormMarkup parameter.';if(!t.type)throw'Expected a "type" in buildHtmlBasicFormMarkup parameter.';var o=t.type.toLowerCase();switch(o){case"hidden":a=!1;var i=t.attributes.value;e='<input type="hidden" name="'+t.name+'" value="'+i+'"/>';break;case"textarea":e='<textarea name="'+t.name+'" class="" id="'+t.name+'"></textarea>';break;case"textbox":e='<input name="'+t.name+'" type="text" class="" id="'+t.name+'"/>';break;default:throw'Not implement "'+t.type+'" yet in buildHtmlBasicFormMarkup.'}return a&&(e='<label for="'+t.name+'">'+t.description+"</label>"+e),'<div class="form-markup-field">'+e+"</div>"}var lt=!1,dt={"default-input":e.template(ot),"default-input-radio":e.template(it),"default-input-textarea":e.template(st),"default-input-date":e.template(nt)};return a.View.extend({_modelBinder:void 0,clean:function(){a.Validation.unbind(this),void 0!==this._modelBinder&&this._modelBinder.unbind()},initialize:function(){var a=this;this._div=0,this._hasUserId=!1,this._hasDate=!1,this._hasBDate=!1,this._DatePickerLogicArr={},this._hasEmailPicker=!1,this._hasBooleanInput=!1,this._hasRadioBtnGroup=!1,this._hasSelectAllCheckBox=!1,this._hasClearAllCheckBox=!1,this._hasOtherTextBox=!1,this._internalFields=[],this._visibleOn=[],this._multiFiles=[],this._buttonClipboards=[],this._buttonDecision=[],this._ajaxDataCall=[],this._javaUpload=[],this._elementData={},this._ajaxSubmit=!0,this._radioFieldName=[],this._lookupValues={},this._listSchema={},this._getValueFrom={},this._visibleonEventAttached={},this._stepDiv=0,this._currentStep=1,this._stepValidated=[],this._modelBinder=new d,this.options.formSchema.validation=this.options.formSchema.validation||{},this.model=new r(e.extend(this.options.formSchema,{is_internal:this.options.internal,render_mode:this.options.mode,status:"update"===this.options.mode&&this.options.formData&&this.options.formData.status?this.options.formData.status:null})),this.options.formData&&!e.isEmpty(this.options.formData)&&this.model.multiFilesDefaultValue&&!e.isEmpty(this.model.multiFilesDefaultValue)&&(this.model.multiFilesDefaultValue=e.reduce(this.model.multiFilesDefaultValue,function(t,e,o){var i=o.replace(/[\[\]]/gi,"");return a.options.formData&&a.options.formData.fields&&a.options.formData.fields[i]&&(t[o]=a.options.formData.fields[i]),t},{})),t.isEmptyObject(this.options.formData)||e.each(this.model.attributes,function(t,e){if("object"==typeof t);else{var o={};o[e]=a.options.formData.fields[e],a.model.set(o)}}),this.prefixedName={list:"subform_",listdisplayid:"_form_content",collectiondisplayid:"_form_collection"},this.notRenderLabel=["html","list","button","submit","clear","fieldset","fieldsetstart","fieldsetend","step","check","checkbox","timestamp","hidden"],this.notRenderLabelRead=["html","list","button","submit","clear","fieldset","fieldsetstart","fieldsetend","step","check","checkbox"],this.inputTemplate={html:e.template(v),label:e.template(_),text:e.template(y),password:e.template(g),telephone:e.template(D),socialsecurity:e.template(x),hidden:e.template(w),timestamp:e.template(k),useraccount:e.template(S),fraction:e.template(C),booleaninput:e.template(F),radio:e.template(V),file:e.template(O),multifiles:e.template(L),filerepository:e.template(N),"read-filerepository":e.template(j),state:e.template(E),county:e.template(A),zipcode:e.template(B),country:e.template(I),fullname:e.template(T),address:e.template(U),textarea:e.template(M),number:e.template(R),email:e.template($),date:e.template(J),select:e.template(z),check:e.template(P),birthdate:e.template(q),button:e.template(H),buttongroup:e.template(Y),list:e.template(G),uneditableinput:e.template(K),uneditablecheck:e.template(Q),uneditabletag:e.template(W),uneditabletel:e.template(X),uneditablefile:e.template(Z),uneditableimage:e.template(tt),buttonclipboard:e.template(et),"subform-table":e.template(at)};var o={submitbutton:"Submit",resetbutton:"Cancel"};this.options.formSchema.formoptions=e.extend(o,this.options.formSchema.formoptions)||o},getFormValidationData:function(t){return this.options.formSchema.validation=this.options.formSchema.validation||{},void 0===this.options.formSchema.validation[t]?{}:this.options.formSchema.validation[t]},closeOpenDiv:function(t){t=t||"_div";for(var e="",a=0,o=this[t];a<o;++a)e+="</div>";return this._div=0,e},render:function(a,o){var i=this,r="",l=[a.name],d=a.type.toLowerCase(),m="",p=t.parseJSON(b);if(a.lang=this.options.lang,a.attributes=a.attributes||{},a.attributes.autocomplete||(a.attributes.autocomplete="off"),a.options=a.options||{},this.options.formSchema.validation=this.options.formSchema.validation||{},this.options.formData=this.options.formData||{},!this.options.internal&&a.options.internal)return"";if(("button"===d||"submit"===d)&&!a.options.internal&&this.options.internal)return"";if(a.options.renderas){switch(d){case"date":this.options.formData&&this.options.formData.fields&&this.options.formData.fields[a.name]&&this.options.formData.fields[a.name].$date&&(this.options.formData.fields[a.name]=n.formatDateAsString(this.options.formData.fields[a.name].$date));break;case"number":break;default:throw'Not Implement Options.RenderAs for "'+d+'" yet!'}d=a.options.renderas.toLowerCase()}switch(d){case"calculate":if(d="hidden",!a.options||!a.options.logic)throw new Error("In order to use "+d+", please set up the Options.Logic");a.attributes["data-logic"]=a.options.logic,a.options.type&&(a.attributes["data-type"]=a.options.type);break;case"booleaninput":this._hasBooleanInput=!0;break;case"radio":this._radioFieldName.push(a.name),!this._hasRadioBtnGroup&&a.options.render&&(this._hasRadioBtnGroup=!0),this.options.formData.fields&&this.options.formData.fields[a.name]&&("read"===this.options.mode&&a.values&&e.isObject(a.values)&&(this._lookupValues[a.name]={value:this.options.formData.fields[a.name],text:a.values[this.options.formData.fields[a.name]]},e.isArray(a.values)||(this.options.formData.fields[a.name]=a.values[this.options.formData.fields[a.name]])),a._data=this.options.formData.fields[a.name]),a.options.orderby&&this.sortOrderBy(a);break;case"multifiles":this.options.internal&&void 0!==a.options.internalcanupdate&&!a.options.internalcanupdate||t("form"+this.el).attr("enctype","multipart/form-data"),this._multiFiles.push(a);var v=this.getFormValidationData(a.name+"[]");void 0===this._stepValidated[this._currentStep-2]||t.isEmptyObject(v)||this._stepValidated[this._currentStep-2].push(a.name+"[]"),"read"===this.options.mode&&(d="file");break;case"filerepository":if(!a.options.url)throw'Expected Url parameter in Options Key for "'+a.name+'".';break;case"image":a.attributes.accept="image/*";case"file":this.options.internal&&void 0!==a.options.internalcanupdate&&!a.options.internalcanupdate||t("form"+this.el).attr("enctype","multipart/form-data");var v=this.getFormValidationData(a.name);if(v.accept&&(a.attributes.accept=v.accept),a.options.javaupload){var _={name:a.name,id:a.name,code:"com.elementit.JavaPowUpload.Manager",archive:"//public.southernnevadahealthdistrict.org/assets/jar/jupload/JavaPowUpload.jar, //public.southernnevadahealthdistrict.org/assets/jar/jupload/skinlf.jar, //public.southernnevadahealthdistrict.org/assets/jar/jupload/commons-httpclient.jar, //public.southernnevadahealthdistrict.org/assets/jar/jupload/commons-compress.jar",width:500,height:350,mayscript:"true",alt:"JavaPowUpload by www.element-it.com"};this._javaUpload.push(_)}if(a.options.markdownloaddatetimeof&&this.options.mode&&"read"===this.options.mode){var y=this.options.internal?"internal":"external",g=a.options.markdownloaddatetimeof.toLowerCase();"*"!==g&&g!==y||(a.attributes.class=(a.attributes.class?a.attributes.class:"")+" btn-auto-refresh ",a.attributes["data-refresh-delay"]||(a.attributes["data-refresh-delay"]="2000"))}break;case"userid":this._hasUserId=!0,a.options&&a.options.lookup&&a.options.lookup.url&&(a.options.url=a.options.lookup.url),a.options.url&&(a.attributes["data-url"]=a.options.url),a.options.data&&(a.attributes["data-url-data"]=JSON.stringify(a.options.data)),a.attributes.placeholder=a.attributes.placeholder||"Valid E-mail as Username",a.attributes.class=(a.attributes.class||"")+" userid-lookup",d=a.options.render?a.options.render.toLowerCase():"text","select"===d&&(a.values=[]),a.attributes.class=n.setupClassAttr(a.attributes.class,"span12");break;case"fraction":break;case"textbox":d="text";case"selectsingle":"selectsingle"===d&&(d="select");case"select":if("update"===this.options.mode&&this.options.formData.fields[a.name]&&(a.attributes["data-select-value"]=this.options.formData.fields[a.name]),a.options&&a.options.lookup&&a.options.lookup.url)a.options.url=a.options.lookup.url,a.options.lookup.value&&(a.attributes["data-select-key-value"]=a.options.lookup.value),a.options.lookup.text&&(a.attributes["data-select-key-text"]=a.options.lookup.text);else if(a.options){if(a.options.tags)a.attributes.class=(a.attributes.class?a.attributes.class:"")+" selecttwo-render tags value-as-array";else if(a.options.render){var D=a.options.render.toLowerCase();switch(D){case"select2":a.attributes.class=(a.attributes.class?a.attributes.class:"")+" selecttwo-render"}}a.options.events&&this.addDataToElementData(a.name,"events",a.options.events),a.options.orderby&&this.sortOrderBy(a),a.options.getvaluefrom&&a.name&&(this._getValueFrom[a.options.getvaluefrom]||(this._getValueFrom[a.name]=a.options.getvaluefrom))}a.options.url&&(a.attributes["data-url"]=a.options.url.replace(/'/gi,"&#39;")),a.options.data&&(a.attributes["data-url-data"]=JSON.stringify(a.options.data)),a.attributes.class=n.setupClassAttr(a.attributes.class,"span12"),this.options.formData&&this.options.formData.fields&&this.options.formData.fields[a.name]&&(e.isArray(this.options.formData.fields[a.name])&&this.options.formData.fields[a.name].sort(function(t,e){return t-e}),"read"===this.options.mode&&a.values&&e.isObject(a.values)&&(a._data=a.values[this.options.formData.fields[a.name]]),this.addDataToElementData(a.name,"value",this.options.formData.fields[a.name]));break;case"country":var x="selecttwo-render";a.attributes.class?a.attributes.class.indexOf(x)<0&&(a.attributes.class+=" "+x):a.attributes.class=x,a._optionsValue=e.extend({},p),a.options.excludecountry&&e.each(a.options.excludecountry,function(t){delete a._optionsValue[t]});break;case"county":"string"==typeof h&&(h=t.parseJSON(h)),a._options=h,a.attributes.id||(a.attributes.id=a.name);var x="select2-county";a.options.filterbyid&&(x="select2-county-lookup"),a.attributes.class?a.attributes.class+=" "+x:a.attributes.class=x,this.options.formData&&this.options.formData.fields&&this.options.formData.fields[a.name]&&(a.attributes["data-countyvalue"]=this.options.formData.fields[a.name]);break;case"checkbox":case"check":if(a.options.numcolumns){if(!e.isNumber(a.options.numcolumns))throw"NumColumns must be a valid number for "+a.name;a.options.numcolumns>4?a.options.numcolumns=4:a.options.numcolumns<1&&(a.options.numcolumns=1)}else a.options.numcolumns=1;if(!this._hasSelectAllCheckBox&&a.options.addselectall&&(this._hasSelectAllCheckBox=!0),!this._hasClearAllCheckBox&&a.options.addclearall&&(this._hasClearAllCheckBox=!0),a.options.orderby&&this.sortOrderBy(a),a.options.othertextbox&&(this._hasOtherTextBox=!0),"update"===this.options.mode&&this.options.formData.fields&&this.options.formData.fields[a.name]&&(a._data=this.options.formData.fields[a.name]),this.options.formData.fields&&this.options.formData.fields[a.name+"_other"]&&(a._otherValue=this.options.formData.fields[a.name+"_other"]),void 0!==this.options.formSchema.validation[a.name+"[]"]){a._required=!0,a.attributes||(a.attributes={}),a.attributes["data-check-required"]=!0;var v=this.getFormValidationData(a.name+"[]");void 0===this._stepValidated[this._currentStep-2]||t.isEmptyObject(v)||this._stepValidated[this._currentStep-2].push(a.name+"[]")}else a._required=!1;if(d="check",!a.values)throw"In order to use CheckBox, please set Values.";break;case"password":a.attributes.class=n.setupClassAttr(a.attributes.class,"span12");break;case"telephone":a.attributes.class=n.setupClassAttr(a.attributes.class,"integer telephone span12"),this.options.formData.fields&&this.options.formData.fields[a.name+"_provider"]&&(a._providerValue=this.options.formData.fields[a.name+"_provider"]);break;case"socialsecurity":a.attributes.class=n.setupClassAttr(a.attributes.class,"integer socialsecurity span12");break;case"textarea":a.attributes.class=n.setupClassAttr(a.attributes.class,"span12");break;case"action":return this._div++,'<div class="form-actions">';case"fieldsetstart":return"<fieldset><legend>"+a.description+"</legend>";case"fieldsetend":return"</fieldset>";case"hr":return"<hr>";case"dateinput":d="date";case"date":if(this.options.formData&&this.options.formData.fields)if("object"==typeof this.options.formData.fields[a.name]){var w=new Date(this.options.formData.fields[a.name].$date),k=w.getMonth()+1;k<10&&(k="0"+k),k+="/";var S=w.getDate();if(S<10&&(S="0"+S),S+="/",this.options.formData.fields[a.name]=k+S+w.getFullYear(),a.options.render&&"read"===this.options.mode)switch(a.options.render.toLowerCase()){case"datetime":this.options.formData.fields[a.name]+=" "+n.formatAMPM(w)}a.attributes.value=this.options.formData.fields[a.name]}else"create"===this.options.mode&&void 0===this.options.formData.fields[a.name]&&(a._noDefaultValue=!0);if(a.attributes&&!a.attributes.placeholder&&(a.attributes.placeholder="mm/dd/yyyy"),a.options.render&&"select"===a.options.render.toLowerCase()){d="birthdate",this._hasBDate=!0,a.attributes.class=n.setupClassAttr(a.attributes.class,"birthdaypicker");var v=this.getFormValidationData(a.name),C={id:a.name};"en"!==a.lang&&(C.lang=a.lang),void 0!==this.options.formData.fields&&(C.defaultdate=this.options.formData.fields[a.name]),a._noDefaultValue&&(C.nodefaultvalue=!0),a.attributes["data-options"]=JSON.stringify(e.extend(C,v)),void 0===this._stepValidated[this._currentStep-2]||t.isEmptyObject(v)||(this._stepValidated[this._currentStep-2].push(a.name+"_birth[month]"),this._stepValidated[this._currentStep-2].push(a.name+"_birth[day]"),this._stepValidated[this._currentStep-2].push(a.name+"_birth[year]"))}else{this._hasDate=!0,a.attributes.class=n.setupClassAttr(a.attributes.class,"datepicker");var v=this.getFormValidationData(a.name);e.each(v,function(t,e){delete v[e],v[e.toLowerCase()]=t}),v.maxdate&&(a.attributes["data-maxdate"]=v.maxdate),v.mindate&&(a.attributes["data-mindate"]=v.mindate),a.options&&a.options.datepickeroptions&&(this._DatePickerLogicArr[a.name]=a.options.datepickeroptions,a.attributes["data-has-datepicker-options"]=!0)}break;case"email":a.attributes.class=n.setupClassAttr(a.attributes.class,"tolowercase span12"),void 0!==a.options.autocomplete&&a.options.autocomplete&&(this._hasEmailPicker=!0,a.attributes={},a.attributes["data-provide"]="typeahead",a.attributes.autocomplete="off",a.attributes.style="width:45%;",a.attributes.class="not_sending emailpicker_server tolowercase",a.attributes["data-source"]=u.replace(/\n/g,"").replace(/'/g,"&#39"),void 0!==a.options.default&&(a.attributes["data-value"]=a.options.default),l.push(a.name+"_username"),l.push(a.name+"_server"));break;case"address":if(delete a.attributes.class,delete a.attributes.placeholder,l=[],l.push(a.name+"_address_street"),l.push(a.name+"_address_city"),l.push(a.name+"_address_state"),l.push(a.name+"_address_zip"),l.push(a.name+"_address_country"),a.options.showstreetnumber&&l.push(a.name+"_address_street_number"),a.options.showunitnumber&&l.push(a.name+"_address_unit_number"),void 0!==o&&void 0!==this.options.formData?(this.options.formData.fields[a.name+"_address_country"]=s.getCountry(this.options.formData.fields[a.name+"_address_country"]),this.options.formData.fields[a.name+"_address_street"]&&"."!==this.options.formData.fields[a.name+"_address_street"].charAt(this.options.formData.fields[a.name+"_address_street"].length-1)&&(this.options.formData.fields[a.name+"_address_street"]+="."),this.options.formData.fields[a.name+"_address_street"]+="<br>",this.options.formData.fields[a.name+"_address_city"]+=",",this.options.formData.fields[a.name+"_address_state"]+="<br>",this.options.formData.fields[a.name+"_address_zip"]+="<br>"):"update"===this.options.mode&&"US"!==this.options.formData.fields[a.name+"_address_country"]?a.default_value_state=this.options.formData.fields[a.name+"_address_state"]:"create"===this.options.mode&&(this.model.set(a.name+"_address_state","NV"),this.model.set(a.name+"_address_country","US")),a.options.zipcodeformat){switch(a.options.zipcodeformat.toLowerCase()){case"zip+4":a._zipmax=10}}break;case"number":var F;if(!a.options.numbertype||a.options.decimals)F=a.options.decimals?"number":"natural",a.options.decimals&&(a.attributes["data-decimal"]=a.options.decimals);else if(a.options.numbertype&&!a.options.limitinputvalue)switch(a.options.numbertype.toLowerCase()){case"currency":F="number";break;case"double":F="rational";break;default:F="natural"}else F="natural";if(a.options.limitinputvalue&&(F=a.options.limitinputvalue),!F||"string"!=typeof F)throw new Error('Could not be able to find matching class name for "'+a.name+'" for a number input type.');if(a.attributes.class=n.setupClassAttr(a.attributes.class,F+" span12"),a.options.decimals&&this.options.formData.fields&&this.options.formData.fields[a.name]){var V=parseFloat(this.options.formData.fields[a.name]/Math.pow(10,parseInt(a.options.decimals,10)));isNaN(V)||(this.options.formData.fields[a.name]=V.toFixed(a.options.decimals),a.attributes.value=this.options.formData.fields[a.name],this.model.has(a.name)&&this.model.set(a.name,this.options.formData.fields[a.name]))}void 0!==a.options.spinner&&a.options.spinner&&(a.attributes.class=a.attributes.class.replace(/ span12/,"","gi"),a.attributes.class=n.setupClassAttr(a.attributes.class,"spinner-input"),"update"===this.options.mode&&this.options.formData.fields[a.name]&&(a.attributes["data-value"]=this.options.formData.fields[a.name]));break;case"fullname":if(delete a.attributes.class,delete a.attributes.placeholder,l=[],l.push(a.name+"_fullname_first_name"),(void 0===a.options.middlename||a.options.middlename)&&l.push(a.name+"_fullname_middle_name"),l.push(a.name+"_fullname_last_name"),a.options.url&&this._ajaxDataCall.push(a),"read"===this.options.mode&&a.options&&a.options.highlight){var O=a.options.highlight.toLowerCase().split(",");e.each(O,function(t){var e=a.name+"_fullname_"+t;i.options.formData.fields[e]&&(i.options.formData.fields[e]="<u>"+i.options.formData.fields[e]+"</u>")})}break;case"clear":d="button",a.attributes.class=n.setupClassAttr(a.attributes.class,"btn btn-clear-form");break;case"submit":a.attributes.class=n.setupClassAttr(a.attributes.class,"btn"),d="button",a._submit=!0,void 0===a.url&&(a.url=""),a.options.appendid&&this.options.formData._id&&this.options.formData._id.$oid&&(a.url=(a.url?a.url:"")+(a.url.indexOf("?")>-1?"&id=":"/")+this.options.formData._id.$oid),t(this.el).attr("action",a.url),void 0!==a.options.ajaxsubmit&&(this._ajaxSubmit=a.options.ajaxsubmit);break;case"buttonclipboard":a.attributes.class=n.setupClassAttr(a.attributes.class,"btn btn-primary"),this._buttonClipboards.push({name:a.name,values:a.values});break;case"buttondecision":o||(a.attributes.class=n.setupClassAttr(a.attributes.class,"btn btn-primary"),d="button",this._buttonDecision.push(a));break;case"button":if(!n.shouldRenderShowOnUser(a))return"";if(a.attributes.class=n.setupClassAttr(a.attributes.class,"btn"),this.options&&this.options.formData&&this.options.formData._id&&this.options.formData._id.$oid&&(a.options.appendid?a.url=(a.url?a.url:"")+(a.url.indexOf("?")>-1?"&id=":"/")+this.options.formData._id.$oid:a.url&&a.url.search(/{\w+}/gi)>-1&&(a.url=n.formatUriSegment(a.url,this.options.formData))),a.url&&(a.url=n.changeURLGetTemplateString(a.url)),this.options.internal&&"read"===this.options.mode&&"BtnMarkAsUnacceptable"===a.name&&t.fn.remodal){var L=e.find(this.options.formSchema.fields,function(t){if(t&&t.name&&t.type)return"UnacceptableReason"===t.name?t:void 0});if(L){var N=this.options.formData&&this.options.formData.fields&&this.options.formData.fields.UnacceptableReason?this.options.formData.fields.UnacceptableReason:null;N&&N.replace&&(N=N.replace(/'/gi,"\\'"));var j=(new Date).getTime();switch(a.options["data-remodal-target"]="btnmarkasunacceptable_"+j,a.options["data-remodal-current-value"]=N,a.options["data-current-form-id"]=this.options.formData._id.$oid,a.options["data-url-mark-as-unacceptable"]=a.url,L.type.toLowerCase()){case"radio":if(!L.values)throw new Error("Expected a values key!");a._customHtml=e.reduce(L.values,function(t,a,o,i){var s="UnacceptableReason_"+o,n=e.isArray(i)?a:o,r=N&&N===n?'checked="true"':"";return n&&n.replace&&(n=n.replace(/"/gi,"&quot;")),t+'<label class="radio"><input '+r+' name="UnacceptableReason" id="'+s+'" value="'+n+'" type="radio">'+a+"</label>"},"");break;case"textarea":a._customHtml='<textarea autocomplete="off" name="UnacceptableReason" id="UnacceptableReason"></textarea>';break;default:throw new Error("Not implement "+L.type+" yet!")}a.options.confirmed=null}}if(a.options.confirmed){var E=a.options.confirmedtext?a.options.confirmedtext:"Please confirm your selection.",A={html:!0,placement:"top",title:'<span class="text-info">'+E+"</span>",content:'<a class="btn btn-success btn-confirmed" data-href="'+a.url+'">Yes</button><a class="btn btn-danger btn-confirmed">No</button>'};a.attributes["data-popover-confirm"]=JSON.stringify(A)}else if(a.options.subbuttons)a.name||(a.name="subbuttons_"+a.description.replace(/ /g,"").toLowerCase(),a.attributes.id||(a.attributes.id=a.name)),require(["views/subform-layouts/subbuttons"],function(e){var o=a.attributes.id?a.attributes.id:a.name;s.create(this,o,e,{subbuttons:a.options.subbuttons,internal:!!i.options.internal&&i.options.internal,mode:i.options.mode,status:i.options.formData&&i.options.formData.status?i.options.formData.status:null,_id:o,button:t(".form-render #"+o),_oid:i.options.formData&&i.options.formData._id&&i.options.formData._id.$oid?i.options.formData._id.$oid:null})});else if(a.options.subform){if("read"!==this.options.mode)return"";if(!a.name)throw"Expected a valid Name for SubForm Button.";var B=this.options.formData&&this.options.formData._id&&this.options.formData._id.$oid?this.options.formData._id.$oid:null;if(!B)throw"Expected a valid ID for SubForm Button.";var I=a.options.subform;if(!I.url||"string"!=typeof I.url)throw"Please pass in URL key as a string in SubForm options.";if(!I.fields||!e.isArray(I.fields))throw"Please pass in URL key as an array in SubForm options.";var T="",U=a.options.subform.validation;e.each(I.fields,function(t){T+=rt(t)}),T='<div class="subform-button-wrapper">'+T+'<div class="text-center"><a class="btn btn-primary subform-btn-submit" data-button-name="'+a.name+'">Submit</a></div></div>',t("div#app").on(this.options.formSchema.name+".renderCompleted",function(o,i){var s=t(this).find("button#"+a.name);if(1!==s.length)throw"Invalid SubForm Button, please make sure that the name is unique.";s.popover({html:!0,placement:"top",trigger:"manual",title:'<span class="text-info">Please complete this form.</span>',content:T}),s.on("click",function(t){if(s.hasClass("submitted"))return!1;s.hasClass("shown")?s.removeClass("shown").popover("hide"):s.addClass("shown").popover("show")}),s.parent().on("click",".subform-btn-submit",function(o){o.preventDefault(),o.stopPropagation();var i=t(o.target).attr("data-button-name");if(i!==s.attr("data-button-name")&&s.next(".popover").find(".subform-btn-submit").attr("data-button-name")!==i)return!1;var n=s.next(".popover").find(".subform-button-wrapper"),r=n.find(":input"),l={},d=!1;if(r.each(function(){var e=t(this),a=e.attr("name"),o=e.val();if(!a||""===a)throw"expect valid input name!";U&&U[a]&&(U[a].required&&""===o?(e.addClass("invalid"),d=!0):e.removeClass("invalid")),l[a]=o}),!d){var m="subform-btn-"+(new Date).getTime().toString(),p="",u=e.extend({},I.get);e.each(l,function(t,e){var a=e.toLowerCase();u.hasOwnProperty(a)?(delete u[a],u[e]=t):p+='<input type="hidden" name="'+e+'" value="'+t+'"/>'}),"/"!==a.options.subform.url[a.options.subform.url.length-1]&&(a.options.subform.url+="/");var c=a.options.subform.url+B;u&&(c+="?"+t.param(u)),t("body").append('<form id="'+m+'" action="'+c+'" method="POST">'+p+"</form>"),s.removeClass("shown").popover("destroy"),s.popover({html:!0,placement:"top",trigger:"manual",title:'<span class="text-info">Sending Information</span>',content:'<div class="text-center subform-button-wrapper"><i class="icon-spinner icon-spin icon-large"></i> Sending</div>'}).addClass("submitted").popover("show"),s.closest(".form-actions").find(":button").attr("disabled",!0),window.setTimeout(function(){t("body").find("#"+m).submit()},1e3)}return!1})})}break;case"schooles":case"schoolclarkcounty":var M=d;d="text",a.attributes.class=n.setupClassAttr(a.attributes.class,"span12"),a.attributes["data-provide"]="typeahead",a.attributes.autocomplete="off";var R;switch(M){case"schooles":R=c;break;case"schoolclarkcounty":R=f;break;default:throw new Error('Not mapped school data for "'+M+'" yet!')}a.attributes["data-source"]=R.replace(/\r\n/g,"").replace(/\n/g,"").replace(/'/g,"&#39").replace(/,/g,"&#44");break;case"step":if(!("view"in this.options.formSchema&&"wizard"===this.options.formSchema.view))return"";0!==this._stepDiv&&(r+="</div>",this._stepDiv--),void 0===this._stepValidated[this._currentStep-1]&&(this._stepValidated[this._currentStep-1]=[]);var $="step-pane"+(1===this._currentStep?" active":"");r+='<div class="'+$+'" id="wizard_step'+this._currentStep+'">',this._stepDiv++,this._currentStep++;break;case"useraccount":a.data_value="",a.options.getvaluefromid&&(a.data_value=t("#"+a.options.getvaluefromid).text());break;case"list":a.attributes.id=this.prefixedName.list+(void 0!==a.attributes.id?a.attributes.id:a.name),a.attributes.class=n.setupClassAttr(a.attributes.class,"subform-container");var J=void 0!==this.options.formSchema.validation[a.name]?this.options.formSchema.validation[a.name]:{};this.attachSubFormEvent(a.attributes.id,a,J),this._listSchema[a.name]=a;break;case"hidden":var z=["update","create"];e.indexOf(z,this.options.mode)>-1&&this.options.formData&&this.options.formData.fields&&this.options.formData.fields[a.name]&&(a.attributes||(a.attributes={}),a.attributes.value=this.options.formData.fields[a.name])}if("button"===d&&a.options.visibleon){var P=function(e){"change"===e.type&&a.options.visibleon.values.indexOf(t(this).val())>-1?t("#"+a.name,i.el).show("slow"):t("#"+a.name,i.el).hide("slow")};t(this.el).on("change",':input[name="'+a.options.visibleon.name+'"]',P).on("removeVisibleOn",':input[name="'+a.options.visibleon.name+'"]',P)}if(void 0!==this._stepValidated[this._currentStep-2]&&"step"!==d&&"list"!==d&&n.checkRequireFields(a,this.options.formSchema.validation)&&e.each(l,function(t){i._stepValidated[i._currentStep-2].push(t)}),void 0!==o&&o&&void 0!==l[0]&&"button"!==d&&"buttonclipboard"!==d){var q="",H="";if(e.each(l,function(t){"object"!=typeof i.options.formData.fields[t]?q+=(void 0!==i.options.formData.fields[t]?i.options.formData.fields[t]:"")+" ":q=i.options.formData.fields[t]}),"string"==typeof q&&(q=t.trim(q)),"file"===d||"image"===d){if("image"===d)"deleted"===i.options.formData.fields[a.name]?H=null:(a.attributes.src=(void 0!==a.attributes.src?a.attributes.src:"/form/getFile/")+i.options.formData.fields[a.name],H=a.attributes.src);else if(a.attributes.target="_blank",a.attributes.class=n.setupClassAttr(a.attributes.class,"btn btn-primary"),a.attributes.href=(void 0!==a.attributes.href?a.attributes.href:"/form/getFile/")+i.options.formData.fields[a.name],a.attributes.id||(a.attributes.id=a.name),a.options.markdownloaddatetimeof&&this.options.formData._id&&this.options.formData._id.$oid){var Y=a.options.markdownloaddatetimeof.toLowerCase();("*"===Y||this.options.internal&&"internal"===Y||!this.options.internal&&"external"===Y)&&(a.attributes.href+="?formid="+this.options.formData._id.$oid)}else a.options.appendid&&this.options.formData._id&&this.options.formData._id.$oid&&(a.attributes.href+="?formid="+this.options.formData._id.$oid);delete a.attributes.accept,e.each(a.attributes,function(t,e){t.search("'")&&(t=t.replace(/\'/gi,'"')),m+=" "+e+"='"+t+"'"}),r+=i.inputTemplate["uneditable"+d]({value:q,text:a.description,_attr:m,id:a.name,href:H})}else if("list"===d)if(void 0!==this.options.formData.fields[a.name]&&(this.options.formData.fields[a.name].length>0||e.size(this.options.formData.fields[a.name])>0)){var G=[],K=[],Q=[],W={},X=0,Z=new Array(this.options.formData.fields[a.name].length||e.size(this.options.formData.fields[a.name]));e.each(a.fields,function(o,s){o.options=o.options||{};var r;o.options.tabletitle?(r=o.options.tabletitle,r='<a data-content="'+t("<p>"+o.description+"</p>").text()+'" data-original-title="'+r+'" data-placement="top" data-toggle="popover" data-trigger="hover" data-html="true">'+r+"</a>"):r=o.description,G.push(r),o.options.sortby&&"date"===o.options.sortby.toLowerCase()?K.push('data-sort="int"'):K.push(o.options.sortby?'data-sort="'+o.options.sortby+'"':'data-sort="string"'),e.each(i.options.formData.fields[a.name],function(t,a){var i;if(e.isNumber(a)||(W[o.name]?(X++,a=X):(X=0,W[o.name]=!0,a=X)),void 0===Z[a]&&(Z[a]=[],Q[a]=[]),o.options.sortby&&"date"===o.options.sortby.toLowerCase()){var s=Date.parseString(t[o.name],"M/d/yyyy h:mm:ss a")
;Q[a].push('data-sort-value="'+s.getTime()+'"')}else Q[a].push(null);switch(o.type.toLowerCase()){case"timestamp":var r;r=o.options&&o.options.tabletitle?o.options.tabletitle:"Timestamps",G[G.length-1]=r,Z[a].push(n.getHumanTime(t[o.name]));break;case"useraccount":G[G.length-1]="User",Z[a].push(t[o.name]);break;case"fullname":i=t[o.name+"_fullname_first_name"],void 0!==t[o.name+"_fullname_middle_name"]&&(i+=" "+t[o.name+"_fullname_middle_name"]),i+=" "+t[o.name+"_fullname_last_name"],Z[a].push(i);break;case"booleaninput":Z[a].push(t[o.name]?"Yes":"No");break;case"date":var l=t[o.name];if(l&&l.$date){if(l=moment(l.$date),!l.isValid())throw new Error('Invalid Date Value for "'+o.name+'" with "'+t[o.name]+'"');l=l.format("MM/DD/YYYY")}Z[a].push(l);break;case"number":o.options&&o.options.decimals&&t[o.name]&&(t[o.name]=(t[o.name]/Math.pow(10,o.options.decimals)).toFixed(o.options.decimals));default:if(void 0===t[o.name])return void delete G[G.length-1];Z[a].push(t[o.name])}})}),r+=i.inputTemplate["subform-table"]({labels:G,values:Z,mode:o,sortBy:K,sortByVal:Q,heading:void 0===a.options.readmodedescription?a.description:a.options.readmodedescription})}else r+="";else if("telephone"===d&&a._providerValue)r+=i.inputTemplate.uneditabletel({value:q,label:a.description,id:a.name,providerValue:a._providerValue});else if("check"===d)r+=i.inputTemplate.uneditablecheck({value:q,label:a.description,id:a.name,otherValue:a._otherValue?a._otherValue:""});else if("select"===d&&a.options&&a.options.tags)e.isArray(q)&&q.sort(function(t,e){return t-e}),r+=i.inputTemplate.uneditabletag({value:q,id:a.name});else if("filerepository"===d)r+=i.inputTemplate["read-filerepository"](e.extend({data:this.options.formData.fields[a.name],formId:this.options.formData._id.$oid,Utils:n},a));else{var tt="";switch(d){case"textarea":case"address":tt=" uneditable-input-textarea";break;case"timestamp":q=n.getHumanTime(q);break;case"select":a._data&&(q=a._data);break;case"booleaninput":q="true"===q||!0===q?"Yes":"No"}var et=["ParentFormId","FormRecordId"];if(a.name&&this.options.internal&&e.indexOf(et,a.name)>-1){var at=n.config.internalViewUrl,ot=[];i.options.formData.fields.MultipleFormRecordId?ot=i.options.formData.fields.MultipleFormRecordId.split(","):ot.push(q),e.each(ot,function(t){r+='<a class="btn btn-primary" title="View FormId = '+t+'" href="'+at+"/"+t+'" style="margin-right:20px;">View</a>'})}else r+="html"===d?a.description:i.inputTemplate.uneditableinput({value:q,css_class:tt,id:a.name})}}else if("image"===d&&void 0!==a.options.internalcanupdate&&this.options.internal&&!1===a.options.internalcanupdate){var q="",H="";e.each(l,function(t){"object"!=typeof i.options.formData.fields[t]?q+=(void 0!==i.options.formData.fields[t]?i.options.formData.fields[t]:"")+" ":q=i.options.formData.fields[t]}),"string"==typeof q&&(q=t.trim(q)),"deleted"===i.options.formData.fields[a.name]?H=null:(a.attributes.src=(void 0!==a.attributes.src?a.attributes.src:"/form/getFile/")+i.options.formData.fields[a.name],H=a.attributes.src),delete a.attributes.accept,e.each(a.attributes,function(t,e){t.search("'")&&(t=t.replace(/\'/gi,'"')),m+=" "+e+"='"+t+"'"}),r+=i.inputTemplate["uneditable"+d]({value:q,text:a.description,_attr:m,id:a.name,href:H})}else{if(this.options.internal&&void 0!==a.options.internalcanupdate&&!a.options.internalcanupdate?d="hidden":e.each(a.attributes,function(t,e){m+=" "+e+"='"+t+"'"}),"image"===d&&(d="file"),lt&&(console.log(""),console.log("[*] Render HTML Field"),console.log(a),console.log(m)),lt&&void 0===this.inputTemplate[d])throw'Template of "'+d+'" not found!';r+=void 0!==this.inputTemplate[d]?this.inputTemplate[d](e.extend({_attr:m,_lang:this.options.lang,_renderMode:this.options.mode},a)):""}if(a.options.visibleon){if(!a.options.visibleon.name||!t.isArray(a.options.visibleon.values))throw a.name+".Options.VisibleOn need Name and Values!";this._visibleOn.push(a)}return a&&a.type&&!this.inputTemplate[d]&&console&&console.warn&&console.warn('[x] Template for "'+a.type+'" does not existed.'),a.options.updateonreadmode&&(r='<div class="update-on-read-mode" data-field-name="'+a.name+'">'+r+this.generateMarkUpForUpdateOnReadMode(a)+"</div>"),r},renderLabel:function(t,a,o){a=a||!1,t.attributes=t.attributes||{},t.options=t.options||{};var i=t.type.toLowerCase(),s=void 0!==o&&o?' class="'+o+'"':"";switch(t.options.renderas&&(i=t.options.renderas.toLowerCase()),i){case"calculate":return"";case"hidden":if("create"===this.options.mode)return"";break;case"buttondecision":return""}return this.inputTemplate.label(e.extend({_cssClass:s,_required:a},t))},renderButton:function(t){var e="";return(t.submitbutton||t.resetbutton)&&(e+='<div class="form-actions">'),t.submitbutton&&!t.subForm?e+='<button type="submit" class="btn btn-primary btn-submit">'+t.submitbutton+"</button>":e+='<button type="button" class="btn btn-primary btn-submit">'+t.submitbutton+"</button>",t.resetbutton&&(e+='<button type="button" class="btn btn-cancel">'+t.resetbutton+"</button>"),e.length>0&&(e+="</div>"),e},checkShowOnMode:function(a,o,i){var s=a.type.toLowerCase();if(void 0!=a.options.internal&&a.options.internal!==this.options.internal)return!1;if(!0===a.options.internal&&a.name&&"buttonclipboard"!==s){var n;switch(s){case"check":case"checkbox":n=a.name+"[]";break;default:n=a.name}this._internalFields.push(n)}if(this.options.hideButtons&&("button"===s||"submit"===s||"reset"===s||"action"===s))return!1;if("read"===this.options.mode&&!t.isEmptyObject(a.options.visibleon)&&void 0===this.options.formData.fields[a.name]&&"fullname"!==s&&"address"!==s&&"buttonclipboard"!==s)return!1;if(o=o||!1,i=i||!1,"read"!==o&&"buttonclipboard"===a.type.toLowerCase())return!1;if("read"===o&&!this.options.internal&&a.options.hideonexternalread)return!1;if(void 0!==a.options.showonmode&&-1===a.options.showonmode.indexOf(o))return!1;if(void 0!==a.options.showonstatus){var r=e.map(a.options.showonstatus,function(t){return t.toLowerCase()});if("create"!==this.options.mode&&(!1===i||-1===r.indexOf(i.toLowerCase())))return!1}else if(this.options.internal&&"update"===o&&void 0!==a.options.internalcanupdate&&!a.options.internalcanupdate&&"image"!==s)return!1;return!0},attachSubFormEvent:function(o,i,s){i=e.extend(i,{validation:s});var n=this,r={el:"#"+o+this.prefixedName.listdisplayid,formSchema:i,formId:o,options:this.options},l=e.extend({},a.Events);t(this.el).on("click","#"+o+"_add_btn",r,this.displaySubForm).on(o+".close",this.closeSubForm).on(o+".add",e.extend({formId:o},this),this.addSubformData),"update"===this.options.mode&&void 0!==this.options.formData.fields[i.name]&&this.options.formData.fields[i.name].length>0?l.on(r.formId+".listViewCreated",function(e){console.log("- "+r.formId+".listViewCreated"),console.log(" - that.el:",n.el),console.log(" - id:",o),console.log(" - list:",e),console.log(" - that.options.formData.fields[field.name]:",n.options.formData.fields[i.name]),t(n.el).trigger(o+".add",[e,n.options.formData.fields[i.name]]),l.off()}):l.on(r.formId+".listViewCreated",function(e){var a=t("#"+r.formId,n.el),i=function(s,l){t(n.el).trigger(o+".add",[e,l,!0]),a.one(r.formId+".ajaxUpdate",i)};a.one(r.formId+".ajaxUpdate",i),l.off()}),l.on(r.formId+".listViewCreated",function(t){e.isEmpty(n._listSchema)||e.each(n._listSchema,function(e,a){n.setupSubFormListenValueEvent(n,e,a,r,l,o,t)})}),this.displaySubForm({data:r},{},!0,l)},displaySubForm:function(a,o,i,n,r){if(r=r||!1,a.data){lt&&(console.log("[*] baseField.displaySubForm"),o&&o.toJSON&&console.log(o.toJSON()),console.log(i),console.log(n),console.log(r)),o=o||{},i=i||!1,n=n||!1;var l,d=e.clone(a.data);t.isEmptyObject(o)?l="SubFormView"+a.data.formId:(d.model=o,l="SubFormViewEdit"+a.data.formId),t(this).parents("div.actions").fadeOut(),require(["views/fields/list"],function(e){lt&&(console.log("- displaySubForm: Render List!"),d.model&&console.log(JSON.stringify(d.model)));var o=s.create(this,l,e,d),m=t(o.el);i&&m.hide(),o.render(i,r),i||(m.show({complete:function(){},done:function(){}}),m.addClass("active"),m.expose({closeOnEsc:!1,closeOnClick:!1,color:"#000",zIndex:1025,renderBody:!1})),n&&n.trigger(a.data.formId+".listViewCreated",o)})}},setupSubFormListenValueEvent:function(o,i,s,n,r,l,d){if(i.options&&i.options.copyvaluesfrom){var m=i.options.copyvaluesfrom;if(m&&m.length){var p=t("div#app");e.each(m,function(i,n){e.each(i,function(e,i){var r=':input[name="'+e+'"]';p.on("change",r,function(e){var r=t(e.target),m=r.val();if(m&&(m=t.trim(m)),o.model.has(s)){var p,u=o.model.get(s),c=a.Model.extend({});if(u.length){if(!(p=u.at(n)))throw new Error("Please look at List CopyValuesFrom logic!");if(p.get(i)===m)return;p.set(i,m)}else p=new c,p.set(i,m),u.push(p);t(o.el).trigger(l+".add",[d,u.toJSON(),!0])}})})})}}},closeSubForm:function(e,a){a.$el.fadeOut(),t.mask.close(),t(".actions",a.$el.parent(".subform-container")).fadeIn("slow"),s.remove("SubFormView"+a.options.formId,!0),s.remove("SubFormViewEdit"+a.options.formId,!0)},addSubformData:function(o,i,r,l){lt&&(console.log("[*] baseField.addSubformData"),console.log(arguments)),l=l||!1,r=r||!1;var d=i.options.formSchema.view?i.options.formSchema.view:"table",m=i.options.formSchema.name,p=o.data.model.get(m);if(lt&&(console.log("- addSubformData:currentModel"),console.log(m),console.log("- currentModel: ",p,typeof p),p.toJSON&&console.log(p.toJSON())),"object"!=typeof p&&(lt&&(console.log("- currentModel is not object!"),console.log(o.data.model)),o.data.model._listFieldType[m]&&(lt&&console.log("- e.data.model._listFieldType[_key]: ",o.data.model._listFieldType[m]),o.data.model.set(m,o.data.model._listFieldType[m]),p=o.data.model.get(m))),l&&p.reset(),r){var u=a.Model.extend({});e.each(r,function(t){var e=new u;e.set(t),p.add(e)}),lt&&(console.log("- addSubformData:"),console.log(p.toJSON()))}else lt&&(console.log("- addSubformData:list.model.toJSON()"),console.log(i.model.toJSON())),p.add(i.model);var c=i.options.formSchema.options||{};if(c.copyvaluesfrom&&!r){var f=i.model.cid;if(e.isArray(c.copyvaluesfrom)){for(var h,b,v=0;v<p.length;v++){var _=p.at(v);if(lt&&console.log(" - cid:",_.cid," = _listModelCid:",f),_.cid===f){h=v,b=_;break}}if(void 0!==h&&"null"!=typeof h&&c.copyvaluesfrom[h]&&!e.isEmpty(c.copyvaluesfrom[h])){var y=t("#"+i.options.options.formSchema.name);e.each(c.copyvaluesfrom[h],function(e,a){var o,i=y.find(':input[name="'+e+'"]'),s=b.get(a);i.length>1?t(i).each(function(e){var a=t(this);if(a.val()===s){if(!a.is(":radio"))throw new Error("Not implement Radio in List - CopyValuesFrom yet!");a.attr("checked",!0)}else if(!a.is(":radio"))throw new Error("Not implement Radio in List - CopyValuesFrom yet!")}):(o=i.val(),s!==o&&i.val(s).trigger("change"))})}}}require(["views/subform-layouts/"+d],function(e){lt&&(console.log('    in "views/subform-layouts/'+d+'"'),console.log(p.toJSON()));var a={el:"#"+i.options.formId+o.data.prefixedName.collectiondisplayid,formSchema:i.options.formSchema,collection:p,options:i.options.options},r=s.create(this,"CollectionView"+o.data.formId,e,a);if(r.render(),o.data.closeSubForm(o,i),i.options.formSchema.options&&i.options.formSchema.options.permission){var l=n.getUserIdFormHtml().replace("\\","\\\\"),m=new RegExp(l,"ig");switch(i.options.formSchema.options.permission.toLowerCase()){case"readwriteselfcreated":r.$el.find("table tr").each(function(){var e=t(this),a=!1;e.find("td").each(function(){t(this).text().match(m)&&(a=!0)}),a||e.find("td.subform-actions button.btn").remove()});break;default:throw i.options.formSchema.options.permission+" not implement yet!"}}})},setupVisibleOn:function(a,o,i,s){i=i||!1;var r=this,l=a.type.toLowerCase();if(!a.name)throw"In order to use VisibleOn option, we need to pass in the Name";switch(i||(a.options.visibleon.parentcontainer?i=a.options.visibleon.parentcontainer:"booleaninput"===l?i=".form-render_booleaninput_wrapper":a.options.visibleon&&a.options.visibleon.name&&e.indexOf(this._radioFieldName,a.options.visibleon.name)>-1&&(i=".radio-container")),i&&a.options&&a.options.visibleon&&a.options.visibleon.parentcontainer&&a.options.visibleon.parentcontainer!==i&&(i=a.options.visibleon.parentcontainer),l){case"address":delete this.model.validation[a.name+"_address_street"],delete this.model.validation[a.name+"_address_city"],delete this.model.validation[a.name+"_address_state"],delete this.model.validation[a.name+"_address_zip"],delete this.model.validation[a.name+"_address_country"],delete this.model.validation[a.name+"_address_street_number"],delete this.model.validation[a.name+"_address_unit_number"];break;case"multifiles":delete this.model.validation[a.name+"[]"];break;default:delete this.model.validation[a.name]}var d=a.options.visibleon.name,m=s&&s[d]&&"checkbox"===s[d]?':input[name="'+d+'[]"]':':input[name="'+d+'"]';t(this.el).on("change",m,function(s){var d,m,p=t(s.currentTarget),u=i?p.parents(i):p,c=[],f=a.options.visibleon.name,h=p.val(),b=["","[]"];u.length||i!==a.options.visibleon.parentcontainer||(u=p.parents(".form-render").find(i));var v=p.attr("name"),_=v.match(/\w+\[\]$/gi);a.options.visibleon.values;if(e.isArray(a.options.visibleon.values)&&e.find(a.options.visibleon.values,function(t){return t===h}),_&&_.length&&(_=!0),_){var y=p.is(":checked");p.closest(".checkbox-container").find(":checkbox:checked").each(function(o){var i=t(this).val();if(!y&&h===i)return void(h=null);h!==i&&e.indexOf(a.options.visibleon.values,i)>-1&&(h=i)}),y||h!==p.val()||(h=null)}else f.match(/\[\]$/gi)?(u.length||(u=p.closest(".checkbox-container")),f=f.substr(0,f.length-2),u=u.closest(".checkbox-container"),p.is(":checkbox")&&(h="",u.find(":checkbox:checked").each(function(){var o=t(this).val();e.indexOf(a.options.visibleon.values,o)>-1&&(h=o)}))):p.is(":radio")&&!i&&(u=p.closest(".radio-container"));var g=!0;if(a&&a.options&&a.options.visibleon&&a.options.visibleon.steps){if(!e.isArray(a.options.visibleon.steps)||!a.options.visibleon.steps.length)throw new Error(a.name+" must not contain an empty VisibleOn.Steps");for(var D=a.options.visibleon.steps,x=0;x<D.length;x++){var w=D[x],k=w.values;if(!k||!e.isArray(k)){var S="undefined"!=typeof JSON&&JSON&&JSON.stringify?JSON.stringify(w):null;throw new Error('Expects an array for "Values" in "'+S+'"')}var C=t(':input[name="'+w.name+'"]'),F=t.trim(C.val()),V=e.indexOf(k,F),O=w.notin?V<0:V>-1;if(!O){g=!1;break}}}if(e.indexOf(a.options.visibleon.values,h)>-1&&g){if(t(".options-visible-on-"+a.name,r.el).length<1){if(u.after(o),d=u.next(".options-visible-on-"+a.name).fadeIn("slow",function(){var o=t(this).addClass("visible-parent-"+f).attr("data-parent",f);n.setupSelect2(o);var i=t(".options-visible-on-"+f,r.el);if(t('[class*="visible-parent-'+f+'"]',r.el).not(".visible-parent-"+f+",.options-visible-on-"+f+",.visible-parent-"+i.attr("data-parent")).remove(),"multifiles"===l?t("#"+a.name+"_multifiles_wrapper",this).trigger("visibleOnRenderComplete"):t(':input[name="'+a.name+'"]',this).trigger("visibleOnRenderComplete"),!r.model.bindings[a.name]&&e.indexOf(r.model.notBinding,a.name)<0){var s=a.name;e.each(b,function(e){s===a.name&&t(':input[name="'+s+e+'"]').length&&(s=a.name+e)}),t(':input[name="'+s+'"]').length&&"checkbox"!==l&&(r.model.bindModelBinder(s,a.type),r._modelBinder.bind(r.model,r.el,r.model.bindings))}}),m=u.next("div"),0===m.length&&(m=u.parent()),m.find(":input").not('input[type="hidden"]').placeholder(),"address"===l){var L=a.name+"_address_street";r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),L=a.name+"_address_city",r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),L=a.name+"_address_state",r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),L=a.name+"_address_zip",r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),L=a.name+"_address_country",r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),L=a.name+"_address_street_number",r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),L=a.name+"_address_unit_number",r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L]),c.push(L),a.options.hidecountry&&r.model.set(L,"US")}else r.options.formSchema.validation[a.name]&&"html"!==l?(r.model.validation[a.name]=r.options.formSchema.validation[a.name],c.push(a.name)):r.options.formSchema.validation[a.name+"[]"]&&(r.model.validation[a.name+"[]"]=r.options.formSchema.validation[a.name+"[]"],c.push(a.name+"[]"));if("update"===r.options.mode&&c.length>0)e.each(c,function(e){if(r.options.formData.fields[e]){r.model.set(e,r.options.formData.fields[e]);var a=t(':input[name="'+e+'"]',d);switch(l){case"radio":case"check":case"checkbox":a.filter('[value="'+r.options.formData.fields[e]+'"]').prop("checked",!0);break;default:a.is(":radio")||a.is(":checkbox")||a.val(r.options.formData.fields[e])}}});else if("update"===r.options.mode)switch(l){case"fullname":e.each(["_fullname_first_name","_fullname_middle_name","_fullname_last_name"],function(e){var o=a.name+e,i=t(':input[name="'+o+'"]',d);i.length&&r.options.formData.fields[o]&&i.val(r.options.formData.fields[o])});break;default:if(r.options.formData.fields[a.name]){var N=t(':input[name="'+a.name+'"]',d);N.is(":radio")||N.is(":checkbox")||(N.val(r.options.formData.fields[a.name]),r.model.set(a.name,r.options.formData.fields[a.name]))}}if("userid"===l&&(n.setupUserIdAjaxCall(t("form.form-render")),r.model.validation[a.name].pattern||a.options.render&&"select"===a.options.render.toLowerCase()||(r.model.validation[a.name].pattern="email")),n.setupUrlAjaxCall(t("form.form-render"),t("#"+a.name)),r._hasDate&&n.setupDateInput(r.el,r),r._hasBDate&&a&&a.type&&a.options&&a.options.render&&"date"===a.type.toLowerCase()){var j=a.options.render;try{j=j.toLowerCase();var E=".options-visible-on-"+a.name;switch("string"==typeof r.el&&(E=r.el+" "+E),j){case"select":n.setupBDateInput(E,r.model)}}catch(t){console&&console.error&&console.error(t)}}}}else if(t("#"+a.name,r.el).trigger("removeVisibleOn"),t(".options-visible-on-"+a.name,r.el).remove(),t(".visible-parent-"+a.name,r.el).remove(),"date"===l&&a.options&&a.options.render){var A=a.options.render;try{switch(A=A.toLowerCase()){case"select":var B=a.name+"_birth";void 0!==e&&e?(e.map(["day","month","year"],function(t){var e=B+"["+t+"]";r.model.validation[e]&&delete r.model.validation[e]}),r.model.validation[a.name]&&delete r.model.validation[a.name]):console&&console.error&&console.error('Could not be able to locate "_".');break;default:throw new Error('Not implement delete for "'+A+'"')}}catch(t){console&&console.error&&console.error(t)}}else if("fullname"===l)e.map(["_fullname_first_name","_fullname_last_name"],function(t){var e=a.name+t;r.model.validation[e]&&delete r.model.validation[e]});else if("address"===l){var L=a.name+"_address_street";r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L]),L=a.name+"_address_city",r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L]),L=a.name+"_address_state",r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L]),L=a.name+"_address_zip",r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L]),L=a.name+"_address_country",r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L]),L=a.name+"_address_street_number",r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L]),L=a.name+"_address_unit_number",r.model.set(L,""),r.options.formSchema.validation[L]&&(r.model.validation[L]=r.options.formSchema.validation[L],delete r.model.validation[L])}else if("html"!==l){r.model.set(a.name,""),r.model.validation[a.name]?delete r.model.validation[a.name]:r.model.validation[a.name+"[]"]&&delete r.model.validation[a.name+"[]"];var I=a.name;e.each(b,function(t){if(r.model.bindings[I+t]){r.model.unbindModelBinder(I+t,a.type);for(var o=!0;o;)try{r._modelBinder.bind(r.model,r.el,r.model.bindings),o=!1}catch(t){o=!1;var i=t.match(/name="(\w+)"/i);if(i||console&&console.error&&console.error(t),2===i.length){var s=i[1];e.each(b,function(t){r.model.bindings[s+t]&&(r.model.unbindModelBinder(s+t,a.type),r.model.validation[s+t]&&delete r.model.validation[s+t],o=!0)})}}if(!p.is(":checkbox")){var n=p.attr("name");p.is(":radio")||p.val(h),r.model.get(n)!==h&&r.model.set(n,h)}}}),p.is(":radio")&&p.prop("checked",!0)}}),this&&this.options&&"update"===this.options.mode&&t("#"+this.options.formSchema.name).on(this.options.formSchema.name+".renderCompleted",function(){a&&a.options&&a.options.visibleon&&e.forEach(a.options.visibleon.values,function(e){t(m).filter(":checkbox:checked").each(function(){var a=t(this),o=a.val();e===o&&a.trigger("change")})})})},setupCopyValuesFrom:function(a){if("list"!==a.type.toLowerCase()){if(!a.options.copyvaluesfrom.name||!a.options.copyvaluesfrom.description)throw"In order to use CopyValuesFrom options, need to have Name and Description";var o=this,i="";return i+='<div class="copy-values-from '+a.options.copyvaluesfrom.name+'">'+this.inputTemplate.buttongroup({description:a.options.copyvaluesfrom.description})+"</div>",t(this.el).on("click",".copy-values-from."+a.options.copyvaluesfrom.name+" .btn-group button",function(i){var s,r,l=t(i.currentTarget),d=[];l.hasClass("btn-yes")&&(s=n.getSpecialFieldsName(a.options.copyvaluesfrom.name,a.type),e.each(s,function(e){d.push(t(':input[name="'+e+'"]',o.el).val())}),r=n.getSpecialFieldsName(a.name,a.type),n.setFieldsValues(o.el,o.model,r,d))}),i}},sortOrderBy:function(t){var e,a=t.options.orderby;(a||t.values)&&(a=a.toLowerCase(),e=function(t,e){return t.localeCompare(e)},t.values.sort&&t.values.sort(e))},addDataToElementData:function(t,e,a){this._elementData[t]||(this._elementData[t]={}),this._elementData[t][e]=a},generateMarkUpForUpdateOnReadMode:function(t){if(!t.type)return console&&console.warn&&console.warn('[x] generateMarkUpForUpdateOnReadMode for "'+t.name+'" could not be able to find "Type".'),"";var a,o,i=t.type.trim().toLowerCase(),s=this.options.formData.fields[t.name];switch(i){case"file":throw"Not yet support!";default:o="text"}switch(i){case"radio":a=dt["default-input-radio"](e.extend({data:s},t));break;case"textarea":a=dt["default-input-textarea"](e.extend({data:s},t));break;case"date":a=dt["default-input-date"](e.extend({data:s},t));break;default:a=dt["default-input"](e.extend({inputType:o,data:s},t))}return a}})});