define(["jquery","underscore","backbone","bootstrap","events","vm","utils","models/model","collections/collections","modelbinder","validation","views/fields/list","text!data/email.json","text!data/schooles.json","text!data/county.json","text!templates/fields/html.html","text!templates/fields/label.html","text!templates/fields/text.html","text!templates/fields/password.html","text!templates/fields/telephone.html","text!templates/fields/socialsecurity.html","text!templates/fields/hidden.html","text!templates/fields/timestamp.html","text!templates/fields/useraccount.html","text!templates/fields/fraction.html","text!templates/fields/booleaninput.html","text!templates/fields/radio.html","text!templates/fields/file.html","text!templates/fields/multifiles.html","text!templates/fields/filerepository.html","text!templates/fields/read-filerepository.html","text!templates/fields/state.html","text!templates/fields/county.html","text!templates/fields/zipcode.html","text!templates/fields/country.html","text!templates/fields/fullname.html","text!templates/fields/address.html","text!templates/fields/textarea.html","text!templates/fields/number.html","text!templates/fields/email.html","text!templates/fields/date.html","text!templates/fields/select.html","text!templates/fields/check.html","text!templates/fields/birthdate.html","text!templates/fields/button.html","text!templates/fields/buttongroup.html","text!templates/fields/list.html","text!templates/fields/uneditableinput.html","text!templates/fields/uneditablecheck.html","text!templates/fields/uneditabletag.html","text!templates/fields/uneditabletel.html","text!templates/fields/uneditablefile.html","text!templates/fields/uneditableimage.html","text!templates/fields/buttonclipboard.html","text!templates/subform-layouts/table.html","text!templates/update-on-read/default-input.html","text!templates/update-on-read/default-input-radio.html","text!templates/update-on-read/default-input-textarea.html","text!templates/update-on-read/default-input-date.html","jquery.expose","jquery.datepicker","jquery.birthdaypicker","bootstrap"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it){function ut(e){var t,n=!0;st&&(console.log("[*] buildHtmlBasicFormMarkup"),console.log(arguments)),e.attributes||(e.attributes={});if(!e.description)throw'Expected a "description" in buildHtmlBasicFormMarkup parameter.';if(!e.name)throw'Expected a "name" in buildHtmlBasicFormMarkup parameter.';if(!e.type)throw'Expected a "type" in buildHtmlBasicFormMarkup parameter.';var r=e.type.toLowerCase(),i="";switch(r){case"hidden":n=!1;var s=e.attributes.value;t='<input type="hidden" name="'+e.name+'" value="'+s+'"/>';break;case"textarea":t='<textarea name="'+e.name+'" class="'+i+'" id="'+e.name+'"></textarea>';break;case"textbox":t='<input name="'+e.name+'" type="text" class="'+i+'" id="'+e.name+'"/>';break;default:throw'Not implement "'+e.type+'" yet in buildHtmlBasicFormMarkup.'}return n&&(t='<label for="'+e.name+'">'+e.description+"</label>"+t),'<div class="form-markup-field">'+t+"</div>"}var st=!1,ot={"default-input":t.template(tt),"default-input-radio":t.template(nt),"default-input-textarea":t.template(rt),"default-input-date":t.template(it)};return n.View.extend({_modelBinder:undefined,clean:function(){n.Validation.unbind(this),typeof this._modelBinder!="undefined"&&this._modelBinder.unbind()},initialize:function(){var n=this;this._div=0,this._hasUserId=!1,this._hasDate=!1,this._hasBDate=!1,this._DatePickerLogicArr={},this._hasEmailPicker=!1,this._hasBooleanInput=!1,this._hasRadioBtnGroup=!1,this._hasSelectAllCheckBox=!1,this._hasClearAllCheckBox=!1,this._hasOtherTextBox=!1,this._internalFields=[],this._visibleOn=[],this._multiFiles=[],this._buttonClipboards=[],this._buttonDecision=[],this._ajaxDataCall=[],this._javaUpload=[],this._elementData={},this._ajaxSubmit=!0,this._radioFieldName=[],this._lookupValues={},this._listSchema={},this._getValueFrom={},this._visibleonEventAttached={},this._stepDiv=0,this._currentStep=1,this._stepValidated=[],this._modelBinder=new f,this.options.formSchema.validation=this.options.formSchema.validation||{},this.model=new u(t.extend(this.options.formSchema,{is_internal:this.options.internal,render_mode:this.options.mode,status:this.options.mode==="update"&&this.options.formData&&this.options.formData.status?this.options.formData.status:null})),e.isEmptyObject(this.options.formData)||t.each(this.model.attributes,function(e,t){if(typeof e!="object"){var r={};r[t]=n.options.formData.fields[t],n.model.set(r)}}),this.prefixedName={list:"subform_",listdisplayid:"_form_content",collectiondisplayid:"_form_collection"},this.notRenderLabel=["html","list","button","submit","clear","fieldset","fieldsetstart","fieldsetend","step","check","checkbox","timestamp","hidden"],this.notRenderLabelRead=["html","list","button","submit","clear","fieldset","fieldsetstart","fieldsetend","step","check","checkbox"],this.inputTemplate={html:t.template(v),label:t.template(m),text:t.template(g),password:t.template(y),telephone:t.template(b),socialsecurity:t.template(w),hidden:t.template(E),timestamp:t.template(S),useraccount:t.template(x),fraction:t.template(T),booleaninput:t.template(N),radio:t.template(C),file:t.template(k),multifiles:t.template(L),filerepository:t.template(A),"read-filerepository":t.template(O),state:t.template(M),county:t.template(_),zipcode:t.template(D),country:t.template(P),fullname:t.template(H),address:t.template(B),textarea:t.template(j),number:t.template(F),email:t.template(I),date:t.template(q),select:t.template(R),check:t.template(U),birthdate:t.template(z),button:t.template(W),buttongroup:t.template(X),list:t.template(V),uneditableinput:t.template($),uneditablecheck:t.template(J),uneditabletag:t.template(K),uneditabletel:t.template(Q),uneditablefile:t.template(G),uneditableimage:t.template(Y),buttonclipboard:t.template(Z),"subform-table":t.template(et)};var r={submitbutton:"Submit",resetbutton:"Cancel"};this.options.formSchema.formoptions=t.extend(r,this.options.formSchema.formoptions)||r},getFormValidationData:function(e){return this.options.formSchema.validation=this.options.formSchema.validation||{},typeof this.options.formSchema.validation[e]=="undefined"?{}:this.options.formSchema.validation[e]},closeOpenDiv:function(e){e=e||"_div";var t="",n=0,r=this[e];for(;n<r;++n)t+="</div>";return this._div=0,t},render:function(n,r){var i=this,u="",a=[n.name],f=n.type.toLowerCase(),l="";n.lang=this.options.lang,n.attributes=n.attributes||{},n.attributes.autocomplete||(n.attributes.autocomplete="off"),n.options=n.options||{},this.options.formSchema.validation=this.options.formSchema.validation||{},this.options.formData=this.options.formData||{};if(!this.options.internal&&n.options.internal)return"";if((f==="button"||f==="submit")&&!n.options.internal&&this.options.internal)return"";if(n.options.renderas){switch(f){case"date":this.options.formData&&this.options.formData.fields&&this.options.formData.fields[n.name]&&this.options.formData.fields[n.name].$date&&(this.options.formData.fields[n.name]=o.formatDateAsString(this.options.formData.fields[n.name].$date));break;case"number":break;default:throw'Not Implement Options.RenderAs for "'+f+'" yet!'}f=n.options.renderas.toLowerCase()}switch(f){case"booleaninput":this._hasBooleanInput=!0;break;case"radio":this._radioFieldName.push(n.name),!this._hasRadioBtnGroup&&n.options.render&&(this._hasRadioBtnGroup=!0),this.options.formData.fields&&this.options.formData.fields[n.name]&&(this.options.mode==="read"&&n.values&&t.isObject(n.values)&&(this._lookupValues[n.name]={value:this.options.formData.fields[n.name],text:n.values[this.options.formData.fields[n.name]]},t.isArray(n.values)||(this.options.formData.fields[n.name]=n.values[this.options.formData.fields[n.name]])),n._data=this.options.formData.fields[n.name]),n.options.orderby&&this.sortOrderBy(n);break;case"multifiles":(!this.options.internal||typeof n.options.internalcanupdate=="undefined"||!!n.options.internalcanupdate)&&e("form"+this.el).attr("enctype","multipart/form-data"),this._multiFiles.push(n);var c=this.getFormValidationData(n.name+"[]");typeof this._stepValidated[this._currentStep-2]!="undefined"&&!e.isEmptyObject(c)&&this._stepValidated[this._currentStep-2].push(n.name+"[]"),this.options.mode==="read"&&(f="file");break;case"filerepository":if(!n.options.url)throw'Expected Url parameter in Options Key for "'+n.name+'".';break;case"image":n.attributes.accept="image/*";case"file":(!this.options.internal||typeof n.options.internalcanupdate=="undefined"||!!n.options.internalcanupdate)&&e("form"+this.el).attr("enctype","multipart/form-data");var c=this.getFormValidationData(n.name);c.accept&&(n.attributes.accept=c.accept);if(n.options.javaupload){var v={name:n.name,id:n.name,code:"com.elementit.JavaPowUpload.Manager",archive:"//public.southernnevadahealthdistrict.org/assets/jar/jupload/JavaPowUpload.jar, //public.southernnevadahealthdistrict.org/assets/jar/jupload/skinlf.jar, //public.southernnevadahealthdistrict.org/assets/jar/jupload/commons-httpclient.jar, //public.southernnevadahealthdistrict.org/assets/jar/jupload/commons-compress.jar",width:500,height:350,mayscript:"true",alt:"JavaPowUpload by www.element-it.com"};this._javaUpload.push(v)}if(n.options.markdownloaddatetimeof&&this.options.mode&&this.options.mode==="read"){var m=this.options.internal?"internal":"external",g=n.options.markdownloaddatetimeof.toLowerCase();if(g==="*"||g===m)n.attributes["class"]=(n.attributes["class"]?n.attributes["class"]:"")+" btn-auto-refresh ",n.attributes["data-refresh-delay"]||(n.attributes["data-refresh-delay"]="2000")}break;case"userid":this._hasUserId=!0,n.options&&n.options.lookup&&n.options.lookup.url&&(n.options.url=n.options.lookup.url),n.options.url&&(n.attributes["data-url"]=n.options.url),n.options.data&&(n.attributes["data-url-data"]=JSON.stringify(n.options.data)),n.attributes.placeholder=n.attributes.placeholder||"Valid E-mail as Username",n.attributes["class"]=(n.attributes["class"]||"")+" userid-lookup",f=n.options.render?n.options.render.toLowerCase():"text",f==="select"&&(n.values=[]),n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"span12");break;case"fraction":break;case"textbox":f="text";case"selectsingle":f==="selectsingle"&&(f="select");case"select":this.options.mode==="update"&&this.options.formData.fields[n.name]&&(n.attributes["data-select-value"]=this.options.formData.fields[n.name]);if(n.options&&n.options.lookup&&n.options.lookup.url)n.options.url=n.options.lookup.url,n.options.lookup.value&&(n.attributes["data-select-key-value"]=n.options.lookup.value),n.options.lookup.text&&(n.attributes["data-select-key-text"]=n.options.lookup.text);else if(n.options){if(n.options.tags)n.attributes["class"]=(n.attributes["class"]?n.attributes["class"]:"")+" selecttwo-render tags value-as-array";else if(n.options.render){var y=n.options.render.toLowerCase();switch(y){case"select2":n.attributes["class"]=(n.attributes["class"]?n.attributes["class"]:"")+" selecttwo-render"}}n.options.events&&this.addDataToElementData(n.name,"events",n.options.events),n.options.orderby&&this.sortOrderBy(n),n.options.getvaluefrom&&n.name&&(this._getValueFrom[n.options.getvaluefrom]||(this._getValueFrom[n.name]=n.options.getvaluefrom))}n.options.url&&(n.attributes["data-url"]=n.options.url.replace(/'/ig,"&#39;")),n.options.data&&(n.attributes["data-url-data"]=JSON.stringify(n.options.data)),n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"span12"),this.options.formData&&this.options.formData.fields&&this.options.formData.fields[n.name]&&(t.isArray(this.options.formData.fields[n.name])&&this.options.formData.fields[n.name].sort(function(e,t){return e-t}),this.options.mode==="read"&&n.values&&t.isObject(n.values)&&(n._data=n.values[this.options.formData.fields[n.name]]),this.addDataToElementData(n.name,"value",this.options.formData.fields[n.name]));break;case"county":typeof d=="string"&&(d=e.parseJSON(d)),n._options=d,n.attributes.id||(n.attributes.id=n.name);var b="select2-county";n.options.filterbyid&&(b="select2-county-lookup"),n.attributes["class"]?n.attributes["class"]+=" "+b:n.attributes["class"]=b,this.options.formData&&this.options.formData.fields&&this.options.formData.fields[n.name]&&(n.attributes["data-countyvalue"]=this.options.formData.fields[n.name]);break;case"checkbox":case"check":if(n.options.numcolumns){if(!t.isNumber(n.options.numcolumns))throw"NumColumns must be a valid number for "+n.name;n.options.numcolumns>4?n.options.numcolumns=4:n.options.numcolumns<1&&(n.options.numcolumns=1)}else n.options.numcolumns=1;!this._hasSelectAllCheckBox&&n.options.addselectall&&(this._hasSelectAllCheckBox=!0),!this._hasClearAllCheckBox&&n.options.addclearall&&(this._hasClearAllCheckBox=!0),n.options.orderby&&this.sortOrderBy(n),n.options.othertextbox&&(this._hasOtherTextBox=!0),this.options.mode==="update"&&this.options.formData.fields&&this.options.formData.fields[n.name]&&(n._data=this.options.formData.fields[n.name]),this.options.formData.fields&&this.options.formData.fields[n.name+"_other"]&&(n._otherValue=this.options.formData.fields[n.name+"_other"]);if(typeof this.options.formSchema.validation[n.name+"[]"]!="undefined"){n._required=!0,n.attributes||(n.attributes={}),n.attributes["data-check-required"]=!0;var c=this.getFormValidationData(n.name+"[]");typeof this._stepValidated[this._currentStep-2]!="undefined"&&!e.isEmptyObject(c)&&this._stepValidated[this._currentStep-2].push(n.name+"[]")}else n._required=!1;f="check";if(!n.values)throw"In order to use CheckBox, please set Values.";break;case"password":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"span12");break;case"telephone":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"integer telephone span12"),this.options.formData.fields&&this.options.formData.fields[n.name+"_provider"]&&(n._providerValue=this.options.formData.fields[n.name+"_provider"]);break;case"socialsecurity":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"integer socialsecurity span12");break;case"textarea":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"span12");break;case"action":return this._div++,'<div class="form-actions">';case"fieldsetstart":return"<fieldset><legend>"+n.description+"</legend>";case"fieldsetend":return"</fieldset>";case"hr":return"<hr>";case"dateinput":f="date";case"date":if(this.options.formData&&this.options.formData.fields)if(typeof this.options.formData.fields[n.name]=="object"){var w=new Date(this.options.formData.fields[n.name].$date),E=w.getMonth()+1;E<10&&(E="0"+E),E+="/";var S=w.getDate();S<10&&(S="0"+S),S+="/",this.options.formData.fields[n.name]=E+S+w.getFullYear();if(n.options.render&&this.options.mode==="read")switch(n.options.render.toLowerCase()){case"datetime":this.options.formData.fields[n.name]+=" "+o.formatAMPM(w)}n.attributes.value=this.options.formData.fields[n.name]}else this.options.mode==="create"&&typeof this.options.formData.fields[n.name]=="undefined"&&(n._noDefaultValue=!0);n.attributes&&!n.attributes.placeholder&&(n.attributes.placeholder="mm/dd/yyyy");if(n.options.render&&n.options.render.toLowerCase()==="select"){f="birthdate",this._hasBDate=!0,n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"birthdaypicker");var c=this.getFormValidationData(n.name),x={id:n.name};n.lang!=="en"&&(x.lang=n.lang),typeof this.options.formData.fields!="undefined"&&(x.defaultdate=this.options.formData.fields[n.name]),n._noDefaultValue&&(x.nodefaultvalue=!0),n.attributes["data-options"]=JSON.stringify(t.extend(x,c)),typeof this._stepValidated[this._currentStep-2]!="undefined"&&!e.isEmptyObject(c)&&(this._stepValidated[this._currentStep-2].push(n.name+"_birth[month]"),this._stepValidated[this._currentStep-2].push(n.name+"_birth[day]"),this._stepValidated[this._currentStep-2].push(n.name+"_birth[year]"))}else{this._hasDate=!0,n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"datepicker");var c=this.getFormValidationData(n.name);t.each(c,function(e,t){delete c[t],c[t.toLowerCase()]=e}),c.maxdate&&(n.attributes["data-maxdate"]=c.maxdate),c.mindate&&(n.attributes["data-mindate"]=c.mindate),n.options&&n.options.datepickeroptions&&(this._DatePickerLogicArr[n.name]=n.options.datepickeroptions,n.attributes["data-has-datepicker-options"]=!0)}break;case"email":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"tolowercase span12"),typeof n.options.autocomplete!="undefined"&&n.options.autocomplete&&(this._hasEmailPicker=!0,n.attributes={},n.attributes["data-provide"]="typeahead",n.attributes.autocomplete="off",n.attributes.style="width:45%;",n.attributes["class"]="not_sending emailpicker_server tolowercase",n.attributes["data-source"]=h.replace(/\n/g,"").replace(/'/g,"&#39"),typeof n.options["default"]!="undefined"&&(n.attributes["data-value"]=n.options["default"]),a.push(n.name+"_username"),a.push(n.name+"_server"));break;case"address":delete n.attributes["class"],delete n.attributes.placeholder,a=[],a.push(n.name+"_address_street"),a.push(n.name+"_address_city"),a.push(n.name+"_address_state"),a.push(n.name+"_address_zip"),a.push(n.name+"_address_country"),n.options.showstreetnumber&&a.push(n.name+"_address_street_number"),n.options.showunitnumber&&a.push(n.name+"_address_unit_number"),typeof r!="undefined"&&typeof this.options.formData!="undefined"?(this.options.formData.fields[n.name+"_address_country"]=s.getCountry(this.options.formData.fields[n.name+"_address_country"]),this.options.formData.fields[n.name+"_address_street"]&&this.options.formData.fields[n.name+"_address_street"].charAt(this.options.formData.fields[n.name+"_address_street"].length-1)!=="."&&(this.options.formData.fields[n.name+"_address_street"]+="."),this.options.formData.fields[n.name+"_address_street"]+="<br>",this.options.formData.fields[n.name+"_address_city"]+=",",this.options.formData.fields[n.name+"_address_state"]+="<br>",this.options.formData.fields[n.name+"_address_zip"]+="<br>"):this.options.mode==="update"&&this.options.formData.fields[n.name+"_address_country"]!=="US"?n.default_value_state=this.options.formData.fields[n.name+"_address_state"]:this.options.mode==="create"&&(this.model.set(n.name+"_address_state","NV"),this.model.set(n.name+"_address_country","US"));if(n.options.zipcodeformat){var T=n.options.zipcodeformat.toLowerCase();switch(T){case"zip+4":n._zipmax=10}}break;case"number":var N;if(!n.options.numbertype||n.options.decimals)N=n.options.decimals?"number":"natural",n.options.decimals&&(n.attributes["data-decimal"]=n.options.decimals);else if(n.options.numbertype&&!n.options.limitinputvalue)switch(n.options.numbertype.toLowerCase()){case"currency":N="number";break;case"double":N="rational";break;default:N="natural"}else N="natural";n.options.limitinputvalue&&(N=n.options.limitinputvalue);if(!N||typeof N!="string")throw new Error('Could not be able to find matching class name for "'+n.name+'" for a number input type.');n.attributes["class"]=o.setupClassAttr(n.attributes["class"],N+" span12");if(n.options.decimals&&this.options.formData.fields&&this.options.formData.fields[n.name]){var C=parseFloat(this.options.formData.fields[n.name]/Math.pow(10,parseInt(n.options.decimals,10)));isNaN(C)||(this.options.formData.fields[n.name]=C.toFixed(n.options.decimals),n.attributes.value=this.options.formData.fields[n.name],this.model.has(n.name)&&this.model.set(n.name,this.options.formData.fields[n.name]))}typeof n.options.spinner!="undefined"&&n.options.spinner&&(n.attributes["class"]=n.attributes["class"].replace(/ span12/,"","gi"),n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"spinner-input"),this.options.mode==="update"&&this.options.formData.fields[n.name]&&(n.attributes["data-value"]=this.options.formData.fields[n.name]));break;case"fullname":delete n.attributes["class"],delete n.attributes.placeholder,a=[],a.push(n.name+"_fullname_first_name"),(typeof n.options.middlename=="undefined"||n.options.middlename)&&a.push(n.name+"_fullname_middle_name"),a.push(n.name+"_fullname_last_name"),n.options.url&&this._ajaxDataCall.push(n);if(this.options.mode==="read"&&n.options&&n.options.highlight){var k=n.options.highlight.toLowerCase().split(",");t.each(k,function(e){var t=n.name+"_fullname_"+e;if(!i.options.formData.fields[t])return;i.options.formData.fields[t]="<u>"+i.options.formData.fields[t]+"</u>"})}break;case"clear":f="button",n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"btn btn-clear-form");break;case"submit":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"btn"),f="button",n._submit=!0,typeof n.url=="undefined"&&(n.url=""),n.options.appendid&&this.options.formData._id&&this.options.formData._id.$oid&&(n.url=(n.url?n.url:"")+(n.url.indexOf("?")>-1?"&id=":"/")+this.options.formData._id.$oid),e(this.el).attr("action",n.url),typeof n.options.ajaxsubmit!="undefined"&&(this._ajaxSubmit=n.options.ajaxsubmit);break;case"buttonclipboard":n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"btn btn-primary"),this._buttonClipboards.push({name:n.name,values:n.values});break;case"buttondecision":r||(n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"btn btn-primary"),f="button",this._buttonDecision.push(n));break;case"button":if(!o.shouldRenderShowOnUser(n))return"";n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"btn"),this.options&&this.options.formData&&this.options.formData._id&&this.options.formData._id.$oid&&(n.options.appendid?n.url=(n.url?n.url:"")+(n.url.indexOf("?")>-1?"&id=":"/")+this.options.formData._id.$oid:n.url&&n.url.search(/{\w+}/ig)>-1&&(n.url=o.formatUriSegment(n.url,this.options.formData))),n.url&&(n.url=o.changeURLGetTemplateString(n.url));if(this.options.internal&&this.options.mode==="read"&&n.name==="BtnMarkAsUnacceptable"&&e.fn.remodal){var L=t.find(this.options.formSchema.fields,function(e){if(!e||!e.name||!e.type)return;if(e.name==="UnacceptableReason")return e});if(L){var A=this.options.formData&&this.options.formData.fields&&this.options.formData.fields.UnacceptableReason?this.options.formData.fields.UnacceptableReason:null;A&&A.replace&&(A=A.replace(/'/ig,"\\'"));var O=(new Date).getTime();n.options["data-remodal-target"]="btnmarkasunacceptable_"+O,n.options["data-remodal-current-value"]=A,n.options["data-current-form-id"]=this.options.formData._id.$oid,n.options["data-url-mark-as-unacceptable"]=n.url;switch(L.type.toLowerCase()){case"radio":if(!L.values)throw new Error("Expected a values key!");n._customHtml=t.reduce(L.values,function(e,n,r,i){var s="UnacceptableReason_"+r,o=t.isArray(i)?n:r,u=A&&A===o?'checked="true"':"";o&&o.replace&&(o=o.replace(/"/ig,"&quot;"));var a='<label class="radio"><input '+u+' name="UnacceptableReason" id="'+s+'" value="'+o+'" type="radio">'+n+"</label>";return e+a},"");break;case"textarea":n._customHtml='<textarea autocomplete="off" name="UnacceptableReason" id="UnacceptableReason"></textarea>';break;default:throw new Error("Not implement "+L.type+" yet!")}n.options.confirmed=null}}if(n.options.confirmed){var M=n.options.confirmedtext?n.options.confirmedtext:"Please confirm your selection.",_={html:!0,placement:"top",title:'<span class="text-info">'+M+"</span>",content:'<a class="btn btn-success btn-confirmed" data-href="'+n.url+'">Yes</button><a class="btn btn-danger btn-confirmed">No</button>'};n.attributes["data-popover-confirm"]=JSON.stringify(_)}else if(n.options.subbuttons)n.name||(n.name="subbuttons_"+n.description.replace(/ /g,"").toLowerCase(),n.attributes.id||(n.attributes.id=n.name)),require(["views/subform-layouts/subbuttons"],function(t){var r=n.attributes.id?n.attributes.id:n.name,o=s.create(this,r,t,{subbuttons:n.options.subbuttons,internal:i.options.internal?i.options.internal:!1,mode:i.options.mode,status:i.options.formData&&i.options.formData.status?i.options.formData.status:null,_id:r,button:e(".form-render #"+r),_oid:i.options.formData&&i.options.formData._id&&i.options.formData._id.$oid?i.options.formData._id.$oid:null})});else if(n.options.subform){if(this.options.mode!=="read")return"";if(!n.name)throw"Expected a valid Name for SubForm Button.";var D=this.options.formData&&this.options.formData._id&&this.options.formData._id.$oid?this.options.formData._id.$oid:null;if(!D)throw"Expected a valid ID for SubForm Button.";var P=n.options.subform;if(!P.url||typeof P.url!="string")throw"Please pass in URL key as a string in SubForm options.";if(!P.fields||!t.isArray(P.fields))throw"Please pass in URL key as an array in SubForm options.";var H="",B=n.options.subform.validation;t.each(P.fields,function(e){H+=ut(e)}),H='<div class="subform-button-wrapper">'+H+'<div class="text-center"><a class="btn btn-primary subform-btn-submit" data-button-name="'+n.name+'">Submit</a></div></div>',e("div#app").on(this.options.formSchema.name+".renderCompleted",function(r,i){var s=e(this).find("button#"+n.name);if(s.length!==1)throw"Invalid SubForm Button, please make sure that the name is unique.";s.popover({html:!0,placement:"top",trigger:"manual",title:'<span class="text-info">Please complete this form.</span>',content:H}),s.on("click",function(e){if(s.hasClass("submitted"))return!1;s.hasClass("shown")?s.removeClass("shown").popover("hide"):s.addClass("shown").popover("show")}),s.parent().on("click",".subform-btn-submit",function(r){r.preventDefault(),r.stopPropagation();var i=e(r.target).attr("data-button-name");if(i!==s.attr("data-button-name")&&s.next(".popover").find(".subform-btn-submit").attr("data-button-name")!==i)return!1;var o=s.next(".popover").find(".subform-button-wrapper"),u=o.find(":input"),a={},f=!1;u.each(function(){var t=e(this),n=t.attr("name"),r=t.val();if(!n||n==="")throw"expect valid input name!";B&&B[n]&&(B[n].required&&r===""?(t.addClass("invalid"),f=!0):t.removeClass("invalid")),a[n]=r});if(!f){var l="subform-btn-"+(new Date).getTime().toString(),c="",h=t.extend({},P.get);t.each(a,function(e,t){var n=t.toLowerCase();h.hasOwnProperty(n)?(delete h[n],h[t]=e):c+='<input type="hidden" name="'+t+'" value="'+e+'"/>'}),n.options.subform.url[n.options.subform.url.length-1]!=="/"&&(n.options.subform.url+="/");var p=n.options.subform.url+D;h&&(p+="?"+e.param(h)),e("body").append('<form id="'+l+'" action="'+p+'" method="POST">'+c+"</form>"),s.removeClass("shown").popover("destroy"),s.popover({html:!0,placement:"top",trigger:"manual",title:'<span class="text-info">Sending Information</span>',content:'<div class="text-center subform-button-wrapper"><i class="icon-spinner icon-spin icon-large"></i> Sending</div>'}).addClass("submitted").popover("show"),s.closest(".form-actions").find(":button").attr("disabled",!0),window.setTimeout(function(){e("body").find("#"+l).submit()},1e3)}return!1})})}break;case"schooles":f="text",n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"span12"),n.attributes["data-provide"]="typeahead",n.attributes.autocomplete="off",n.attributes["data-source"]=p.replace(/\n/g,"").replace(/'/g,"&#39");break;case"step":if(!("view"in this.options.formSchema&&this.options.formSchema.view==="wizard"))return"";this._stepDiv!==0&&(u+="</div>",this._stepDiv--),typeof this._stepValidated[this._currentStep-1]=="undefined"&&(this._stepValidated[this._currentStep-1]=[]);var j="step-pane"+(this._currentStep===1?" active":"");u+='<div class="'+j+'" id="wizard_step'+this._currentStep+'">',this._stepDiv++,this._currentStep++;break;case"useraccount":n.data_value="",n.options.getvaluefromid&&(n.data_value=e("#"+n.options.getvaluefromid).text());break;case"list":n.attributes.id=this.prefixedName.list+(typeof n.attributes.id!="undefined"?n.attributes.id:n.name),n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"subform-container");var F=typeof this.options.formSchema.validation[n.name]!="undefined"?this.options.formSchema.validation[n.name]:{};this.attachSubFormEvent(n.attributes.id,n,F),this._listSchema[n.name]=n;break;case"hidden":var I=["update","create"];t.indexOf(I,this.options.mode)>-1&&this.options.formData&&this.options.formData.fields&&this.options.formData.fields[n.name]&&(n.attributes||(n.attributes={}),n.attributes.value=this.options.formData.fields[n.name])}if(f==="button"&&n.options.visibleon){var q=function(t){t.type==="change"&&n.options.visibleon.values.indexOf(e(this).val())>-1?e("#"+n.name,i.el).show("slow"):e("#"+n.name,i.el).hide("slow")};e(this.el).on("change",':input[name="'+n.options.visibleon.name+'"]',q).on("removeVisibleOn",':input[name="'+n.options.visibleon.name+'"]',q)}typeof this._stepValidated[this._currentStep-2]!="undefined"&&f!=="step"&&f!=="list"&&o.checkRequireFields(n,this.options.formSchema.validation)&&t.each(a,function(e){i._stepValidated[i._currentStep-2].push(e)});if(typeof r!="undefined"&&r&&typeof a[0]!="undefined"&&f!=="button"&&f!=="buttonclipboard"){var R="",U="";t.each(a,function(e){typeof i.options.formData.fields[e]!="object"?R+=(typeof i.options.formData.fields[e]!="undefined"?i.options.formData.fields[e]:"")+" ":R=i.options.formData.fields[e]}),typeof R=="string"&&(R=e.trim(R));if(f==="file"||f==="image"){if(f==="image")i.options.formData.fields[n.name]==="deleted"?U=null:(n.attributes.src=(typeof n.attributes.src!="undefined"?n.attributes.src:"/form/getFile/")+i.options.formData.fields[n.name],U=n.attributes.src);else{n.attributes.target="_blank",n.attributes["class"]=o.setupClassAttr(n.attributes["class"],"btn btn-primary"),n.attributes.href=(typeof n.attributes.href!="undefined"?n.attributes.href:"/form/getFile/")+i.options.formData.fields[n.name],n.attributes.id||(n.attributes.id=n.name);if(n.options.markdownloaddatetimeof&&this.options.formData._id&&this.options.formData._id.$oid){var z=n.options.markdownloaddatetimeof.toLowerCase();if(z==="*"||this.options.internal&&z==="internal"||!this.options.internal&&z==="external")n.attributes.href+="?formid="+this.options.formData._id.$oid}else n.options.appendid&&this.options.formData._id&&this.options.formData._id.$oid&&(n.attributes.href+="?formid="+this.options.formData._id.$oid)}delete n.attributes.accept,t.each(n.attributes,function(e,t){e.search("'")&&(e=e.replace(/\'/ig,'"')),l+=" "+t+"='"+e+"'"}),u+=i.inputTemplate["uneditable"+f]({value:R,text:n.description,_attr:l,id:n.name,href:U})}else if(f==="list")if(typeof this.options.formData.fields[n.name]!="undefined"&&(this.options.formData.fields[n.name].length>0||t.size(this.options.formData.fields[n.name])>0)){var W=[],X=[],V=[],$={},J=0,K=new Array(this.options.formData.fields[n.name].length||t.size(this.options.formData.fields[n.name]));t.each(n.fields,function(r,s){r.options=r.options||{};var u;r.options.tabletitle?(u=r.options.tabletitle,u='<a data-content="'+e("<p>"+r.description+"</p>").text()+'" data-original-title="'+u+'" data-placement="top" data-toggle="popover" data-trigger="hover" data-html="true">'+u+"</a>"):u=r.description,W.push(u),r.options.sortby&&r.options.sortby.toLowerCase()==="date"?X.push('data-sort="int"'):X.push(r.options.sortby?'data-sort="'+r.options.sortby+'"':'data-sort="string"'),t.each(i.options.formData.fields[n.name],function(e,n){var i;t.isNumber(n)||($[r.name]?(J++,n=J):(J=0,$[r.name]=!0,n=J)),typeof K[n]=="undefined"&&(K[n]=[],V[n]=[]);if(r.options.sortby&&r.options.sortby.toLowerCase()==="date"){var s=Date.parseString(e[r.name],"M/d/yyyy h:mm:ss a");V[n].push('data-sort-value="'+s.getTime()+'"')}else V[n].push(null);switch(r.type.toLowerCase()){case"timestamp":var u;r.options&&r.options.tabletitle?u=r.options.tabletitle:u="Timestamps",W[W.length-1]=u,K[n].push(o.getHumanTime(e[r.name]));break;case"useraccount":W[W.length-1]="User",K[n].push(e[r.name]);break;case"fullname":i=e[r.name+"_fullname_first_name"],typeof e[r.name+"_fullname_middle_name"]!="undefined"&&(i+=" "+e[r.name+"_fullname_middle_name"]),i+=" "+e[r.name+"_fullname_last_name"],K[n].push(i);break;case"booleaninput":K[n].push(e[r.name]?"Yes":"No");break;case"date":var a=e[r.name];if(a&&a.$date){a=moment(a.$date);if(!a.isValid())throw new Error('Invalid Date Value for "'+r.name+'" with "'+e[r.name]+'"');a=a.format("MM/DD/YYYY")}K[n].push(a);break;case"number":r.options&&r.options.decimals&&e[r.name]&&(e[r.name]=(e[r.name]/Math.pow(10,r.options.decimals)).toFixed(r.options.decimals));default:if(typeof e[r.name]=="undefined"){delete W[W.length-1];return}K[n].push(e[r.name])}})}),u+=i.inputTemplate["subform-table"]({labels:W,values:K,mode:r,sortBy:X,sortByVal:V,heading:typeof n.options.readmodedescription=="undefined"?n.description:n.options.readmodedescription})}else u+="";else if(f==="telephone"&&n._providerValue)u+=i.inputTemplate.uneditabletel({value:R,label:n.description,id:n.name,providerValue:n._providerValue});else if(f==="check")u+=i.inputTemplate.uneditablecheck({value:R,label:n.description,id:n.name,otherValue:n._otherValue?n._otherValue:""});else if(f==="select"&&n.options&&n.options.tags)t.isArray(R)&&R.sort(function(e,t){return e-t}),u+=i.inputTemplate.uneditabletag({value:R,id:n.name});else if(f==="filerepository")u+=i.inputTemplate["read-filerepository"](t.extend({data:this.options.formData.fields[n.name],formId:this.options.formData._id.$oid,Utils:o},n));else{var Q="";switch(f){case"textarea":case"address":Q=" uneditable-input-textarea";break;case"timestamp":R=o.getHumanTime(R);break;case"select":n._data&&(R=n._data);break;case"booleaninput":R=R==="true"||R===!0?"Yes":"No"}var G=["ParentFormId","FormRecordId"];if(n.name&&this.options.internal&&t.indexOf(G,n.name)>-1){var Y=o.config.internalViewUrl,Z=[];i.options.formData.fields.MultipleFormRecordId?Z=i.options.formData.fields.MultipleFormRecordId.split(","):Z.push(R),t.each(Z,function(e){u+='<a class="btn btn-primary" title="View FormId = '+e+'" href="'+Y+"/"+e+'" style="margin-right:20px;">View</a>'})}else u+=i.inputTemplate.uneditableinput({value:R,css_class:Q,id:n.name})}}else if(f==="image"&&typeof n.options.internalcanupdate!="undefined"&&this.options.internal&&n.options.internalcanupdate===!1){var R="",U="";t.each(a,function(e){typeof i.options.formData.fields[e]!="object"?R+=(typeof i.options.formData.fields[e]!="undefined"?i.options.formData.fields[e]:"")+" ":R=i.options.formData.fields[e]}),typeof R=="string"&&(R=e.trim(R)),i.options.formData.fields[n.name]==="deleted"?U=null:(n.attributes.src=(typeof n.attributes.src!="undefined"?n.attributes.src:"/form/getFile/")+i.options.formData.fields[n.name],U=n.attributes.src),delete n.attributes.accept,t.each(n.attributes,function(e,t){e.search("'")&&(e=e.replace(/\'/ig,'"')),l+=" "+t+"='"+e+"'"}),u+=i.inputTemplate["uneditable"+f]({value:R,text:n.description,_attr:l,id:n.name,href:U})}else{this.options.internal&&typeof n.options.internalcanupdate!="undefined"&&!n.options.internalcanupdate?f="hidden":t.each(n.attributes,function(e,t){l+=" "+t+"='"+e+"'"}),f==="image"&&(f="file"),st&&(console.log(""),console.log("[*] Render HTML Field"),console.log(n),console.log(l));if(st&&typeof this.inputTemplate[f]=="undefined")throw'Template of "'+f+'" not found!';u+=typeof this.inputTemplate[f]!="undefined"?this.inputTemplate[f](t.extend({_attr:l,_lang:this.options.lang},n)):""}if(n.options.visibleon){if(!n.options.visibleon.name||!e.isArray(n.options.visibleon.values))throw n.name+".Options.VisibleOn need Name and Values!";this._visibleOn.push(n)}return n&&n.type&&!this.inputTemplate[f]&&console&&console.warn&&console.warn('[x] Template for "'+n.type+'" does not existed.'),n.options.updateonreadmode&&(u='<div class="update-on-read-mode" data-field-name="'+n.name+'">'+u+this.generateMarkUpForUpdateOnReadMode(n)+"</div>"),u},renderLabel:function(e,n,r){n=n||!1,e.attributes=e.attributes||{},e.options=e.options||{};var i=e.type.toLowerCase(),s=typeof r!="undefined"&&r?' class="'+r+'"':"";e.options.renderas&&(i=e.options.renderas.toLowerCase());switch(i){case"hidden":if(this.options.mode==="create")return"";break;case"buttondecision":return""}return this.inputTemplate.label(t.extend({_cssClass:s,_required:n},e))},renderButton:function(e){var t="";if(e.submitbutton||e.resetbutton)t+='<div class="form-actions">';return e.submitbutton&&!e.subForm?t+='<button type="submit" class="btn btn-primary btn-submit">'+e.submitbutton+"</button>":t+='<button type="button" class="btn btn-primary btn-submit">'+e.submitbutton+"</button>",e.resetbutton&&(t+='<button type="button" class="btn btn-cancel">'+e.resetbutton+"</button>"),t.length>0&&(t+="</div>"),t},checkShowOnMode:function(n,r,i){var s=n.type.toLowerCase();if(n.options.internal!=undefined&&n.options.internal!==this.options.internal)return!1;if(n.options.internal===!0&&n.name&&s!=="buttonclipboard"){var o;switch(s){case"check":case"checkbox":o=n.name+"[]";break;default:o=n.name}this._internalFields.push(o)}if(!this.options.hideButtons||s!=="button"&&s!=="submit"&&s!=="reset"&&s!=="action"){if(this.options.mode==="read"&&!e.isEmptyObject(n.options.visibleon)&&!this.options.formData.fields[n.name]&&s!=="fullname"&&s!=="address"&&s!=="buttonclipboard")return!1;r=r||!1,i=i||!1;if(r!=="read"&&n.type.toLowerCase()==="buttonclipboard")return!1;if(r==="read"&&!this.options.internal&&n.options.hideonexternalread)return!1;if(typeof n.options.showonmode!="undefined"&&n.options.showonmode.indexOf(r)===-1)return!1;if(typeof n.options.showonstatus!="undefined"){var u=t.map(n.options.showonstatus,function(e){return e.toLowerCase()});if(this.options.mode!=="create"&&(i===!1||u.indexOf(i.toLowerCase())===-1))return!1}else if(this.options.internal&&r==="update"&&typeof n.options.internalcanupdate!="undefined"&&!n.options.internalcanupdate&&s!=="image")return!1;return!0}return!1},attachSubFormEvent:function(r,i,s){i=t.extend(i,{validation:s});var o=this,u={el:"#"+r+this.prefixedName.listdisplayid,formSchema:i,formId:r,options:this.options},a=t.extend({},n.Events);e(this.el).on("click","#"+r+"_add_btn",u,this.displaySubForm).on(r+".close",this.closeSubForm).on(r+".add",t.extend({formId:r},this),this.addSubformData),this.options.mode==="update"&&typeof this.options.formData.fields[i.name]!="undefined"&&this.options.formData.fields[i.name].length>0?a.on(u.formId+".listViewCreated",function(t){e(o.el).trigger(r+".add",[t,o.options.formData.fields[i.name]]),a.off()}):a.on(u.formId+".listViewCreated",function(t){var n=e("#"+u.formId,o.el),i=function(s,a){e(o.el).trigger(r+".add",[t,a,!0]),n.one(u.formId+".ajaxUpdate",i)};n.one(u.formId+".ajaxUpdate",i),a.off()}),this.displaySubForm({data:u},{},!0,a)},displaySubForm:function(n,r,i,o,u){u=u||!1;if(!n.data)return;st&&(console.log("[*] baseField.displaySubForm"),r&&r.toJSON&&console.log(r.toJSON()),console.log(i),console.log(o),console.log(u)),r=r||{},i=i||!1,o=o||!1;var a,f=t.clone(n.data);e.isEmptyObject(r)?a="SubFormView"+n.data.formId:(f.model=r,a="SubFormViewEdit"+n.data.formId),e(this).parents("div.actions").fadeOut(),require(["views/fields/list"],function(t){var r=s.create(this,a,t,f),l=e(r.el);i&&l.hide(),r.render(i,u),i||(l.show(),l.addClass("active"),l.expose({closeOnEsc:!1,closeOnClick:!1,color:"#000",zIndex:1025,renderBody:!1})),o&&o.trigger(n.data.formId+".listViewCreated",r)})},closeSubForm:function(t,n){var r=!1;r&&console.log("[*] closeSubForm"),n.$el.fadeOut(),e.mask.close(),e(".actions",n.$el.parent(".subform-container")).fadeIn("slow"),s.remove("SubFormView"+n.options.formId,!0),s.remove("SubFormViewEdit"+n.options.formId,!0)},addSubformData:function(r,i,u,a){var f=!1;f&&(console.log("[*] baseField.addSubformData"),console.log(arguments)),a=a||!1,u=u||!1;var l=i.options.formSchema.view===""?"table":i.options.formSchema.view,c=i.options.formSchema.name,h=r.data.model.get(c);f&&(console.log(h),console.log(h.toJSON())),typeof h!="object"&&r.data.model._listFieldType[c]&&r.data.model.set(c,r.data.model._listFieldType[c]),a&&h.reset();if(u){var p=n.Model.extend({});t.each(u,function(e){var t=new p;t.set(e),h.add(t)})}else f&&console.log(i.model.toJSON()),h.add(i.model);require(["views/subform-layouts/"+l],function(t){f&&(console.log('    in "views/subform-layouts/'+l+'"'),console.log(h.toJSON()));var n={el:"#"+i.options.formId+r.data.prefixedName.collectiondisplayid,formSchema:i.options.formSchema,collection:h,options:i.options.options},u=s.create(this,"CollectionView"+r.data.formId,t,n);u.render(),r.data.closeSubForm(r,i);if(i.options.formSchema.options&&i.options.formSchema.options.permission){var a=o.getUserIdFormHtml().replace("\\","\\\\"),c=new RegExp(a,"ig");switch(i.options.formSchema.options.permission.toLowerCase()){case"readwriteselfcreated":u.$el.find("table tr").each(function(){var t=e(this),n=!1;t.find("td").each(function(){var t=e(this);t.text().match(c)&&(n=!0)}),n||t.find("td.subform-actions button.btn").remove()});break;default:throw i.options.formSchema.options.permission+" not implement yet!"}}})},setupVisibleOn:function(n,r,i){i=i||!1;var s=this,u=n.type.toLowerCase();if(!n.name)throw"In order to use VisibleOn option, we need to pass in the Name";i||(n.options.visibleon.parentcontainer?i=n.options.visibleon.parentcontainer:u==="booleaninput"?i=".form-render_booleaninput_wrapper":n.options.visibleon&&n.options.visibleon.name&&t.indexOf(this._radioFieldName,n.options.visibleon.name)>-1&&(i=".radio-container")),i&&n.options&&n.options.visibleon&&n.options.visibleon.parentcontainer&&n.options.visibleon.parentcontainer!==i&&(i=n.options.visibleon.parentcontainer);switch(u){case"address":delete this.model.validation[n.name+"_address_street"],delete this.model.validation[n.name+"_address_city"],delete this.model.validation[n.name+"_address_state"],delete this.model.validation[n.name+"_address_zip"],delete this.model.validation[n.name+"_address_country"],delete this.model.validation[n.name+"_address_street_number"],delete this.model.validation[n.name+"_address_unit_number"];break;case"multifiles":delete this.model.validation[n.name+"[]"];break;default:delete this.model.validation[n.name]}var a=!1,f=n.options.visibleon.name,l=!0;l&&(a&&console.log('- Attached "'+n.options.visibleon.name+'"'),e(this.el).on("change",':input[name="'+f+'"]',function(a){var f=!1,l=e(a.currentTarget),c=i?l.parents(i):l,h,p,d=[],v=n.options.visibleon.name,m=l.val(),g=["","[]"],y=!1;!c.length&&i===n.options.visibleon.parentcontainer&&(c=l.parents(".form-render").find(i)),v.match(/\[\]$/ig)?(c.length||(c=l.closest(".checkbox-container")),v=v.substr(0,v.length-2),c=c.closest(".checkbox-container"),l.is(":checkbox")&&(m="",c.find(":checkbox:checked").each(function(){var r=e(this).val();t.indexOf(n.options.visibleon.values,r)>-1&&(m=r)}))):l.is(":radio")&&!i&&(c=l.closest(".radio-container"));var b=!0;if(n&&n.options&&n.options.visibleon&&n.options.visibleon.steps){if(!t.isArray(n.options.visibleon.steps)||!n.options.visibleon.steps.length)throw new Error(n.name+" must not contain an empty VisibleOn.Steps");var w=n.options.visibleon.steps;O&&(console.log("[*] Debug: VisibleOn with Steps"),console.log(m),console.log(n.name),console.log(w));for(var E=0;E<w.length;E++){var S=w[E],x=S.values;if(!x||!t.isArray(x)){var T=typeof JSON!="undefined"&&JSON&&JSON.stringify?JSON.stringify(S):null;throw new Error('Expects an array for "Values" in "'+T+'"')}var N=e(':input[name="'+S.name+'"]'),C=e.trim(N.val()),k=t.indexOf(x,C),L=S.notin?k<0:k>-1;O&&(console.log("[*] Step: "+E),console.log(N),console.log(S),console.log(C),console.log(x),console.log(k),console.log(L));if(!L){b=!1;break}}}if(t.indexOf(n.options.visibleon.values,m)>-1&&b){if(e(".options-visible-on-"+n.name,s.el).length<1){c.after(r),h=c.next(".options-visible-on-"+n.name).fadeIn("slow",function(){var r=e(this).addClass("visible-parent-"+v).attr("data-parent",v);o.setupSelect2(r);var i=e(".options-visible-on-"+v,s.el);e('[class*="visible-parent-'+v+'"]',s.el).not(".visible-parent-"+v+",.options-visible-on-"+v+",.visible-parent-"+i.attr("data-parent")).remove(),u==="multifiles"?e("#"+n.name+"_multifiles_wrapper",this).trigger("visibleOnRenderComplete"):e(':input[name="'+n.name+'"]',this).trigger("visibleOnRenderComplete");if(!s.model.bindings[n.name]&&t.indexOf(s.model.notBinding,n.name)<0){var a=n.name;t.each(g,function(t){if(a!==n.name)return;e(':input[name="'+a+t+'"]').length&&(a=n.name+t)}),e(':input[name="'+a+'"]').length&&u!=="checkbox"&&(s.model.bindModelBinder(a,n.type),s._modelBinder.bind(s.model,s.el,s.model.bindings))}}),p=c.next("div"),p.length===0&&(p=c.parent()),p.find(":input").not('input[type="hidden"]').placeholder();if(u==="address"){var A=n.name+"_address_street";s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),A=n.name+"_address_city",s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),A=n.name+"_address_state",s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),A=n.name+"_address_zip",s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),A=n.name+"_address_country",s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),A=n.name+"_address_street_number",s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),A=n.name+"_address_unit_number",s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A]),d.push(A),n.options.hidecountry&&s.model.set(A,"US")}else s.options.formSchema.validation[n.name]&&u!=="html"?(s.model.validation[n.name]=s.options.formSchema.validation[n.name],d.push(n.name)):s.options.formSchema.validation[n.name+"[]"]&&(s.model.validation[n.name+"[]"]=s.options.formSchema.validation[n.name+"[]"],d.push(n.name+"[]"));if(s.options.mode==="update"&&d.length>0)t.each(d,function(t){if(s.options.formData.fields[t]){s.model.set(t,s.options.formData.fields[t]);var n=e(':input[name="'+t+'"]',h);switch(u){case"radio":case"check":case"checkbox":n.filter('[value="'+s.options.formData.fields[t]+'"]').prop("checked",!0);break;default:!n.is(":radio")&&!n.is(":checkbox")&&n.val(s.options.formData.fields[t])}}});else if(s.options.mode==="update"){var O=!1;O&&(console.log("- Check for Field. "+n.name),console.log(n.name),console.log(s.options.formData.fields)),O&&console.log("Current Type: ",u);switch(u){case"fullname":t.each(["_fullname_first_name","_fullname_middle_name","_fullname_last_name"],function(t){var r=n.name+t,i=e(':input[name="'+r+'"]',h);i.length&&s.options.formData.fields[r]&&i.val(s.options.formData.fields[r])});break;default:if(s.options.formData.fields[n.name]){var M=e(':input[name="'+n.name+'"]',h);!M.is(":radio")&&!M.is(":checkbox")&&(M.val(s.options.formData.fields[n.name]),s.model.set(n.name,s.options.formData.fields[n.name]))}}}u==="userid"&&(o.setupUserIdAjaxCall(e("form.form-render")),!s.model.validation[n.name].pattern&&(!n.options.render||n.options.render.toLowerCase()!=="select")&&(s.model.validation[n.name].pattern="email")),o.setupUrlAjaxCall(e("form.form-render"),e("#"+n.name)),s._hasDate&&(O&&(console.log("[*] baseField.setupVisibleOn - _hasDate"),console.log(s.el),console.log(s.$el)),o.setupDateInput(s.el,s));if(s._hasBDate&&n&&n.type&&n.options&&n.options.render&&n.type.toLowerCase()==="date"){var _=n.options.render;try{_=_.toLowerCase();var D=".options-visible-on-"+n.name;typeof s.el=="string"&&(D=s.el+" "+D);switch(_){case"select":o.setupBDateInput(D,s.model)}}catch(P){console&&console.error&&console.error(P)}}}}else{e("#"+n.name,s.el).trigger("removeVisibleOn"),e(".options-visible-on-"+n.name,s.el).remove(),e(".visible-parent-"+n.name,s.el).remove();if(u==="date"&&n.options&&n.options.render){var H=n.options.render;try{H=H.toLowerCase();switch(H){case"select":var B=n.name+"_birth";typeof t=="undefined"||!t?console&&console.error&&console.error('Could not be able to locate "_".'):(t.map(["day","month","year"],function(e){var t=B+"["+e+"]";s.model.validation[t]&&delete s.model.validation[t]}),s.model.validation[n.name]&&delete s.model.validation[n.name]);break;default:throw new Error('Not implement delete for "'+H+'"')}}catch(P){console&&console.error&&console.error(P)}}else if(u==="fullname")t.map(["_fullname_first_name","_fullname_last_name"],function(e){var t=n.name+e;s.model.validation[t]&&delete s.model.validation[t]});else if(u==="address"){var A=n.name+"_address_street";s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A]),A=n.name+"_address_city",s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A]),A=n.name+"_address_state",s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A]),A=n.name+"_address_zip",s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A]),A=n.name+"_address_country",s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A]),A=n.name+"_address_street_number",s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A]),A=n.name+"_address_unit_number",s.model.set(A,""),s.options.formSchema.validation[A]&&(s.model.validation[A]=s.options.formSchema.validation[A],delete s.model.validation[A])}else if(u!=="html"){s.model.set(n.name,""),s.model.validation[n.name]?delete s.model.validation[n.name]:s.model.validation[n.name+"[]"]&&delete s.model.validation[n.name+"[]"];var j=n.name;t.each(g,function(e){if(s.model.bindings[j+e]){s.model.unbindModelBinder(j+e,n.type);var r=!0;while(r)try{s._modelBinder.bind(s.model,s.el,s.model.bindings),r=!1}catch(i){r=!1;var o=i.match(/name="(\w+)"/i);o||console&&console.error&&console.error(i);if(o.length===2){var u=o[1];t.each(g,function(e){s.model.bindings[u+e]&&(s.model.unbindModelBinder(u+e,n.type),s.model.validation[u+e]&&delete s.model.validation[u+e],r=!0)})}}if(!l.is(":checkbox")){var a=l.attr("name");l.is(":radio")||l.val(m),s.model.get(a)!==m&&s.model.set(a,m)}}}),l.is(":radio")&&l.prop("checked",!0)}f&&(console.log("[*] Check for Validation"),console.log(s.model.validation))}}))},setupCopyValuesFrom:function(n){if(!n.options.copyvaluesfrom.name||!n.options.copyvaluesfrom.description)throw"In order to use CopyValuesFrom options, need to have Name and Description";var r=this,i="";return i+='<div class="copy-values-from '+n.options.copyvaluesfrom.name+'">'+this.inputTemplate.buttongroup({description:n.options.copyvaluesfrom.description})+"</div>",e(this.el).on("click",".copy-values-from."+n.options.copyvaluesfrom.name+" .btn-group button",function(i){var s=e(i.currentTarget),u,a,f=[];s.hasClass("btn-yes")&&(u=o.getSpecialFieldsName(n.options.copyvaluesfrom.name,n.type),t.each(u,function(t){f.push(e(':input[name="'+t+'"]',r.el).val())}),a=o.getSpecialFieldsName(n.name,n.type),o.setFieldsValues(r.el,r.model,a,f))}),i},sortOrderBy:function(e){var t=e.options.orderby,n;if(!t&&!e.values)return;t=t.toLowerCase();switch(t){default:n=function(e,t){return e.localeCompare(t)}}e.values.sort&&e.values.sort(n)},addDataToElementData:function(e,t,n){this._elementData[e]||(this._elementData[e]={}),this._elementData[e][t]=n},generateMarkUpForUpdateOnReadMode:function(e){if(!e.type)return console&&console.warn&&console.warn('[x] generateMarkUpForUpdateOnReadMode for "'+e.name+'" could not be able to find "Type".'),"";var n=!1,r=e.type.trim().toLowerCase(),i=this.options.formData.fields[e.name],s,o;n&&(console.debug("[*] UpdateOnReadMode"),console.debug("     Name: "+e.name),console.debug("     Value: "+i));switch(r){case"file":throw"Not yet support!";default:o="text"}switch(r){case"radio":s=ot["default-input-radio"](t.extend({data:i},e));break;case"textarea":s=ot["default-input-textarea"](t.extend({data:i},e));break;case"date":s=ot["default-input-date"](t.extend({data:i},e));break;default:s=ot["default-input"](t.extend({inputType:o,data:i},e))}return n&&console.debug("     HTML: "+s),s}})});