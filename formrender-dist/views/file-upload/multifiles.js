define(["jquery","lodash","backbone","models/model","modelbinder","validation","vm","utils","events","text!templates/file-upload/template-upload.html","text!templates/file-upload/template-download.html"],function(e,t,n,r,i,s,o,u,a,f,l){return n.View.extend({initialize:function(){this.el="#"+this.options.field.name+"_multifiles_wrapper",this.template=t.template(f),this.collection=new n.Collection([]),e.isEmptyObject(this.options.field.options.visibleon)||e(this.options.name).on("visibleOnRenderComplete",this.el,{view:this},this.addEvents)},render:function(){var t=e("#"+this.options.field.name+"_multifiles_table .files",this.el);t.html(this.template({collection:this.collection.toJSON(),convertFileSize:this.convertFileSize}))},events:{},convertFileSize:function(e){var t;for(var n=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=0,i=e/1024;i>1;i/=1024,r++)t=i.toFixed(3)+" "+n[r];return t},setupEvents:function(t,n){e(".fileinput-button",t).on("click",{view:this},n.clickFileUploadButton),e(".delete",t).on("click",{view:this},function(t){var n=t.data.view||!1;n.collection.reset(),e("#"+n.options.field.name+"_multifiles_table :input.hidden-multi-files").remove(),n.render()}),e("#"+n.options.field.name+"_multifiles",t).on("change",{view:this},n.changeFileInput),e("#"+n.options.field.name+"_multifiles_table",t).on("click","button.cancel",{view:this},n.removeFile)},addEvents:function(e){var t=e.data.view||!1;t.setupEvents(this.el,t)},clickFileUploadButton:function(t){var n=e(t.currentTarget),r=t.data.view||!1;e("#"+r.options.field.name+"_multifiles",n.parent()).trigger("click")},changeFileInput:function(n){var r=n.data.view||!1,i=e(this);t.each(i.get(0).files,function(t){if(typeof r.collection.findWhere({name:t.name,size:t.size})=="undefined"){r.collection.add(t);var n=e("#"+r.options.field.name+"_multifiles").clone(),i=r.collection.at(r.collection.length-1);n.attr("id",r.options.field.name+"_"+i.cid).removeClass("not_sending").addClass("hidden-multi-files").attr("name",r.options.field.name+"[]"),e("#"+r.options.field.name+"_multifiles_table").prepend(n)}}),r.render()},removeFile:function(t){var n=t.data.view||!1,r=e(this).parents(".template-upload"),i=n.collection.findWhere({name:r.find(".name").text(),size:parseInt(r.find(".size").attr("data-size"))});n.collection.remove(i),e("#"+n.options.field.name+"_"+i.cid).remove(),n.render()}})});